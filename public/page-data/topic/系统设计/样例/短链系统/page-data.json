{"componentChunkName":"component---src-templates-topic-post-template-js","path":"/topic/系统设计/样例/短链系统","result":{"data":{"siYuan":{"excerpt":"短链系统设计看起来简单，但是每个点都能展开很多知识点。短链是通过访问服务器上的链接，通过Http返回的302Code，对链接进行重定向，然后访问到对应的地址上。 sequenceDiagram 客户端->>短链服务器: 访问A 短链服务器-...","raw":"短链系统设计看起来简单，但是每个点都能展开很多知识点。短链是通过访问服务器上的链接，通过Http返回的302Code，对链接进行重定向，然后访问到对应的地址上。\n\n\n```mermaid\nsequenceDiagram\n    客户端->>短链服务器: 访问A\n    短链服务器->>客户端: status code:302  location:B\n    客户端 ->> B服务器: 访问B\n```\n\nHttp协议中重定向有两种code: 301 、302\n\n* 301: 代表永久**重定向**。\n* 302: 代表**临时重定向**。\n\n他们的区别就在于浏览器会对301做缓存的效果，如果返回的code是301，则浏览器缓存A到B的映射，在下次发起请求的时候不会再去请求A的服务器。\n\n# 概述用例和约束\n\n## 用例\n\n* **用户** 输入一段文本，然后得到一个随机生成的链接\n\n  * 过期设置\n\n    * 默认的设置是不会过期的\n    * 可以选择设置一个过期的时间\n* **用户** 输入一个 paste 的 url 后，可以看到它存储的内容\n* **用户** 是匿名的\n* **Service** 跟踪页面分析\n\n  * 一个月的访问统计\n* **Service** 删除过期的 pastes\n* **Service** 需要高可用\n\n## 约束和假设\n\n* 访问流量不是均匀分布的\n* 打开一个短链接应该是很快的\n* pastes 只能是文本\n* 页面访问分析数据可以不用实时\n* 一千万的用户量\n* 每个月一千万的 paste 写入量\n* 每个月一亿的 paste 读取量\n* 读写比例在 10:1\n\n## 预估容量\n\n* 每个 paste 的大小\n\n  * 每一个 paste 1 KB\n  * `shortlink` - 7 bytes\n  * `expiration_length_in_minutes` - 4 bytes\n  * `created_at` - 5 bytes\n  * 总共 = ~1.27 KB\n* 每个月新的 paste 内容在 12.7GB\n\n  * (1.27 * 10000000)KB / 月的 paste\n  * 三年内将近 450GB 的新 paste 内容\n  * 三年内 3.6 亿短链接\n  * 假设大部分都是新的 paste，而不是需要更新已存在的 paste\n* 平均 4paste/s 的写入速度\n* 平均 40paste/s 的读取速度\n\n# 创建一个高层次设计\n\n用webServer作为请求的入口，然后调用API去访问SQL。最后采用Analytics对请求数据进行分析。\n\n```mermaid\ngraph TD;\n    客户端-->WebServer;\n    WebServer-->WriteAPI;\n    WebServer-->ReadAPI;\n    ReadAPI-->SQL;\n    WriteAPI-->SQL;\n   Analytics -->SQL;\n```\n\n# 设计核心组件\n\n## 用例: **用户**输入一段文本，然后得到一个随机生成的链接\n\n用关系型数据库直接将生成的URL映射成用户的URL。\n\n* **客户端** 发送一个创建 paste 的请求到作为一个[反向代理](https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8)启动的  **Web 服务器** 。\n* **Web 服务器** 转发请求给 **写接口** 服务器\n* **写接口** 服务器执行如下操作：\n\n  * 生成一个唯一的 url\n\n    * 检查这个 url 在 **SQL 数据库** 里面是否是唯一的\n    * 如果这个 url 不是唯一的，生成另外一个 url\n    * 如果我们支持自定义 url，我们可以使用用户提供的 url（也需要检查是否重复）\n  * 把生成的 url 和用户的url 存储到 **SQL 数据库** 的 `pastes` 表里面\n  * 返回生成的 url\n\n`pastes`结构如下:\n\n```sql\nshortlink char(7) NOT NULL\nexpiration_length_in_minutes int NOT NULL\ncreated_at datetime NOT NULL\npaste varchar(2048) NOT NULL\nPRIMARY KEY(shortlink)\n```\n\n在`shortlink`上创建一个数据库索引，用来提高查询的速度。\n\n## 用例：用户输入一个 paste 的 url 后可以看到它存储的内容\n\n* **客户端** 发送一个获取 paste 请求到 **Web Server**\n* **Web Server** 转发请求给 **读取接口** 服务器\n* **读取接口** 服务器执行如下操作：\n\n  * 在 **SQL 数据库** 检查这个生成的 url\n\n    * 如果这个 url 在 **SQL 数据库** 里面，则从返回这个 `paste` 的内容\n    * 否则，返回一个错误页面给用户\n\n## 用例： 服务跟踪分析页面\n\n因为实时分析不是必须的，所以我们可以简单的 **MapReduce** **Web Server** 的日志，用来生成点击次数。\n\n## 用例： 服务删除过期的 pastes\n\n为了删除过期的 pastes，我们可以直接搜索 **SQL 数据库** 中所有的过期时间比当前时间更早的记录， 所有过期的记录将从这张表里面删除（或者将其标记为过期）。\n\n# 扩展设计\n\n```mermaid\ngraph TD;\n\tClient-->DNS负载;\n        Client-->CDN回源;\n\tDNS负载-->LoadBalancer;\n\tLoadBalancer-->WebServer;\n\tWebServer-->WriteAPI;\n\tWebServer-->ReadAPI;\n\tReadAPI-->MemoryCache;\n\tWriteAPI-->SQLMaster-Slave;\n\tReadAPI-->SQLReadReplicas;\n\tSQLMaster-Slave --- SQLReadReplicas;\n\tAnalytics-->SQLAnalytics;\n\tSQLAnalytics-->SQLMaster-Slave\n```\n\n* 对于请求量比较大的，应该将数据留在上游，这部分可以采用CDN来代理源站，将数据放在边缘\n* 使用LoadBalancer来代理我们具体的服务器，以便于可以对webServer进行水平扩展\n* 处理每秒40的读请求，其内容应该交由给内存级别的缓存来处理。比如Redis这种\n* 对于单个关系型数据库，主从切分之后每秒4次的写入问题不大。\n\n  如果写入出现了瓶颈，需要额外采用别的方式。包括但不限于：\n\n  1. 水平、垂直分片\n  2. 非规范化\n  3. SQL调优\n\n# 总结\n\n对于短链系统，整体的系统的设计大概如此，从架构方面应该是满足要求了。\n\n其次，还有一些细节在我看来就是属于业务上的东西了，需要自行衡量,比如: 短链生成方法有好几种方式，Hash、Md5、UUID、redis、Snowflake、Mysql 自增主键。其选型并没有什么优劣之分，只有合适与否。\n\n整个系统的诞生是一个不断优化的过程，我们需要先解决有的问题，再持续进行优化。\n\n* 继续对系统进行基准测试和监控，以在瓶颈出现时解决它们\n* 扩展是一个迭代的过程\n","html":"<div data-node-id=\"20220523142856-op5xtkz\" data-node-index=\"0\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523150055\"><div contenteditable=\"true\" spellcheck=\"false\">短链系统设计看起来简单，但是每个点都能展开很多知识点。短链是通过访问服务器上的链接，通过Http返回的302Code，对链接进行重定向，然后访问到对应的地址上。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523152435-qdaomp2\" data-node-index=\"1\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523152457\"><div contenteditable=\"true\" spellcheck=\"false\"></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523151912-5kdqrjm\" data-node-index=\"2\" data-type=\"NodeCodeBlock\" class=\"render-node\" updated=\"20220523152429\" data-content=\"sequenceDiagram\n    客户端-&amp;gt;&amp;gt;短链服务器: 访问A\n    短链服务器-&amp;gt;&amp;gt;客户端: status code:302  location:B\n    客户端 -&amp;gt;&amp;gt; B服务器: 访问B\" data-subtype=\"mermaid\"><div spin=\"1\"></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523152335-q35iqwf\" data-node-index=\"3\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523152524\"><div contenteditable=\"true\" spellcheck=\"false\">Http协议中重定向有两种code: 301 、302</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523152525-6cln9ka\" data-node-index=\"4\" data-type=\"NodeList\" class=\"list\" updated=\"20220523152612\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523152527-9f2sbzc\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523152633\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523152527-r2ixows\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523152633\"><div contenteditable=\"true\" spellcheck=\"false\">301: 代表永久<strong>重定向</strong>。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523152543-0uylo6k\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523152612\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523152543-rz8966o\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523152612\"><div contenteditable=\"true\" spellcheck=\"false\">302: 代表<strong>临时重定向</strong>。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523152634-8jlg7rm\" data-node-index=\"5\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523152756\"><div contenteditable=\"true\" spellcheck=\"false\">他们的区别就在于浏览器会对301做缓存的效果，如果返回的code是301，则浏览器缓存A到B的映射，在下次发起请求的时候不会再去请求A的服务器。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h1\" data-node-id=\"20220523152802-ora3luz\" data-node-index=\"6\" data-type=\"NodeHeading\" class=\"h1\" updated=\"20220524140555\"><div contenteditable=\"true\" spellcheck=\"false\">概述用例和约束</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523153231-cqe7c6z\" data-node-index=\"7\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523153235\"><div contenteditable=\"true\" spellcheck=\"false\">用例</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153213-y33pxpz\" data-node-index=\"8\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153213\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-nnvm3bk\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-a4pg80w\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>用户</strong> 输入一段文本，然后得到一个随机生成的链接</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153213-828hfp7\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153213\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-4k0ediq\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-2qi0zi8\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\">过期设置</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153213-d7up638\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153213\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-6yb72so\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-k9l23bf\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\">默认的设置是不会过期的</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-sl537t4\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-23aze7f\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\">可以选择设置一个过期的时间</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-41i6ql9\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-on3jjcd\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>用户</strong> 输入一个 paste 的 url 后，可以看到它存储的内容</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-3uiwd2j\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-0xktlgz\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>用户</strong> 是匿名的</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-q7wzwuq\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-haa8roa\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>Service</strong> 跟踪页面分析</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153213-hgaa0ir\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153213\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-ribmjn0\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-yuto3u5\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\">一个月的访问统计</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-ws7rwj8\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-6pnpowp\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>Service</strong> 删除过期的 pastes</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153213-45lfvws\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153213\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153213-50e06ur\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153213\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>Service</strong> 需要高可用</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523153213-tyokdre\" data-node-index=\"9\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523153444\"><div contenteditable=\"true\" spellcheck=\"false\">约束和假设</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153258-uo53gax\" data-node-index=\"10\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153258\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-h7nj3hu\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-00i0wft\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">访问流量不是均匀分布的</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-wsy77nz\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-5ftehgj\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">打开一个短链接应该是很快的</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-xi6p9pv\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-kunopru\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">pastes 只能是文本</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-ugznzba\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-in2g0bd\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">页面访问分析数据可以不用实时</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-rso1n0g\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-zho5y24\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">一千万的用户量</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-d4rrjt9\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-idc9cqy\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">每个月一千万的 paste 写入量</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-20h4lck\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-016iie4\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">每个月一亿的 paste 读取量</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153258-e0lwn8x\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153258\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153258-jv28te2\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153258\"><div contenteditable=\"true\" spellcheck=\"false\">读写比例在 10:1</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523153245-akx221a\" data-node-index=\"11\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523153449\"><div contenteditable=\"true\" spellcheck=\"false\">预估容量</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153457-e1rspcy\" data-node-index=\"12\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153457\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-qtk3idp\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-istyzik\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">每个 paste 的大小</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153457-c2txl12\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153457\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-et4795w\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-p5hq5q4\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">每一个 paste 1 KB</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-3o7paue\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-ozcytz1\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\"><code>shortlink</code> - 7 bytes</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-yqlrbtk\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-anvxfwg\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\"><code>expiration_length_in_minutes</code> - 4 bytes</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-lc35uk7\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-t57pf0o\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\"><code>created_at</code> - 5 bytes</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-sxdhakh\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-jedzkqb\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">总共 = ~1.27 KB</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-m3kdjym\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-wac1j57\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">每个月新的 paste 内容在 12.7GB</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523153457-jen2pkq\" data-type=\"NodeList\" class=\"list\" updated=\"20220523153457\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-3tm3wns\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-l8bouj0\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">(1.27 * 10000000)KB / 月的 paste</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-7x2aa0i\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-dhtjxz0\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">三年内将近 450GB 的新 paste 内容</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-wmvkfgf\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-bjwkiqc\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">三年内 3.6 亿短链接</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-6bcxkuc\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-p02l3zb\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">假设大部分都是新的 paste，而不是需要更新已存在的 paste</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-hahn7nu\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-un0atef\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">平均 4paste/s 的写入速度</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523153457-j28ztta\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523153457\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523153457-ah3stx0\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523153457\"><div contenteditable=\"true\" spellcheck=\"false\">平均 40paste/s 的读取速度</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h1\" data-node-id=\"20220523154027-n2m6mb0\" data-node-index=\"13\" data-type=\"NodeHeading\" class=\"h1\" updated=\"20220523154854\"><div contenteditable=\"true\" spellcheck=\"false\">创建一个高层次设计</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523155759-cpb3o4p\" data-node-index=\"14\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523155837\"><div contenteditable=\"true\" spellcheck=\"false\">用webServer作为请求的入口，然后调用API去访问SQL。最后采用Analytics对请求数据进行分析。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523155441-wxughdl\" data-node-index=\"15\" data-type=\"NodeCodeBlock\" class=\"render-node\" updated=\"20220523155750\" data-content=\"graph TD;\n    客户端--&amp;gt;WebServer;\n    WebServer--&amp;gt;WriteAPI;\n    WebServer--&amp;gt;ReadAPI;\n    ReadAPI--&amp;gt;SQL;\n    WriteAPI--&amp;gt;SQL;\n   Analytics --&amp;gt;SQL;\" data-subtype=\"mermaid\"><div spin=\"1\"></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h1\" data-node-id=\"20220523155756-as6zfq4\" data-node-index=\"16\" data-type=\"NodeHeading\" class=\"h1\" updated=\"20220523155909\"><div contenteditable=\"true\" spellcheck=\"false\">设计核心组件</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523155920-i5awrmn\" data-node-index=\"17\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523155930\"><div contenteditable=\"true\" spellcheck=\"false\">用例: <strong>用户</strong>输入一段文本，然后得到一个随机生成的链接</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523155934-vlgfv2s\" data-node-index=\"18\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160015\"><div contenteditable=\"true\" spellcheck=\"false\">用关系型数据库直接将生成的URL映射成用户的URL。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523160024-sj7a1v9\" data-node-index=\"19\" data-type=\"NodeList\" class=\"list\" updated=\"20220523160024\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-se9qdie\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-0nhf7w2\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>客户端</strong> 发送一个创建 paste 的请求到作为一个<span data-type=\"a\" data-href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8\">反向代理</span>启动的  <strong>Web 服务器</strong> 。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-ys8t21s\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-ymsiwn7\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>Web 服务器</strong> 转发请求给 <strong>写接口</strong> 服务器</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-0zsxb8r\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-pz171u1\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>写接口</strong> 服务器执行如下操作：</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523160024-ohks9cj\" data-type=\"NodeList\" class=\"list\" updated=\"20220523160024\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-j6wxz2d\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-47qc950\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\">生成一个唯一的 url</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523160024-w9j6j4g\" data-type=\"NodeList\" class=\"list\" updated=\"20220523160024\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-1uk63kf\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-pexwsfq\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\">检查这个 url 在 <strong>SQL 数据库</strong> 里面是否是唯一的</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-22z0glk\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-7dk69bo\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\">如果这个 url 不是唯一的，生成另外一个 url</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-bv5smz5\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-eolclhw\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\">如果我们支持自定义 url，我们可以使用用户提供的 url（也需要检查是否重复）</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-dq1hxkx\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160048\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-in84hw0\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160048\"><div contenteditable=\"true\" spellcheck=\"false\">把生成的 url 和用户的url 存储到 <strong>SQL 数据库</strong> 的 <code>pastes</code> 表里面</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160024-q74o6zk\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160024\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160024-ybqjlrr\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160024\"><div contenteditable=\"true\" spellcheck=\"false\">返回生成的 url</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523160255-km50zrn\" data-node-index=\"20\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160306\"><div contenteditable=\"true\" spellcheck=\"false\"><code>pastes</code>结构如下:</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523160108-sopj7dd\" data-node-index=\"21\" data-type=\"NodeCodeBlock\" class=\"code-block\" updated=\"20220523160155\"><div class=\"protyle-action\"><span class=\"protyle-action--first protyle-action__language\" contenteditable=\"false\">sql</span><span class=\"fn__flex-1\"></span><span class=\"protyle-icon protyle-icon--first protyle-action__copy\"><svg><use xlink:href=\"#iconCopy\"></use></svg></span><span class=\"protyle-icon protyle-icon--last protyle-action__menu\"><svg><use xlink:href=\"#iconMore\"></use></svg></span></div><div contenteditable=\"true\" spellcheck=\"false\">shortlink char(7) NOT NULL\nexpiration_length_in_minutes int NOT NULL\ncreated_at datetime NOT NULL\npaste varchar(2048) NOT NULL\nPRIMARY KEY(shortlink)\n</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523160221-6c7kmph\" data-node-index=\"22\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160415\"><div contenteditable=\"true\" spellcheck=\"false\">在<code>shortlink</code>上创建一个数据库索引，用来提高查询的速度。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523160445-ppzjfcg\" data-node-index=\"23\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523160454\"><div contenteditable=\"true\" spellcheck=\"false\">用例：用户输入一个 paste 的 url 后可以看到它存储的内容</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523160500-xyjv7bl\" data-node-index=\"24\" data-type=\"NodeList\" class=\"list\" updated=\"20220523160500\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160500-tq8itsr\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160500\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160500-oh9rwft\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160500\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>客户端</strong> 发送一个获取 paste 请求到 <strong>Web Server</strong></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160500-7njzzh6\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160500\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160500-yep4nds\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160500\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>Web Server</strong> 转发请求给 <strong>读取接口</strong> 服务器</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160500-hwakejx\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160500\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160500-rj98hd3\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160500\"><div contenteditable=\"true\" spellcheck=\"false\"><strong>读取接口</strong> 服务器执行如下操作：</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523160500-7ouclnj\" data-type=\"NodeList\" class=\"list\" updated=\"20220523160500\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160500-yv9msh3\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160500\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160500-vnj6m43\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160500\"><div contenteditable=\"true\" spellcheck=\"false\">在 <strong>SQL 数据库</strong> 检查这个生成的 url</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523160500-t9axz7v\" data-type=\"NodeList\" class=\"list\" updated=\"20220523160500\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160500-4na6p8l\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160512\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160500-oms9hz4\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160512\"><div contenteditable=\"true\" spellcheck=\"false\">如果这个 url 在 <strong>SQL 数据库</strong> 里面，则从返回这个 <code>paste</code> 的内容</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523160500-ymconul\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523160500\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523160500-j4gtaqf\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160500\"><div contenteditable=\"true\" spellcheck=\"false\">否则，返回一个错误页面给用户</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523160523-x0zwdli\" data-node-index=\"25\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523160524\"><div contenteditable=\"true\" spellcheck=\"false\">用例： 服务跟踪分析页面</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523160528-ygodymc\" data-node-index=\"26\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160528\"><div contenteditable=\"true\" spellcheck=\"false\">因为实时分析不是必须的，所以我们可以简单的 <strong>MapReduce</strong> <strong>Web Server</strong> 的日志，用来生成点击次数。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h2\" data-node-id=\"20220523160541-cln3fph\" data-node-index=\"27\" data-type=\"NodeHeading\" class=\"h2\" updated=\"20220523160543\"><div contenteditable=\"true\" spellcheck=\"false\">用例： 服务删除过期的 pastes</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523160546-q1v0z4i\" data-node-index=\"28\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523160546\"><div contenteditable=\"true\" spellcheck=\"false\">为了删除过期的 pastes，我们可以直接搜索 <strong>SQL 数据库</strong> 中所有的过期时间比当前时间更早的记录， 所有过期的记录将从这张表里面删除（或者将其标记为过期）。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h1\" data-node-id=\"20220523160546-vbv6n9j\" data-node-index=\"29\" data-type=\"NodeHeading\" class=\"h1\" updated=\"20220523161035\"><div contenteditable=\"true\" spellcheck=\"false\">扩展设计</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523162343-blvta22\" data-node-index=\"30\" data-type=\"NodeCodeBlock\" class=\"render-node\" updated=\"20220523163057\" data-content=\"graph TD;\n\tClient--&amp;gt;DNS负载;\n        Client--&amp;gt;CDN回源;\n\tDNS负载--&amp;gt;LoadBalancer;\n\tLoadBalancer--&amp;gt;WebServer;\n\tWebServer--&amp;gt;WriteAPI;\n\tWebServer--&amp;gt;ReadAPI;\n\tReadAPI--&amp;gt;MemoryCache;\n\tWriteAPI--&amp;gt;SQLMaster-Slave;\n\tReadAPI--&amp;gt;SQLReadReplicas;\n\tSQLMaster-Slave --- SQLReadReplicas;\n\tAnalytics--&amp;gt;SQLAnalytics;\n\tSQLAnalytics--&amp;gt;SQLMaster-Slave\" data-subtype=\"mermaid\"><div spin=\"1\"></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523162403-9wropuw\" data-node-index=\"31\" data-type=\"NodeList\" class=\"list\" updated=\"20220523163659\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523163541-0rj9x97\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163601\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523163541-34jokv2\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163601\"><div contenteditable=\"true\" spellcheck=\"false\">对于请求量比较大的，应该将数据留在上游，这部分可以采用CDN来代理源站，将数据放在边缘</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523163603-6jv4qio\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163659\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523163603-djdj2zj\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163659\"><div contenteditable=\"true\" spellcheck=\"false\">使用LoadBalancer来代理我们具体的服务器，以便于可以对webServer进行水平扩展</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523163225-afulz8l\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163225\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523163225-eqva1x2\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163225\"><div contenteditable=\"true\" spellcheck=\"false\">处理每秒40的读请求，其内容应该交由给内存级别的缓存来处理。比如Redis这种</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523163225-vidzx0b\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163432\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523163225-qxfa8cd\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163301\"><div contenteditable=\"true\" spellcheck=\"false\">对于单个关系型数据库，主从切分之后每秒4次的写入问题不大。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523163302-eq7qp7p\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163455\"><div contenteditable=\"true\" spellcheck=\"false\">如果写入出现了瓶颈，需要额外采用别的方式。包括但不限于：</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"o\" data-node-id=\"20220523163328-1x13of6\" data-type=\"NodeList\" class=\"list\" updated=\"20220523163432\"><div data-marker=\"1.\" data-subtype=\"o\" data-node-id=\"20220523163330-xq7w4in\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163422\"><div class=\"protyle-action protyle-action--order\" contenteditable=\"false\" draggable=\"true\">1.</div><div data-node-id=\"20220523163330-8yt8dxc\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163422\"><div contenteditable=\"true\" spellcheck=\"false\">水平、垂直分片</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"2.\" data-subtype=\"o\" data-node-id=\"20220523163423-x0hwufr\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163429\"><div class=\"protyle-action protyle-action--order\" contenteditable=\"false\" draggable=\"true\">2.</div><div data-node-id=\"20220523163423-wy4f58t\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163429\"><div contenteditable=\"true\" spellcheck=\"false\">非规范化</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"3.\" data-subtype=\"o\" data-node-id=\"20220523163430-ucd6wvs\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163432\"><div class=\"protyle-action protyle-action--order\" contenteditable=\"false\" draggable=\"true\">3.</div><div data-node-id=\"20220523163430-dwbp4f1\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163432\"><div contenteditable=\"true\" spellcheck=\"false\">SQL调优</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"h1\" data-node-id=\"20220523163729-9u3wkrv\" data-node-index=\"32\" data-type=\"NodeHeading\" class=\"h1\" updated=\"20220523163732\"><div contenteditable=\"true\" spellcheck=\"false\">总结</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523163844-czlvb7d\" data-node-index=\"33\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163925\"><div contenteditable=\"true\" spellcheck=\"false\">对于短链系统，整体的系统的设计大概如此，从架构方面应该是满足要求了。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523163926-a1nm674\" data-node-index=\"34\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523164213\"><div contenteditable=\"true\" spellcheck=\"false\">其次，还有一些细节在我看来就是属于业务上的东西了，需要自行衡量,比如: 短链生成方法有好几种方式，Hash、Md5、UUID、redis、Snowflake、Mysql 自增主键。其选型并没有什么优劣之分，只有合适与否。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523163801-llq3rxs\" data-node-index=\"35\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163833\"><div contenteditable=\"true\" spellcheck=\"false\">整个系统的诞生是一个不断优化的过程，我们需要先解决有的问题，再持续进行优化。</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-subtype=\"u\" data-node-id=\"20220523163753-isc023j\" data-node-index=\"36\" data-type=\"NodeList\" class=\"list\" updated=\"20220523163753\"><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523163753-gtxlc6a\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163753\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523163753-dsitadn\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163753\"><div contenteditable=\"true\" spellcheck=\"false\">继续对系统进行基准测试和监控，以在瓶颈出现时解决它们</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-marker=\"*\" data-subtype=\"u\" data-node-id=\"20220523163753-5zhtpg7\" data-type=\"NodeListItem\" class=\"li\" updated=\"20220523163753\"><div class=\"protyle-action\" draggable=\"true\"><svg><use xlink:href=\"#iconDot\"></use></svg></div><div data-node-id=\"20220523163753-45cy9vf\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163753\"><div contenteditable=\"true\" spellcheck=\"false\">扩展是一个迭代的过程</div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div><div data-node-id=\"20220523163836-ybs58bt\" data-node-index=\"37\" data-type=\"NodeParagraph\" class=\"p\" updated=\"20220523163836\"><div contenteditable=\"true\" spellcheck=\"false\"></div><div class=\"protyle-attr\" contenteditable=\"false\">​</div></div>","field":{"slug":"/topic/系统设计/样例/短链系统","topic":"系统设计"},"frontmatter":{"title":"短链系统","tags":["系统设计","样例"],"date":"2022-05-23","description":"短链系统设计看起来简单，但是每个点都能展开很多知识点。短链是通过访问服务器上的链接，通过Http返回的302Code，对链接进行重定向，然后访问到对应的地址上。 sequenceDiagram 客户端->>短链服务器: 访问A 短链服务器-..."}},"topic":{"title":"系统设计","tree":"{\"title\":\"系统设计\",\"id\":\"20220523142842-5ohvsi1\",\"parentId\":\"\",\"href\":\"/topic/系统设计\",\"path\":\"/topic/系统设计\",\"children\":[{\"title\":\"样例\",\"id\":\"20220523161014-1vkr1si\",\"type\":\"d\",\"href\":\"/topic/系统设计/样例\",\"parentId\":\"\",\"path\":\"/topic/系统设计/样例\",\"parentPath\":\"/topic/系统设计\",\"sort\":1,\"children\":[{\"title\":\"短链系统\",\"id\":\"20220523142856-tm0dduf\",\"type\":\"d\",\"href\":\"/topic/系统设计/样例/短链系统\",\"parentId\":\"\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"sort\":1,\"children\":[{\"title\":\"概述用例和约束\",\"id\":\"20220523152802-ora3luz\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#概述用例和约束\",\"parentId\":\"20220523142856-tm0dduf\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[{\"title\":\"用例\",\"id\":\"20220523153231-cqe7c6z\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#用例\",\"parentId\":\"20220523152802-ora3luz\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"约束和假设\",\"id\":\"20220523153213-tyokdre\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#约束和假设\",\"parentId\":\"20220523152802-ora3luz\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"预估容量\",\"id\":\"20220523153245-akx221a\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#预估容量\",\"parentId\":\"20220523152802-ora3luz\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4}],\"level\":3},{\"title\":\"创建一个高层次设计\",\"id\":\"20220523154027-n2m6mb0\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#创建一个高层次设计\",\"parentId\":\"20220523142856-tm0dduf\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":3},{\"title\":\"设计核心组件\",\"id\":\"20220523155756-as6zfq4\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#设计核心组件\",\"parentId\":\"20220523142856-tm0dduf\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[{\"title\":\"用例: 用户输入一段文本，然后得到一个随机生成的链接\",\"id\":\"20220523155920-i5awrmn\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#用例: 用户输入一段文本，然后得到一个随机生成的链接\",\"parentId\":\"20220523155756-as6zfq4\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"用例：用户输入一个 paste 的 url 后可以看到它存储的内容\",\"id\":\"20220523160445-ppzjfcg\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#用例：用户输入一个 paste 的 url 后可以看到它存储的内容\",\"parentId\":\"20220523155756-as6zfq4\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"用例： 服务跟踪分析页面\",\"id\":\"20220523160523-x0zwdli\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#用例： 服务跟踪分析页面\",\"parentId\":\"20220523155756-as6zfq4\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"用例： 服务删除过期的 pastes\",\"id\":\"20220523160541-cln3fph\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#用例： 服务删除过期的 pastes\",\"parentId\":\"20220523155756-as6zfq4\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4}],\"level\":3},{\"title\":\"扩展设计\",\"id\":\"20220523160546-vbv6n9j\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#扩展设计\",\"parentId\":\"20220523142856-tm0dduf\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":3},{\"title\":\"总结\",\"id\":\"20220523163729-9u3wkrv\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/短链系统#总结\",\"parentId\":\"20220523142856-tm0dduf\",\"path\":\"/topic/系统设计/样例/短链系统\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":3}],\"level\":2},{\"title\":\"微博架构设计\",\"id\":\"20220524140048-zkiqvui\",\"type\":\"d\",\"href\":\"/topic/系统设计/样例/微博架构设计\",\"parentId\":\"\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"sort\":2,\"children\":[{\"title\":\"概述用例和约束\",\"id\":\"20220524140533-yb6pk63\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#概述用例和约束\",\"parentId\":\"20220524140048-zkiqvui\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[{\"title\":\"用例\",\"id\":\"20220524140955-hl15d6z\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#用例\",\"parentId\":\"20220524140533-yb6pk63\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"限制条件与假设\",\"id\":\"20220524142056-m6nm6xm\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#限制条件与假设\",\"parentId\":\"20220524140533-yb6pk63\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4}],\"level\":3},{\"title\":\"概要设计\",\"id\":\"20220524145303-hrsunb1\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#概要设计\",\"parentId\":\"20220524140048-zkiqvui\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":3},{\"title\":\"设计核心组件\",\"id\":\"20220524154837-c7lw852\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#设计核心组件\",\"parentId\":\"20220524140048-zkiqvui\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[{\"title\":\"用例: 用户发表了一篇微博\",\"id\":\"20220524155958-ygnj4py\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#用例: 用户发表了一篇微博\",\"parentId\":\"20220524154837-c7lw852\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"用例：用户浏览聚合主页时间轴\",\"id\":\"20220524163832-k1u2urx\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#用例：用户浏览聚合主页时间轴\",\"parentId\":\"20220524154837-c7lw852\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"用例：用户浏览用户时间轴\",\"id\":\"20220524164247-audibq3\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#用例：用户浏览用户时间轴\",\"parentId\":\"20220524154837-c7lw852\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4},{\"title\":\"用例：用户搜索关键词\",\"id\":\"20220524164312-1obgv97\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#用例：用户搜索关键词\",\"parentId\":\"20220524154837-c7lw852\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":4}],\"level\":3},{\"title\":\"架构扩展\",\"id\":\"20220524164325-q9o9ung\",\"type\":\"h\",\"href\":\"/topic/系统设计/样例/微博架构设计#架构扩展\",\"parentId\":\"20220524140048-zkiqvui\",\"path\":\"/topic/系统设计/样例/微博架构设计\",\"parentPath\":\"/topic/系统设计/样例\",\"children\":[],\"level\":3}],\"level\":2}],\"level\":1},{\"title\":\"每个程序员都应该知道的延迟数字\",\"id\":\"20220524194105-29b5zns\",\"type\":\"d\",\"href\":\"/topic/系统设计/每个程序员都应该知道的延迟数字\",\"parentId\":\"\",\"path\":\"/topic/系统设计/每个程序员都应该知道的延迟数字\",\"parentPath\":\"/topic/系统设计\",\"children\":[],\"level\":1}],\"level\":0}"}},"pageContext":{"slug":"/topic/系统设计/样例/短链系统","topic":"系统设计"}},"staticQueryHashes":["1284643331","2841359383"]}