{"version":3,"file":"component---src-pages-posts-search-tsx-31ba59f5114c526f9014.js","mappings":"wNAWMA,GAAOC,EAAAA,EAAAA,IAAO,WA6FpB,UApF6B,WAE3B,IAAMC,GAAgBC,EAAAA,EAAAA,IAASC,EAAAA,GACzBC,GAAgBF,EAAAA,EAAAA,IAASG,EAAAA,GACzBC,GAAOC,EAAAA,EAAAA,MAEb,EAA4BN,EAAcO,MAAlCA,EAAR,EAAQA,MAAR,IAAeC,KAAAA,OAAf,MAAsB,EAAtB,EAEMC,EAAYD,EAAO,EAErBE,EAAeC,MAAMC,KAAKT,EAAcU,aAAaC,UAErDP,IACFG,EAAeA,EAAaK,QAAO,SAACC,GAElC,QAAIA,EAAMC,MAAK,SAACC,GAAD,OACbA,EAAQC,YAAYC,MAAMC,cAAcC,SAASf,EAAMc,qBAKrDL,EAAMC,MAAK,SAACC,GAAD,OACgB,OAA7BA,EAAQC,YAAYI,MACjBL,EAAQC,YAAYI,KAAKN,MAAM,SAACO,GAAD,OAChCrB,EAAcsB,sBAAsBD,GAAKP,MAAK,SAACS,GAAD,OAC5CA,EAAYL,cAAcC,SAASf,EAAMc,4BAYnDX,EAAaiB,MAAK,SAACC,EAAGC,GAAJ,OAChB,IAAIC,KAAKD,EAAE,GAAGV,YAAYY,MAAMC,UAC/B,IAAIF,KAAKF,EAAE,GAAGT,YAAYY,MAAMC,aAEnC,IAAMC,EAAavB,EAAawB,OAE1BC,EAAYC,KAAKC,KAAKJ,EA7Cb,GAqDf,OALAvB,EAAeA,EAAa4B,MAhDb,EAiDb7B,EAjDa,EAkDbA,EAlDa,GAsDb8B,EAAAA,cAACC,EAAAA,EAAD,KACED,EAAAA,cAACE,EAAAA,EAAD,CACErB,MAAOf,EAAKqC,UAAU5C,EAAK,SAAU,CAACS,MAExCgC,EAAAA,cAAAA,KAAAA,KACEA,EAAAA,cAACI,EAAAA,GAAD,CAAWC,GAAI9C,EAAK,SAAU+C,KAAM,CAClCN,EAAAA,cAAAA,SAAAA,CAAQO,IAAK,SAAUvC,OAI3BgC,EAAAA,cAAAA,QAAAA,KACEA,EAAAA,cAACI,EAAAA,GAAD,CAAWC,GAAI9C,EAAK,QAAS+C,KAAM,CACjCZ,MAIJM,EAAAA,cAAAA,KAAAA,MACAA,EAAAA,cAACQ,EAAAA,EAAD,CACEC,IAAKtC,EAAauC,KAAI,SAACC,GAAD,OAAOA,EAAE,GAAG/B,YAAYyB,MAC9CT,UAAWA,EACX1B,UAAWD,EAAO,EAClB2C,OAAQ,SAACC,GACP,IAEMC,EAAI,kBADO,SADIC,mBAAmB/C,GAAS,IAChC,UAAiC6C,EAAU,IAE5D,OAAO,kBAAMG,EAAAA,EAAAA,UAASF","sources":["webpack://ztianzeng.com/./src/pages/posts/search.tsx"],"sourcesContent":["import { navigate } from \"gatsby\";\nimport React from \"react\";\nimport { useStore } from \"simstate\";\n\nimport ArticleItemList from \"@/components/Article/ArticleItemList\";\nimport { PageMetadata } from \"@/components/PageMetadata\";\nimport { Localized, prefix, useI18n } from \"@/i18n\";\nimport ArticleListLayout from \"@/layouts/ArticleListLayout\";\nimport LocationStore from \"@/stores/LocationStore\";\nimport MetadataStore from \"@/stores/MetadataStore\";\n\nconst root = prefix(\"search.\");\n\ninterface Query {\n  query?: string;\n  page?: number;\n}\n\nconst pageSize = 5;\n\nconst SearchPage: React.FC = () => {\n\n  const locationStore = useStore(LocationStore);\n  const metadataStore = useStore(MetadataStore);\n  const i18n = useI18n();\n\n  const { query, page = 1 } = locationStore.query as Query;\n\n  const pageIndex = page - 1;\n\n  let searchResult = Array.from(metadataStore.articleIdMap.values());\n\n  if (query) {\n    searchResult = searchResult.filter((posts) => {\n      // filter according to title\n      if (posts.some((article) =>\n        article.frontmatter.title.toUpperCase().includes(query.toUpperCase()))) {\n        return true;\n      }\n\n      // filter according to tag\n      if (posts.some((article) =>\n        article.frontmatter.tags !== null // article has tags\n        && article.frontmatter.tags.some(((tag) => // one of the tag satisfies:\n          metadataStore.getAllVariationsOfTag(tag).some((existingTag) =>\n            existingTag.toUpperCase().includes(query.toUpperCase()),\n          )\n        )),\n      )) {\n        return true;\n      }\n\n      // add more filters here\n      return false;\n    });\n  }\n\n  searchResult.sort((a, b) =>\n    new Date(b[0].frontmatter.date).getTime() -\n     new Date(a[0].frontmatter.date).getTime());\n\n  const totalCount = searchResult.length;\n\n  const pageCount = Math.ceil(totalCount / pageSize);\n\n  // pagination\n  searchResult = searchResult.slice(\n    pageIndex * pageSize,\n    pageIndex * pageSize + pageSize,\n  );\n\n  return (\n    <ArticleListLayout>\n      <PageMetadata\n        title={i18n.translate(root(\"title\"), [query]) as string}\n      />\n      <h3>\n        <Localized id={root(\"title\")} args={[\n          <strong key={\"query\"}>{query}</strong>,\n        ]}\n        />\n      </h3>\n      <small>\n        <Localized id={root(\"info\")} args={[\n          totalCount,\n        ]}\n        />\n      </small>\n      <hr />\n      <ArticleItemList\n        ids={searchResult.map((x) => x[0].frontmatter.id)}\n        pageCount={pageCount}\n        pageIndex={page - 1}\n        toPage={(pageNum) => {\n          const queryEncoded = encodeURIComponent(query || \"\");\n          const querystring = `query=${queryEncoded}&page=${pageNum + 1}`;\n          const path = `/posts/search?${querystring}`;\n          return () => navigate(path);\n        }}\n      />\n    </ArticleListLayout>\n  );\n};\n\nexport default SearchPage;\n"],"names":["root","prefix","locationStore","useStore","LocationStore","metadataStore","MetadataStore","i18n","useI18n","query","page","pageIndex","searchResult","Array","from","articleIdMap","values","filter","posts","some","article","frontmatter","title","toUpperCase","includes","tags","tag","getAllVariationsOfTag","existingTag","sort","a","b","Date","date","getTime","totalCount","length","pageCount","Math","ceil","slice","React","ArticleListLayout","PageMetadata","translate","Localized","id","args","key","ArticleItemList","ids","map","x","toPage","pageNum","path","encodeURIComponent","navigate"],"sourceRoot":""}