{
    "componentChunkName": "component---src-templates-topic-page-template-tsx",
    "path": "/topic/系统设计/样例/微博架构设计",
    "result": {"pageContext":{"id":"/topic/系统设计/样例/微博架构设计","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"微博架构设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"微博日活跃用户1.6亿+，每日访问量达百亿级，面对庞大用户群的海量访问，需要有良好的架构设计来支撑微博这庞大的访问量。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概述用例和约束"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"发布了一条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"服务"}]},{"type":"text","value":"将微博推送给关注者，并且进行手机推送"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"浏览自己的微博列表"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"浏览主页的微博列表（聚合关注的人的微博）"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"可以通过关键词搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"服务"}]},{"type":"text","value":"应该具有高可用性"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"限制条件与假设"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"普遍情况"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"网络流量不是均匀分布的"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"发布微博的速度需要足够快速"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"除非有上百万的关注者，否则将微博推送给粉丝的速度要足够快"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1 亿个活跃用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每天新发布 5 亿条微博，每月新发布 150 亿条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"平均每条微博需要推送给 5 个人"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每天需要进行 50 亿次推送"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月需要进行 1500 亿次推送"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月需要处理 2500 亿次读取请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月需要处理 100 亿次搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"浏览功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"浏览的速度需要足够快"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"读取的负载远大于写入的负载"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索的速度需要足够快"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索是高负载的读取功能"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"计算用量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每条微博的大小："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"weibo_id"}]},{"type":"text","value":" - 8 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"user_id"}]},{"type":"text","value":" - 32 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"text"}]},{"type":"text","value":" - 140 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"media"}]},{"type":"text","value":" - 平均 10 KB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"总计： 大约 10 KB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月产生新微博的内容为 150 TB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每条微博 10 KB * 每天 5 亿条微博* 每月 30 天"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"3 年产生的内容为 5.4 PB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒需要处理 10 万次读取请求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月需要处理 2500 亿次请求 * (每秒 400 次请求 / 每月 10 亿次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒发布 6000 条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月发布 150 亿条微博 * (每秒 400 次请求 / 每月 10 次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒推送 6 万条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月推送 1500 亿条微博 * (每秒 400 次请求 / 每月 10 亿次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒 4000 次搜索请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概要设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"graph TD;\n\tClient-->WebServer;\n\tWebServer-->WriteAPI;\n\tWebServer-->ReadAPI;\n\tReadAPI-->TimeLineService;\n\tTimeLineService-->WeiboInfoService;\n\tTimeLineService-->UserInfoService;\n\tTimeLineService-->MemoryCache;\n\tWriteAPI-->FansService;\n\tFansService-->MemoryCache;\n\tFansService-->UserGraphService;\n\tFansService-->SearchService;\n\tSearchAPI-->SearchService;\n\tFansService-->NotificationService;\n\tWebServer-->SearchAPI;\n\tReadAPI-->MySQL;\n\tWriteAPI-->MySQL;\n\tFansService-->OSS;\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"设计核心组件"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例: 用户发表了一篇微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们可以简单的先将数据存储到MySQL中。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查看当前用户的关注的人发的微博以及推送数据是非常麻烦的事情。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"根据预估容量，每秒大概会产生6万条数据，这个操作一般的关系型数据库可能会支撑不住，因此可以通过NoSQL数据库或者内存数据库来对数据进行存储。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"而且对于微博架构这种，大V发送了微博远比普通的用户发送的微博带来的影响大，会造成数据的倾斜。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"一般情况下处理这种情况下会采用推拉结合的模式来进行处理:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"推模式"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果用户被关注的人少，发送了微博，就直接将微博发送到各个人的收件箱中"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"拉模式"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果用户被关注的人多，发送了微博就存储在自己的发件箱里，关注的人拉取自己的关注的人时在对关注的人的发件箱和自己的收件箱进行一个聚合"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"处了数据模型，还需要对静态文件进行一个处理，可以借助于三方的对象存储来存储照片和视频之类的媒体文件。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向应用反向代理的"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发送一条微博"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"服务器将微博使用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"存储于用户收件箱"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"调用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"消息输出服务"}]},{"type":"text","value":" ，进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户服务"}]},{"type":"text","value":"找到存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中的此用户的粉丝"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将微博存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中的"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"此用户的粉丝的主页TimeLine"}]},{"type":"text","value":"中"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"O(n) 复杂度操作： 1000 名粉丝 = 1000 次查找与插入"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将微博数据存储在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索索引服务"}]},{"type":"text","value":"中，以加快搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将媒体存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"对象存储"}]},{"type":"text","value":"中"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"通知服务"}]},{"type":"text","value":"向粉丝发送推送："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"队列"}]},{"type":"text","value":"异步推送通知"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户浏览聚合主页时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发起一次读取主页的请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器调用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"TimeLine服务"}]},{"type":"text","value":"进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"读取时间轴数据，其中包括微博id 与用户 id - O(1)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"通过 "},{"type":"element","tagName":"a","properties":{"href":"http://redis.io/commands/mget"},"children":[{"type":"text","value":"multiget"}]},{"type":"text","value":" 向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"微博信息服务"}]},{"type":"text","value":"进行查询，以获取相关 id 微博的额外信息 - O(n)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"通过 muiltiget 向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户信息服务"}]},{"type":"text","value":"进行查询，以获取相关 id 用户的额外信息 - O(n)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户浏览用户时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发起获得用户时间线的请求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"从 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"中取出用户的TimeLine"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户搜索关键词"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"将搜索请求发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索 API"}]},{"type":"text","value":"调用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索服务"}]},{"type":"text","value":"进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对输入进行转换与分词，弄明白需要搜索什么东西"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"移除标点等额外内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"将文本打散为词组"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"修正拼写错误"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"规范字母大小写"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"将查询转换为布尔操作"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索集群"}]},{"type":"text","value":" （例如Lucene、ES）检索结果："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"对集群内的所有服务器进行查询，将有结果的查询进行聚合（Scatter gathers）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"合并取到的条目，进行评分与排序，最终返回结果"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"架构扩展"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"消息发送服务"}]},{"type":"text","value":"有可能成为性能瓶颈。那些有着百万数量关注着的用户可能发一条微博就需要好几分钟才能完成消息的发送进程。这有可能使 @回复 这种微博时出现竞争条件，因此需要根据服务时间进行重排序来降低影响。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们还可以避免从高关注量的用户输出。相反，我们可以通过搜索来找到高关注量用户的微博，并将搜索结果与用户的主页时间轴合并，再根据时间对其进行排序。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"此外，还可以通过以下内容进行优化："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅为每个主页时间轴在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中存储数百条数据"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中存储活动用户的主页时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果某个用户在过去 30 天都没有产生活动，那我们可以使用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"重新构建他的时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户服务"}]},{"type":"text","value":"来查询并确定用户关注的人"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"中取出推特，并将它们存入"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"微博信息服务"}]},{"type":"text","value":"中存储一个月的推特"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户信息服务"}]},{"type":"text","value":"中存储活动用户的信息"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索集群"}]},{"type":"text","value":"需要将推特保留在内存中，以降低延迟"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们还可以考虑优化 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 来解决一些瓶颈问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"能减小一些数据库的负载，靠 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL Read 副本"}]},{"type":"text","value":"已经足够处理缓存未命中情况。我们还可以考虑使用一些额外的 SQL 性能拓展技术。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"高容量的写入将淹没单个的 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 写主从"}]},{"type":"text","value":"模式，因此需要更多的拓展技术。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"除此之外，还需要对热点事件造成的流量突增进行处理。可以采用容器化进行部署，流量或者负载达到一定程度就扩容。"}]}],"data":{"quirksMode":false}},"headings":[{"depth":1,"value":"微博架构设计","slug":"微博架构设计"},{"depth":1,"value":"概述用例和约束","slug":"概述用例和约束"},{"depth":2,"value":"用例","slug":"用例"},{"depth":2,"value":"限制条件与假设","slug":"限制条件与假设"},{"depth":1,"value":"概要设计","slug":"概要设计"},{"depth":1,"value":"设计核心组件","slug":"设计核心组件"},{"depth":2,"value":"用例: 用户发表了一篇微博","slug":"用例-用户发表了一篇微博"},{"depth":2,"value":"用例：用户浏览聚合主页时间轴","slug":"用例用户浏览聚合主页时间轴"},{"depth":2,"value":"用例：用户浏览用户时间轴","slug":"用例用户浏览用户时间轴"},{"depth":2,"value":"用例：用户搜索关键词","slug":"用例用户搜索关键词"},{"depth":1,"value":"架构扩展","slug":"架构扩展"}]}},
    "staticQueryHashes": ["928362550"]}