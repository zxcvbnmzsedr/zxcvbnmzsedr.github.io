(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{375:function(s,e,a){"use strict";a.r(e);var t=a(7),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"pgsql临时关闭主键约束"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pgsql临时关闭主键约束"}},[s._v("#")]),s._v(" PGSQL临时关闭主键约束")]),s._v(" "),e("p",[s._v("有时候，在 PostgreSQL 数据库中，我们可能需要在特定情况下临时关闭主键约束。")]),s._v(" "),e("p",[s._v("这通常涉及到在流复制环境中执行一些特殊操作，而在这些情况下，我们可以通过调整 "),e("code",[s._v("session_replication_role")]),s._v("​ 参数来实现这一目的。")]),s._v(" "),e("h3",{attrs:{id:"了解-session-replication-role-参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#了解-session-replication-role-参数"}},[s._v("#")]),s._v(" 了解 session_replication_role 参数")]),s._v(" "),e("p",[e("code",[s._v("session_replication_role")]),s._v("​ 参数控制当前会话中复制角色的行为。它有三个可能的取值：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("origin")]),s._v("​：表示当前会话是主服务器，是官方推荐的默认值。")]),s._v(" "),e("li",[s._v("​"),e("code",[s._v("local")]),s._v("​：表示当前会话是本地，与主备关系无关。")]),s._v(" "),e("li",[s._v("​"),e("code",[s._v("replica")]),s._v("​：表示当前会话是从库，通常用于备用服务器。")])]),s._v(" "),e("p",[s._v("‍")]),s._v(" "),e("p",[s._v("在 PostgreSQL 官网的解释中，该参数控制复制相关触发器和规则的触发。在设置此参数时，需要超级用户特权，并且会导致任何先前缓存的查询计划被丢弃。")]),s._v(" "),e("h3",{attrs:{id:"临时关闭主键约束"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#临时关闭主键约束"}},[s._v("#")]),s._v(" 临时关闭主键约束")]),s._v(" "),e("p",[s._v("当我们将 "),e("code",[s._v("session_replication_role")]),s._v("​ 参数设置为 "),e("code",[s._v("replica")]),s._v("​ 时，即当前会话被标识为从库角色时，数据库会禁用与复制相关的触发器和规则。这包括外键，因为在 PostgreSQL 中，外键的实现本质上就是触发器。")]),s._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 将当前会话的复制角色设置为从库")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" session_replication_role "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" replica"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),e("h3",{attrs:{id:"恢复主键约束"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#恢复主键约束"}},[s._v("#")]),s._v(" 恢复主键约束")]),s._v(" "),e("p",[s._v("在完成需要临时关闭主键约束的操作后，务必将 "),e("code",[s._v("session_replication_role")]),s._v("​ 参数恢复到原始值，以确保数据库恢复正常的主备复制关系。")]),s._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 恢复当前会话的复制角色为默认值（主服务器）")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" session_replication_role "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" origin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),e("p",[s._v("总体而言，通过合理使用 "),e("code",[s._v("session_replication_role")]),s._v("​ 参数，我们可以在需要时灵活地控制数据库行为，临时关闭主键约束是其中之一。然而，务必小心使用这样的设置，以避免对数据库完整性造成不可逆的影响。")])])}),[],!1,null,null,null);e.default=r.exports}}]);