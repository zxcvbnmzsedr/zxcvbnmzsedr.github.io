{
    "componentChunkName": "component---src-templates-topic-page-template-tsx",
    "path": "/topic/系统设计/4S分析法",
    "result": {"pageContext":{"id":"/topic/系统设计/4S分析法","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"以Twitter为案例，来作为一个分析"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"element","tagName":"u","properties":{},"children":[{"type":"text","value":"Scenario"}]},{"type":"text","value":"场景"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要设计哪些功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将功能列举出来，并进行排列，因为在一场中不可能让你设计整个系统，只能设计系统中的某几个最重要的模块"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要承受多大的访问量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"承载的访问量的大小决定了采用中间件去实现我们的系统，不同的承载量所需要的中间件和设备都是不一样的，所以系统设计并没有最合适的架构，只有在衡量成本和收益之后设计出来的最符合当下情况的最合适的架构"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"需要设计哪些功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　第一步列举功能:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"注册、登录"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"用户个人页面展示、编辑"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"上传图片、视频"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"搜索"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"发送分享Twitter内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"TimeLine和News Feed"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"关注和取消关注用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　第二步骤，功能排序，选出核心功能:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"发送Twitter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"TimeLine展示"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"News Feed推送"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"关注和取消关注用户"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"注册登录"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"需要承受的访问量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　我们需要对访问量进行一个估算，下面大致是估算方式 :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"并发用户Concurrent User"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"日活跃用户数量 * 每个用户平均请求次数 / 一天多少秒 = 1M * 60 / 86100 $\\approx$ 700K"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"峰值 = Average Concurrent User * 3 $\\approx$ 2100K"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"读频率Read QPS （Queries Per Second）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"700K"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"写频率Write QPS"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"5K"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　这样就大致分析出需要承载的QPS。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　下面是一些硬件或者软件能够承载的QPS数量:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS=100"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"笔记本电脑"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS=1k"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Web服务器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"需要考虑单点故障"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS=1m"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"建设1000台的服务器集群"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"需要考虑集群维护成本，如何对资源进行调度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS和WebServer 、Database之间的关系"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一台Web Server承受量是1k的QPS，实际上如果能扛得住100个QPS已经很牛逼了"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一台SQL Database承受量是1k QPS左右"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个NoSQL集群（Elasticsearch）承受量是10W左右"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"内存数据库（Redis）100W QPS左右"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　通过这些预估的QPS数量，就能够估算出所需要的机器。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Service服务"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　将大系统拆分成一个个小服务。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220614190843.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"重放需求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"重新过一遍每个需求，为每个需求添加一个服务，用于处理内部逻辑"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"归并需求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"归并相同的服务，对同一类问题的逻辑处理归并在同一个Service中"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将整个系统切分成若干个小的Service"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Storage存储"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　对于我们写的Service而言，写的是具象化的程序，而程序=算法+数据结构。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　但是对于系统而言，系统=服务+数据存储。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　所以确定存储结构和介质尤为重要。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"处理步骤"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第一步：为每个Service选择存储结构"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"数据库系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"关系型数据库 SQL DataBase"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"用户信息"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"非关系数据库"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"推文"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"社交图谱"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"文件系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"图片、视频、Media Files"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"缓存系统Cache"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"不支持数据持久化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"但是效率高，内存级别的访问速度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615103234.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第二步：细化表结构"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615131659.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"存储模型"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Pull Model 拉模型"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615151033.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"算法:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在用户查看News Feed时，获取每一个好友的前100条Tweets，用K路归并算法进行合并，合并出前100条News Feeds"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"复杂度分析"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"获取News Feed ，如果有N个关注对象，则为N次DB Reads的时间 + K路归并的时间（可以忽略，因为DB Read花费时间更多）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"发布Tweet ，1次DB Write的时间"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Scala扩展设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Optimize 优化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Maintenance 维护"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"处理步骤"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第一步：优化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"解决设计缺陷"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Pull 和 Push 模式的局限性"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"更多的功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Like、Follow & Unfollow、Ads"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"特殊情况"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"僵尸粉、热搜"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第二部：维护"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"健壮性"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"服务器或者数据库挂了"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"扩展性"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"应对流量暴增的情况"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Pull的缺陷"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615151033.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　在用户进行读请求时，会访问每个关注的人的DB，所以这一块将会成为瓶颈"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在访问DB之前，加入Cache"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"缓存每个用户的TimeLine"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"N次DB请求 转化为 N次Cache请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"缓存每个用户的News Feeds"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"没有Cache News Feed的用户：归并N个用户最近的100条Tweets，取出结果前的100条"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"有Cache News Feed的用户：归并N个用户在某个时间戳之后的所有Tweets"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Push的缺陷"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615151122.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　在用户发布一篇文章时，会向关注者的TimeLine中都插入一条Tweets。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"会浪费更多的存储空间"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个人那都会有一条Tweets数据"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"存储相对内存便宜，可以接受"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"不活跃用户的问题"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"导致每个人收到的时间不一样"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"粉丝数量超级大，亿级"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"插入的时长即使异步，也非常慢"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"切换回Pull模式，需要Trade Off ： Pull 和 Push成本"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"处理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"最小改动"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"扩展机器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Push的话，将需要插入的Tweets分布到多台机器上，并行插入"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Pull的话，增加Cache容量"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"增长预估"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　对当前业务量的增长率进行一个预判，衡量是采用Pull还是Push，如果实在太大，考虑Push结合Pull进行优化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"普通用户使用Push方案进行处理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"标记大V用户，采用Pull方式进行处理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"用户查询，合并自己的TimeLine + 大V的TimeLine"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　相对来说混用的模型实现上会比单纯的复杂。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}},"html":"<p updated=\"20220808111208\">　　以Twitter为案例，来作为一个分析</p>\n<h1 id=\"Scenario场景\"><u>Scenario</u>场景</h1>\n<ol updated=\"20220808111208\">\n<li id=\"20220808111208-cxk4286\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要设计哪些功能</p>\n<p updated=\"20220808111208\">将功能列举出来，并进行排列，因为在一场中不可能让你设计整个系统，只能设计系统中的某几个最重要的模块</p>\n</li>\n<li id=\"20220808111208-miimabu\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要承受多大的访问量</p>\n<p updated=\"20220808111208\">承载的访问量的大小决定了采用中间件去实现我们的系统，不同的承载量所需要的中间件和设备都是不一样的，所以系统设计并没有最合适的架构，只有在衡量成本和收益之后设计出来的最符合当下情况的最合适的架构</p>\n</li>\n</ol>\n<h2 id=\"需要设计哪些功能\">需要设计哪些功能</h2>\n<p updated=\"20220808111208\">　　第一步列举功能:</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-pswj522\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">注册、登录</p>\n</li>\n<li id=\"20220808111208-gf1sdoz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">用户个人页面展示、编辑</p>\n</li>\n<li id=\"20220808111208-r1qpz4r\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">上传图片、视频</p>\n</li>\n<li id=\"20220808111208-p9warwi\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">搜索</p>\n</li>\n<li id=\"20220808111208-leg8pn2\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">发送分享Twitter内容</p>\n</li>\n<li id=\"20220808111208-wv44c0c\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">TimeLine和News Feed</p>\n</li>\n<li id=\"20220808111208-r01l8kl\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">关注和取消关注用户</p>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　第二步骤，功能排序，选出核心功能:</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-j9nz6o3\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">发送Twitter</p>\n</li>\n<li id=\"20220808111208-61wgt2k\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">TimeLine展示</p>\n</li>\n<li id=\"20220808111208-nsb2ncg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">News Feed推送</p>\n</li>\n<li id=\"20220808111208-akee6r1\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">关注和取消关注用户</p>\n</li>\n<li id=\"20220808111208-ept0syg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">注册登录</p>\n</li>\n</ul>\n<h2 id=\"需要承受的访问量\">需要承受的访问量</h2>\n<p updated=\"20220808111208\">　　我们需要对访问量进行一个估算，下面大致是估算方式 :</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-hho0wca\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">并发用户Concurrent User</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-kbgymoo\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">日活跃用户数量 * 每个用户平均请求次数 / 一天多少秒 = 1M * 60 / 86100 <span data-subtype=\"math\" data-content=\"\\approx\"></span> 700K</p>\n</li>\n<li id=\"20220808111208-st1nvy1\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">峰值 = Average Concurrent User * 3 <span data-subtype=\"math\" data-content=\"\\approx\"></span> 2100K</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-0aoju12\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">读频率Read QPS （Queries Per Second）</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-6o9rn5m\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">700K</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-krfc27z\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">写频率Write QPS</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-jtkasfv\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">5K</p>\n</li>\n</ul>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　这样就大致分析出需要承载的QPS。</p>\n<p updated=\"20220808111208\">　　下面是一些硬件或者软件能够承载的QPS数量:</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-2yvmp6h\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS=100</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-ywaankk\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">笔记本电脑</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-pldd8vh\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS=1k</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-bx83dtg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Web服务器</p>\n</li>\n<li id=\"20220808111208-sbm3olz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要考虑单点故障</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-yt4bj36\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS=1m</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-dxprdje\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">建设1000台的服务器集群</p>\n</li>\n<li id=\"20220808111208-rvnx1fj\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要考虑集群维护成本，如何对资源进行调度</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-52rtbxv\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS和WebServer 、Database之间的关系</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-89fvlqb\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">一台Web Server承受量是1k的QPS，实际上如果能扛得住100个QPS已经很牛逼了</p>\n</li>\n<li id=\"20220808111208-g9rp2ix\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">一台SQL Database承受量是1k QPS左右</p>\n</li>\n<li id=\"20220808111208-7fcag4e\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">一个NoSQL集群（Elasticsearch）承受量是10W左右</p>\n</li>\n<li id=\"20220808111208-q6z9d3m\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">内存数据库（Redis）100W QPS左右</p>\n</li>\n</ul>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　通过这些预估的QPS数量，就能够估算出所需要的机器。</p>\n<h1 id=\"Service服务\">Service服务</h1>\n<p updated=\"20220808111208\">　　将大系统拆分成一个个小服务。</p>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220614190843.png\" alt=\"\" /></span></p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-t2tp6f7\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">重放需求</p>\n<p updated=\"20220808111208\">重新过一遍每个需求，为每个需求添加一个服务，用于处理内部逻辑</p>\n</li>\n<li id=\"20220808111208-f1ruk2s\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">归并需求</p>\n<p updated=\"20220808111208\">归并相同的服务，对同一类问题的逻辑处理归并在同一个Service中</p>\n<p updated=\"20220808111208\">将整个系统切分成若干个小的Service</p>\n</li>\n</ul>\n<h1 id=\"Storage存储\">Storage存储</h1>\n<p updated=\"20220808111208\">　　对于我们写的Service而言，写的是具象化的程序，而程序=算法+数据结构。</p>\n<p updated=\"20220808111208\">　　但是对于系统而言，系统=服务+数据存储。</p>\n<p updated=\"20220808111208\">　　所以确定存储结构和介质尤为重要。</p>\n<h2 id=\"处理步骤\">处理步骤</h2>\n<h3 id=\"第一步-为每个Service选择存储结构\">第一步：为每个Service选择存储结构</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-z4xp06y\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">数据库系统</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-3xxd0py\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">关系型数据库 SQL DataBase</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-k9co7bq\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">用户信息</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-bwcw92l\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">非关系数据库</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-q4e7y1a\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">推文</p>\n</li>\n<li id=\"20220808111208-ml5najs\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">社交图谱</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-hjlvoai\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">文件系统</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-oxltqa7\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">图片、视频、Media Files</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-t7w1oam\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">缓存系统Cache</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-jzilh5a\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">不支持数据持久化</p>\n</li>\n<li id=\"20220808111208-i3hjedw\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">但是效率高，内存级别的访问速度</p>\n</li>\n</ul>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615103234.png\" alt=\"\" /></span></p>\n<h3 id=\"第二步-细化表结构\">第二步：细化表结构</h3>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615131659.png\" alt=\"\" /></span></p>\n<h2 id=\"存储模型\">存储模型</h2>\n<h3 id=\"Pull-Model-拉模型\">Pull Model 拉模型</h3>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615151033.png\" alt=\"\" /></span></p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-lpdcn5u\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">算法:</p>\n<p updated=\"20220808111208\">在用户查看News Feed时，获取每一个好友的前100条Tweets，用K路归并算法进行合并，合并出前100条News Feeds</p>\n</li>\n<li id=\"20220808111208-xduboy0\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">复杂度分析</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-v9s6a32\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">获取News Feed ，如果有N个关注对象，则为N次DB Reads的时间 + K路归并的时间（可以忽略，因为DB Read花费时间更多）</p>\n</li>\n<li id=\"20220808111208-dnkby06\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">发布Tweet ，1次DB Write的时间</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"Scala扩展设计\">Scala扩展设计</h1>\n<ol updated=\"20220808111208\">\n<li id=\"20220808111208-8qsfbi8\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Optimize 优化</p>\n</li>\n<li id=\"20220808111208-2jbcjuu\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Maintenance 维护</p>\n</li>\n</ol>\n<h2 id=\"处理步骤-\">处理步骤</h2>\n<h3 id=\"第一步-优化\">第一步：优化</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-a5niprj\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">解决设计缺陷</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-whf0m7p\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Pull 和 Push 模式的局限性</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-n49yc1e\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">更多的功能</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-r4knfu6\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Like、Follow &amp; Unfollow、Ads</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-n4ffnkm\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">特殊情况</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-ei0w0oo\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">僵尸粉、热搜</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"第二部-维护\">第二部：维护</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-c8xd84o\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">健壮性</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-c6gw2vq\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">服务器或者数据库挂了</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-4otktb8\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">扩展性</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-xnwij7j\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">应对流量暴增的情况</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Pull的缺陷\">Pull的缺陷</h2>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615151033.png\" alt=\"\" /></span></p>\n<p updated=\"20220808111208\">　　在用户进行读请求时，会访问每个关注的人的DB，所以这一块将会成为瓶颈</p>\n<ol updated=\"20220808111208\">\n<li id=\"20220808111208-2yg8rol\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">在访问DB之前，加入Cache</p>\n</li>\n<li id=\"20220808111208-0mvca5x\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">缓存每个用户的TimeLine</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-jr9rh79\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">N次DB请求 转化为 N次Cache请求</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-sq3n5vf\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">缓存每个用户的News Feeds</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-3rv1bhy\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">没有Cache News Feed的用户：归并N个用户最近的100条Tweets，取出结果前的100条</p>\n</li>\n<li id=\"20220808111208-78yrm5r\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">有Cache News Feed的用户：归并N个用户在某个时间戳之后的所有Tweets</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"Push的缺陷\">Push的缺陷</h2>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615151122.png\" alt=\"\" /></span></p>\n<p updated=\"20220808111208\">　　在用户发布一篇文章时，会向关注者的TimeLine中都插入一条Tweets。</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-mqa0bgu\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">会浪费更多的存储空间</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-zb8q57d\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">每个人那都会有一条Tweets数据</p>\n</li>\n<li id=\"20220808111208-w2kyx78\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">存储相对内存便宜，可以接受</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-ko24h35\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">不活跃用户的问题</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-8czcz64\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">导致每个人收到的时间不一样</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-mx0dcgj\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">粉丝数量超级大，亿级</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-uebfoeg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">插入的时长即使异步，也非常慢</p>\n</li>\n<li id=\"20220808111208-v3et3rz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">切换回Pull模式，需要Trade Off ： Pull 和 Push成本</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"处理\">处理</h2>\n<h3 id=\"最小改动\">最小改动</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-rgp1ipo\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">扩展机器</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-wunsd2w\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Push的话，将需要插入的Tweets分布到多台机器上，并行插入</p>\n</li>\n<li id=\"20220808111208-di66rjv\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Pull的话，增加Cache容量</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"增长预估\">增长预估</h3>\n<p updated=\"20220808111208\">　　对当前业务量的增长率进行一个预判，衡量是采用Pull还是Push，如果实在太大，考虑Push结合Pull进行优化</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-80q0isz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">普通用户使用Push方案进行处理</p>\n</li>\n<li id=\"20220808111208-xz0atqx\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">标记大V用户，采用Pull方式进行处理</p>\n</li>\n<li id=\"20220808111208-ayidic7\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">用户查询，合并自己的TimeLine + 大V的TimeLine</p>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　相对来说混用的模型实现上会比单纯的复杂。</p>\n","articleNode":{"field":{"contentType":"topic","topic":"系统设计"},"frontmatter":{"id":"/topic/系统设计/4S分析法","title":"4S分析法","date":"2022-05-31 17:52","absolute_path":"/topic/系统设计/4S分析法"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"以Twitter为案例，来作为一个分析"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"element","tagName":"u","properties":{},"children":[{"type":"text","value":"Scenario"}]},{"type":"text","value":"场景"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要设计哪些功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将功能列举出来，并进行排列，因为在一场中不可能让你设计整个系统，只能设计系统中的某几个最重要的模块"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要承受多大的访问量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"承载的访问量的大小决定了采用中间件去实现我们的系统，不同的承载量所需要的中间件和设备都是不一样的，所以系统设计并没有最合适的架构，只有在衡量成本和收益之后设计出来的最符合当下情况的最合适的架构"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"需要设计哪些功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　第一步列举功能:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"注册、登录"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"用户个人页面展示、编辑"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"上传图片、视频"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"搜索"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"发送分享Twitter内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"TimeLine和News Feed"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"关注和取消关注用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　第二步骤，功能排序，选出核心功能:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"发送Twitter"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"TimeLine展示"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"News Feed推送"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"关注和取消关注用户"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"注册登录"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"需要承受的访问量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　我们需要对访问量进行一个估算，下面大致是估算方式 :"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"并发用户Concurrent User"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"日活跃用户数量 * 每个用户平均请求次数 / 一天多少秒 = 1M * 60 / 86100 $\\approx$ 700K"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"峰值 = Average Concurrent User * 3 $\\approx$ 2100K"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"读频率Read QPS （Queries Per Second）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"700K"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"写频率Write QPS"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"5K"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　这样就大致分析出需要承载的QPS。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　下面是一些硬件或者软件能够承载的QPS数量:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS=100"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"笔记本电脑"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS=1k"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Web服务器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"需要考虑单点故障"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS=1m"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"建设1000台的服务器集群"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"需要考虑集群维护成本，如何对资源进行调度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"QPS和WebServer 、Database之间的关系"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一台Web Server承受量是1k的QPS，实际上如果能扛得住100个QPS已经很牛逼了"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一台SQL Database承受量是1k QPS左右"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个NoSQL集群（Elasticsearch）承受量是10W左右"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"内存数据库（Redis）100W QPS左右"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　通过这些预估的QPS数量，就能够估算出所需要的机器。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Service服务"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　将大系统拆分成一个个小服务。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220614190843.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"重放需求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"重新过一遍每个需求，为每个需求添加一个服务，用于处理内部逻辑"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"归并需求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"归并相同的服务，对同一类问题的逻辑处理归并在同一个Service中"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将整个系统切分成若干个小的Service"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Storage存储"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　对于我们写的Service而言，写的是具象化的程序，而程序=算法+数据结构。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　但是对于系统而言，系统=服务+数据存储。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　所以确定存储结构和介质尤为重要。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"处理步骤"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第一步：为每个Service选择存储结构"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"数据库系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"关系型数据库 SQL DataBase"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"用户信息"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"非关系数据库"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"推文"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"社交图谱"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"文件系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"图片、视频、Media Files"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"缓存系统Cache"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"不支持数据持久化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"但是效率高，内存级别的访问速度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615103234.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第二步：细化表结构"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615131659.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"存储模型"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Pull Model 拉模型"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615151033.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"算法:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在用户查看News Feed时，获取每一个好友的前100条Tweets，用K路归并算法进行合并，合并出前100条News Feeds"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"复杂度分析"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"获取News Feed ，如果有N个关注对象，则为N次DB Reads的时间 + K路归并的时间（可以忽略，因为DB Read花费时间更多）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"发布Tweet ，1次DB Write的时间"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Scala扩展设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Optimize 优化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Maintenance 维护"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"处理步骤"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第一步：优化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"解决设计缺陷"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Pull 和 Push 模式的局限性"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"更多的功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Like、Follow & Unfollow、Ads"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"特殊情况"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"僵尸粉、热搜"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"第二部：维护"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"健壮性"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"服务器或者数据库挂了"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"扩展性"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"应对流量暴增的情况"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Pull的缺陷"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615151033.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　在用户进行读请求时，会访问每个关注的人的DB，所以这一块将会成为瓶颈"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在访问DB之前，加入Cache"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"缓存每个用户的TimeLine"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"N次DB请求 转化为 N次Cache请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"缓存每个用户的News Feeds"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"没有Cache News Feed的用户：归并N个用户最近的100条Tweets，取出结果前的100条"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"有Cache News Feed的用户：归并N个用户在某个时间戳之后的所有Tweets"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Push的缺陷"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220615151122.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　在用户发布一篇文章时，会向关注者的TimeLine中都插入一条Tweets。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"会浪费更多的存储空间"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个人那都会有一条Tweets数据"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"存储相对内存便宜，可以接受"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"不活跃用户的问题"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"导致每个人收到的时间不一样"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"粉丝数量超级大，亿级"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"插入的时长即使异步，也非常慢"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"切换回Pull模式，需要Trade Off ： Pull 和 Push成本"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"处理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"最小改动"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"扩展机器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Push的话，将需要插入的Tweets分布到多台机器上，并行插入"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Pull的话，增加Cache容量"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"增长预估"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　对当前业务量的增长率进行一个预判，衡量是采用Pull还是Push，如果实在太大，考虑Push结合Pull进行优化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"普通用户使用Push方案进行处理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"标记大V用户，采用Pull方式进行处理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"用户查询，合并自己的TimeLine + 大V的TimeLine"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　相对来说混用的模型实现上会比单纯的复杂。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}},"html":"<p updated=\"20220808111208\">　　以Twitter为案例，来作为一个分析</p>\n<h1 id=\"Scenario场景\"><u>Scenario</u>场景</h1>\n<ol updated=\"20220808111208\">\n<li id=\"20220808111208-cxk4286\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要设计哪些功能</p>\n<p updated=\"20220808111208\">将功能列举出来，并进行排列，因为在一场中不可能让你设计整个系统，只能设计系统中的某几个最重要的模块</p>\n</li>\n<li id=\"20220808111208-miimabu\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要承受多大的访问量</p>\n<p updated=\"20220808111208\">承载的访问量的大小决定了采用中间件去实现我们的系统，不同的承载量所需要的中间件和设备都是不一样的，所以系统设计并没有最合适的架构，只有在衡量成本和收益之后设计出来的最符合当下情况的最合适的架构</p>\n</li>\n</ol>\n<h2 id=\"需要设计哪些功能\">需要设计哪些功能</h2>\n<p updated=\"20220808111208\">　　第一步列举功能:</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-pswj522\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">注册、登录</p>\n</li>\n<li id=\"20220808111208-gf1sdoz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">用户个人页面展示、编辑</p>\n</li>\n<li id=\"20220808111208-r1qpz4r\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">上传图片、视频</p>\n</li>\n<li id=\"20220808111208-p9warwi\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">搜索</p>\n</li>\n<li id=\"20220808111208-leg8pn2\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">发送分享Twitter内容</p>\n</li>\n<li id=\"20220808111208-wv44c0c\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">TimeLine和News Feed</p>\n</li>\n<li id=\"20220808111208-r01l8kl\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">关注和取消关注用户</p>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　第二步骤，功能排序，选出核心功能:</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-j9nz6o3\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">发送Twitter</p>\n</li>\n<li id=\"20220808111208-61wgt2k\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">TimeLine展示</p>\n</li>\n<li id=\"20220808111208-nsb2ncg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">News Feed推送</p>\n</li>\n<li id=\"20220808111208-akee6r1\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">关注和取消关注用户</p>\n</li>\n<li id=\"20220808111208-ept0syg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">注册登录</p>\n</li>\n</ul>\n<h2 id=\"需要承受的访问量\">需要承受的访问量</h2>\n<p updated=\"20220808111208\">　　我们需要对访问量进行一个估算，下面大致是估算方式 :</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-hho0wca\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">并发用户Concurrent User</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-kbgymoo\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">日活跃用户数量 * 每个用户平均请求次数 / 一天多少秒 = 1M * 60 / 86100 <span data-subtype=\"math\" data-content=\"\\approx\"></span> 700K</p>\n</li>\n<li id=\"20220808111208-st1nvy1\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">峰值 = Average Concurrent User * 3 <span data-subtype=\"math\" data-content=\"\\approx\"></span> 2100K</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-0aoju12\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">读频率Read QPS （Queries Per Second）</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-6o9rn5m\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">700K</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-krfc27z\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">写频率Write QPS</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-jtkasfv\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">5K</p>\n</li>\n</ul>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　这样就大致分析出需要承载的QPS。</p>\n<p updated=\"20220808111208\">　　下面是一些硬件或者软件能够承载的QPS数量:</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-2yvmp6h\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS=100</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-ywaankk\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">笔记本电脑</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-pldd8vh\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS=1k</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-bx83dtg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Web服务器</p>\n</li>\n<li id=\"20220808111208-sbm3olz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要考虑单点故障</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-yt4bj36\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS=1m</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-dxprdje\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">建设1000台的服务器集群</p>\n</li>\n<li id=\"20220808111208-rvnx1fj\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">需要考虑集群维护成本，如何对资源进行调度</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-52rtbxv\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">QPS和WebServer 、Database之间的关系</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-89fvlqb\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">一台Web Server承受量是1k的QPS，实际上如果能扛得住100个QPS已经很牛逼了</p>\n</li>\n<li id=\"20220808111208-g9rp2ix\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">一台SQL Database承受量是1k QPS左右</p>\n</li>\n<li id=\"20220808111208-7fcag4e\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">一个NoSQL集群（Elasticsearch）承受量是10W左右</p>\n</li>\n<li id=\"20220808111208-q6z9d3m\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">内存数据库（Redis）100W QPS左右</p>\n</li>\n</ul>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　通过这些预估的QPS数量，就能够估算出所需要的机器。</p>\n<h1 id=\"Service服务\">Service服务</h1>\n<p updated=\"20220808111208\">　　将大系统拆分成一个个小服务。</p>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220614190843.png\" alt=\"\" /></span></p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-t2tp6f7\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">重放需求</p>\n<p updated=\"20220808111208\">重新过一遍每个需求，为每个需求添加一个服务，用于处理内部逻辑</p>\n</li>\n<li id=\"20220808111208-f1ruk2s\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">归并需求</p>\n<p updated=\"20220808111208\">归并相同的服务，对同一类问题的逻辑处理归并在同一个Service中</p>\n<p updated=\"20220808111208\">将整个系统切分成若干个小的Service</p>\n</li>\n</ul>\n<h1 id=\"Storage存储\">Storage存储</h1>\n<p updated=\"20220808111208\">　　对于我们写的Service而言，写的是具象化的程序，而程序=算法+数据结构。</p>\n<p updated=\"20220808111208\">　　但是对于系统而言，系统=服务+数据存储。</p>\n<p updated=\"20220808111208\">　　所以确定存储结构和介质尤为重要。</p>\n<h2 id=\"处理步骤\">处理步骤</h2>\n<h3 id=\"第一步-为每个Service选择存储结构\">第一步：为每个Service选择存储结构</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-z4xp06y\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">数据库系统</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-3xxd0py\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">关系型数据库 SQL DataBase</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-k9co7bq\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">用户信息</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-bwcw92l\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">非关系数据库</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-q4e7y1a\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">推文</p>\n</li>\n<li id=\"20220808111208-ml5najs\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">社交图谱</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-hjlvoai\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">文件系统</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-oxltqa7\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">图片、视频、Media Files</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-t7w1oam\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">缓存系统Cache</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-jzilh5a\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">不支持数据持久化</p>\n</li>\n<li id=\"20220808111208-i3hjedw\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">但是效率高，内存级别的访问速度</p>\n</li>\n</ul>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615103234.png\" alt=\"\" /></span></p>\n<h3 id=\"第二步-细化表结构\">第二步：细化表结构</h3>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615131659.png\" alt=\"\" /></span></p>\n<h2 id=\"存储模型\">存储模型</h2>\n<h3 id=\"Pull-Model-拉模型\">Pull Model 拉模型</h3>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615151033.png\" alt=\"\" /></span></p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-lpdcn5u\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">算法:</p>\n<p updated=\"20220808111208\">在用户查看News Feed时，获取每一个好友的前100条Tweets，用K路归并算法进行合并，合并出前100条News Feeds</p>\n</li>\n<li id=\"20220808111208-xduboy0\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">复杂度分析</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-v9s6a32\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">获取News Feed ，如果有N个关注对象，则为N次DB Reads的时间 + K路归并的时间（可以忽略，因为DB Read花费时间更多）</p>\n</li>\n<li id=\"20220808111208-dnkby06\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">发布Tweet ，1次DB Write的时间</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"Scala扩展设计\">Scala扩展设计</h1>\n<ol updated=\"20220808111208\">\n<li id=\"20220808111208-8qsfbi8\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Optimize 优化</p>\n</li>\n<li id=\"20220808111208-2jbcjuu\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Maintenance 维护</p>\n</li>\n</ol>\n<h2 id=\"处理步骤-\">处理步骤</h2>\n<h3 id=\"第一步-优化\">第一步：优化</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-a5niprj\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">解决设计缺陷</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-whf0m7p\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Pull 和 Push 模式的局限性</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-n49yc1e\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">更多的功能</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-r4knfu6\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Like、Follow &amp; Unfollow、Ads</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-n4ffnkm\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">特殊情况</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-ei0w0oo\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">僵尸粉、热搜</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"第二部-维护\">第二部：维护</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-c8xd84o\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">健壮性</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-c6gw2vq\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">服务器或者数据库挂了</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-4otktb8\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">扩展性</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-xnwij7j\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">应对流量暴增的情况</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Pull的缺陷\">Pull的缺陷</h2>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615151033.png\" alt=\"\" /></span></p>\n<p updated=\"20220808111208\">　　在用户进行读请求时，会访问每个关注的人的DB，所以这一块将会成为瓶颈</p>\n<ol updated=\"20220808111208\">\n<li id=\"20220808111208-2yg8rol\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">在访问DB之前，加入Cache</p>\n</li>\n<li id=\"20220808111208-0mvca5x\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">缓存每个用户的TimeLine</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-jr9rh79\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">N次DB请求 转化为 N次Cache请求</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-sq3n5vf\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">缓存每个用户的News Feeds</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-3rv1bhy\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">没有Cache News Feed的用户：归并N个用户最近的100条Tweets，取出结果前的100条</p>\n</li>\n<li id=\"20220808111208-78yrm5r\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">有Cache News Feed的用户：归并N个用户在某个时间戳之后的所有Tweets</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"Push的缺陷\">Push的缺陷</h2>\n<p updated=\"20220808111208\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/20220615151122.png\" alt=\"\" /></span></p>\n<p updated=\"20220808111208\">　　在用户发布一篇文章时，会向关注者的TimeLine中都插入一条Tweets。</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-mqa0bgu\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">会浪费更多的存储空间</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-zb8q57d\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">每个人那都会有一条Tweets数据</p>\n</li>\n<li id=\"20220808111208-w2kyx78\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">存储相对内存便宜，可以接受</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-ko24h35\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">不活跃用户的问题</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-8czcz64\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">导致每个人收到的时间不一样</p>\n</li>\n</ul>\n</li>\n<li id=\"20220808111208-mx0dcgj\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">粉丝数量超级大，亿级</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-uebfoeg\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">插入的时长即使异步，也非常慢</p>\n</li>\n<li id=\"20220808111208-v3et3rz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">切换回Pull模式，需要Trade Off ： Pull 和 Push成本</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"处理\">处理</h2>\n<h3 id=\"最小改动\">最小改动</h3>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-rgp1ipo\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">扩展机器</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-wunsd2w\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Push的话，将需要插入的Tweets分布到多台机器上，并行插入</p>\n</li>\n<li id=\"20220808111208-di66rjv\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">Pull的话，增加Cache容量</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"增长预估\">增长预估</h3>\n<p updated=\"20220808111208\">　　对当前业务量的增长率进行一个预判，衡量是采用Pull还是Push，如果实在太大，考虑Push结合Pull进行优化</p>\n<ul updated=\"20220808111208\">\n<li id=\"20220808111208-80q0isz\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">普通用户使用Push方案进行处理</p>\n</li>\n<li id=\"20220808111208-xz0atqx\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">标记大V用户，采用Pull方式进行处理</p>\n</li>\n<li id=\"20220808111208-ayidic7\" updated=\"20220808111208\">\n<p updated=\"20220808111208\">用户查询，合并自己的TimeLine + 大V的TimeLine</p>\n</li>\n</ul>\n<p updated=\"20220808111208\">　　相对来说混用的模型实现上会比单纯的复杂。</p>\n","headings":[{"depth":1,"value":"<u>Scenario</u>场景"},{"depth":2,"value":"需要设计哪些功能"},{"depth":2,"value":"需要承受的访问量"},{"depth":1,"value":"Service服务"},{"depth":1,"value":"Storage存储"},{"depth":2,"value":"处理步骤"},{"depth":3,"value":"第一步：为每个Service选择存储结构"},{"depth":3,"value":"第二步：细化表结构"},{"depth":2,"value":"存储模型"},{"depth":3,"value":"Pull Model 拉模型"},{"depth":1,"value":"Scala扩展设计"},{"depth":2,"value":"处理步骤"},{"depth":3,"value":"第一步：优化"},{"depth":3,"value":"第二部：维护"},{"depth":2,"value":"Pull的缺陷"},{"depth":2,"value":"Push的缺陷"},{"depth":2,"value":"处理"},{"depth":3,"value":"最小改动"},{"depth":3,"value":"增长预估"}],"path":"/topic/系统设计/4S分析法"},"tree":{"title":"系统设计","id":"20220523142842-5ohvsi1","parentId":"","href":"/topic/系统设计","path":"/topic/系统设计","children":[{"title":"概念","id":"20220615132453-664g7l0","type":"d","href":"/topic/系统设计/概念","parentId":"","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","sort":1,"children":[{"title":"数据库系统 VS 文件系统","id":"20220615102743-qj0plmz","type":"h","href":"/topic/系统设计/概念#数据库系统 VS 文件系统","parentId":"20220615132453-664g7l0","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[{"title":"关系","id":"20220615102811-lmbzu19","type":"h","href":"/topic/系统设计/概念#关系","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"区别","id":"20220615102835-8kegc0y","type":"h","href":"/topic/系统设计/概念#区别","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"总结","id":"20220615103035-c70ck6k","type":"h","href":"/topic/系统设计/概念#总结","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"单体架构VS微服务架构","id":"20220628154518-x6kau73","type":"h","href":"/topic/系统设计/概念#单体架构VS微服务架构","parentId":"20220615132453-664g7l0","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[{"title":"单体架构","id":"20220628154527-mj1noqe","type":"h","href":"/topic/系统设计/概念#单体架构","parentId":"20220628154518-x6kau73","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"微服务架构","id":"20220628154527-xpc8zw5","type":"h","href":"/topic/系统设计/概念#微服务架构","parentId":"20220628154518-x6kau73","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2}],"level":1},{"title":"4S分析法","id":"20220531175247-wjawyqd","type":"d","href":"/topic/系统设计/4S分析法","parentId":"","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","sort":2,"children":[{"title":"Scenario场景","id":"20220614162313-ymy6pxo","type":"h","href":"/topic/系统设计/4S分析法#Scenario场景","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"需要设计哪些功能","id":"20220616132326-s55nquu","type":"h","href":"/topic/系统设计/4S分析法#需要设计哪些功能","parentId":"20220614162313-ymy6pxo","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"需要承受的访问量","id":"20220616132326-y5xmygg","type":"h","href":"/topic/系统设计/4S分析法#需要承受的访问量","parentId":"20220614162313-ymy6pxo","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"Service服务","id":"20220616132326-j1gz6ab","type":"h","href":"/topic/系统设计/4S分析法#Service服务","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":2},{"title":"Storage存储","id":"20220616132404-d4ylqml","type":"h","href":"/topic/系统设计/4S分析法#Storage存储","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"处理步骤","id":"20220616132411-bvaq4hy","type":"h","href":"/topic/系统设计/4S分析法#处理步骤","parentId":"20220616132404-d4ylqml","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"第一步：为每个Service选择存储结构","id":"20220616132411-o42gm70","type":"h","href":"/topic/系统设计/4S分析法#第一步：为每个Service选择存储结构","parentId":"20220616132411-bvaq4hy","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"第二步：细化表结构","id":"20220616132411-fu7embq","type":"h","href":"/topic/系统设计/4S分析法#第二步：细化表结构","parentId":"20220616132411-bvaq4hy","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3},{"title":"存储模型","id":"20220616132411-wuznh3m","type":"h","href":"/topic/系统设计/4S分析法#存储模型","parentId":"20220616132404-d4ylqml","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"Pull Model 拉模型","id":"20220616132411-ltf0w00","type":"h","href":"/topic/系统设计/4S分析法#Pull Model 拉模型","parentId":"20220616132411-wuznh3m","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3}],"level":2},{"title":"Scala扩展设计","id":"20220616132437-btg0npi","type":"h","href":"/topic/系统设计/4S分析法#Scala扩展设计","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"处理步骤","id":"20220616132443-l9hc1mr","type":"h","href":"/topic/系统设计/4S分析法#处理步骤","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"第一步：优化","id":"20220616132443-i0no8v4","type":"h","href":"/topic/系统设计/4S分析法#第一步：优化","parentId":"20220616132443-l9hc1mr","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"第二部：维护","id":"20220616132443-xo6qd61","type":"h","href":"/topic/系统设计/4S分析法#第二部：维护","parentId":"20220616132443-l9hc1mr","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3},{"title":"Pull的缺陷","id":"20220616132451-87l1875","type":"h","href":"/topic/系统设计/4S分析法#Pull的缺陷","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"Push的缺陷","id":"20220616132443-bjr9ha0","type":"h","href":"/topic/系统设计/4S分析法#Push的缺陷","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"处理","id":"20220616132443-ezk0war","type":"h","href":"/topic/系统设计/4S分析法#处理","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"最小改动","id":"20220616132443-lmdkzs3","type":"h","href":"/topic/系统设计/4S分析法#最小改动","parentId":"20220616132443-ezk0war","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"增长预估","id":"20220616132443-1x7j1ed","type":"h","href":"/topic/系统设计/4S分析法#增长预估","parentId":"20220616132443-ezk0war","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3}],"level":2}],"level":1},{"title":"样例","id":"20220523161014-1vkr1si","type":"d","href":"/topic/系统设计/样例","parentId":"","path":"/topic/系统设计/样例","parentPath":"/topic/系统设计","sort":3,"children":[{"title":"短链系统","id":"20220523142856-tm0dduf","type":"d","href":"/topic/系统设计/样例/短链系统","parentId":"","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","sort":1,"children":[{"title":"概述用例和约束","id":"20220523152802-ora3luz","type":"h","href":"/topic/系统设计/样例/短链系统#概述用例和约束","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[{"title":"用例","id":"20220523153231-cqe7c6z","type":"h","href":"/topic/系统设计/样例/短链系统#用例","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"约束和假设","id":"20220523153213-tyokdre","type":"h","href":"/topic/系统设计/样例/短链系统#约束和假设","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"预估容量","id":"20220523153245-akx221a","type":"h","href":"/topic/系统设计/样例/短链系统#预估容量","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"创建一个高层次设计","id":"20220523154027-n2m6mb0","type":"h","href":"/topic/系统设计/样例/短链系统#创建一个高层次设计","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"设计核心组件","id":"20220523155756-as6zfq4","type":"h","href":"/topic/系统设计/样例/短链系统#设计核心组件","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[{"title":"用例: 用户输入一段文本，然后得到一个随机生成的链接","id":"20220523155920-i5awrmn","type":"h","href":"/topic/系统设计/样例/短链系统#用例: 用户输入一段文本，然后得到一个随机生成的链接","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容","id":"20220523160445-ppzjfcg","type":"h","href":"/topic/系统设计/样例/短链系统#用例：用户输入一个 paste 的 url 后可以看到它存储的内容","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例： 服务跟踪分析页面","id":"20220523160523-x0zwdli","type":"h","href":"/topic/系统设计/样例/短链系统#用例： 服务跟踪分析页面","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例： 服务删除过期的 pastes","id":"20220523160541-cln3fph","type":"h","href":"/topic/系统设计/样例/短链系统#用例： 服务删除过期的 pastes","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"扩展设计","id":"20220523160546-vbv6n9j","type":"h","href":"/topic/系统设计/样例/短链系统#扩展设计","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"总结","id":"20220523163729-9u3wkrv","type":"h","href":"/topic/系统设计/样例/短链系统#总结","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2},{"title":"微博架构设计","id":"20220524140048-zkiqvui","type":"d","href":"/topic/系统设计/样例/微博架构设计","parentId":"","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","sort":2,"children":[{"title":"概述用例和约束","id":"20220524140533-yb6pk63","type":"h","href":"/topic/系统设计/样例/微博架构设计#概述用例和约束","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[{"title":"用例","id":"20220524140955-hl15d6z","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例","parentId":"20220524140533-yb6pk63","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"限制条件与假设","id":"20220524142056-m6nm6xm","type":"h","href":"/topic/系统设计/样例/微博架构设计#限制条件与假设","parentId":"20220524140533-yb6pk63","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"概要设计","id":"20220524145303-hrsunb1","type":"h","href":"/topic/系统设计/样例/微博架构设计#概要设计","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"设计核心组件","id":"20220524154837-c7lw852","type":"h","href":"/topic/系统设计/样例/微博架构设计#设计核心组件","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[{"title":"用例: 用户发表了一篇微博","id":"20220524155958-ygnj4py","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例: 用户发表了一篇微博","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户浏览聚合主页时间轴","id":"20220524163832-k1u2urx","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户浏览聚合主页时间轴","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户浏览用户时间轴","id":"20220524164247-audibq3","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户浏览用户时间轴","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户搜索关键词","id":"20220524164312-1obgv97","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户搜索关键词","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"架构扩展","id":"20220524164325-q9o9ung","type":"h","href":"/topic/系统设计/样例/微博架构设计#架构扩展","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2},{"title":"秒杀","id":"20220616202141-hy1nbif","type":"d","href":"/topic/系统设计/样例/秒杀","parentId":"","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","sort":4,"children":[{"title":"Scenario场景","id":"20220616202308-9bgzn5z","type":"h","href":"/topic/系统设计/样例/秒杀#Scenario场景","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"需求拆解","id":"20220623170337-upk31iw","type":"h","href":"/topic/系统设计/样例/秒杀#需求拆解","parentId":"20220616202308-9bgzn5z","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"Service 服务","id":"20220623170617-lfeu5ob","type":"h","href":"/topic/系统设计/样例/秒杀#Service 服务","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"Storage存储","id":"20220623210002-oh2z3zd","type":"h","href":"/topic/系统设计/样例/秒杀#Storage存储","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"商品信息表 commodity_info","id":"20220624113741-lsybjg4","type":"h","href":"/topic/系统设计/样例/秒杀#商品信息表 commodity_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"秒杀活动表 seckill_info","id":"20220624113935-pc2me4m","type":"h","href":"/topic/系统设计/样例/秒杀#秒杀活动表 seckill_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"库存信息表 stock_info","id":"20220624131344-2oot3xz","type":"h","href":"/topic/系统设计/样例/秒杀#库存信息表 stock_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"订单信息表 order_info","id":"20220624131601-lgvwksl","type":"h","href":"/topic/系统设计/样例/秒杀#订单信息表 order_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"数据流向","id":"20220624131855-pzpipel","type":"h","href":"/topic/系统设计/样例/秒杀#数据流向","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"Scala扩展设计","id":"20220628155648-7dj6e6e","type":"h","href":"/topic/系统设计/样例/秒杀#Scala扩展设计","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"数据一致性","id":"20220628155654-6w1zago","type":"h","href":"/topic/系统设计/样例/秒杀#数据一致性","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"应对高QPS","id":"20220628155339-dp92t46","type":"h","href":"/topic/系统设计/样例/秒杀#应对高QPS","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"Redis的缺陷优化","id":"20220628132922-1wcck7q","type":"h","href":"/topic/系统设计/样例/秒杀#Redis的缺陷优化","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"这样就完美了吗？","id":"20220628134645-m8f0zw1","type":"h","href":"/topic/系统设计/样例/秒杀#这样就完美了吗？","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"分布式事务","id":"20220628135940-s7irnu6","type":"h","href":"/topic/系统设计/样例/秒杀#分布式事务","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"其他的小细节","id":"20220628165937-aaii6h7","type":"h","href":"/topic/系统设计/样例/秒杀#其他的小细节","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"防止刷爆商品页面","id":"20220628140318-7jb6y79","type":"h","href":"/topic/系统设计/样例/秒杀#防止刷爆商品页面","parentId":"20220628165937-aaii6h7","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"服务高可用","id":"20220628140639-2r8f6ir","type":"h","href":"/topic/系统设计/样例/秒杀#服务高可用","parentId":"20220628165937-aaii6h7","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"防止恶意刷请求或者爬虫请求","id":"20220628140847-bweqsx9","type":"h","href":"/topic/系统设计/样例/秒杀#防止恶意刷请求或者爬虫请求","parentId":"20220628165937-aaii6h7","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5}],"level":4}],"level":3}],"level":2}],"level":1},{"title":"每个程序员都应该知道的延迟数字","id":"20220524194105-29b5zns","type":"d","href":"/topic/系统设计/每个程序员都应该知道的延迟数字","parentId":"","path":"/topic/系统设计/每个程序员都应该知道的延迟数字","parentPath":"/topic/系统设计","sort":4,"children":[],"level":1},{"title":"Flux架构","id":"20220630203113-cjoqcbf","type":"d","href":"/topic/系统设计/Flux架构","parentId":"","path":"/topic/系统设计/Flux架构","parentPath":"/topic/系统设计","sort":5,"children":[],"level":1},{"title":"Http进化史","id":"20220701132636-sffchc7","type":"d","href":"/topic/系统设计/Http进化史","parentId":"","path":"/topic/系统设计/Http进化史","parentPath":"/topic/系统设计","children":[],"level":1},{"title":"系统常见故障","id":"20220802204018-p5gpqgu","type":"d","href":"/topic/系统设计/系统常见故障","parentId":"","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"写日志引发的故障","id":"20220802204332-hy5xsnl","type":"h","href":"/topic/系统设计/系统常见故障#写日志引发的故障","parentId":"20220802204018-p5gpqgu","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"故障现象","id":"20220802204350-kpdasf1","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220802204401-md2j3m3","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220802204350-ldt4g70","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"高并发访问数据库引发的故障","id":"20220802204803-glrzawa","type":"h","href":"/topic/系统设计/系统常见故障#高并发访问数据库引发的故障","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"故障现象","id":"20220802204811-i9rkjhk","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220802204811-6m31i3r","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220802204811-9z16at5","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220802204332-hy5xsnl","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"高并发情况下锁引发的故障","id":"20220802212352-0uxx339","type":"h","href":"/topic/系统设计/系统常见故障#高并发情况下锁引发的故障","parentId":"20220802204018-p5gpqgu","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"故障现象","id":"20220802212404-8lfbbya","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220802212352-0uxx339","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220802212408-e2921pf","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220802212352-0uxx339","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220802212400-571z94t","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220802212352-0uxx339","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"缓存引发的故障","id":"20220805093210-m7lrlf2","type":"h","href":"/topic/系统设计/系统常见故障#缓存引发的故障","parentId":"20220802212352-0uxx339","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"故障现象","id":"20220805093221-pm7o2e4","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220802212352-0uxx339","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220805093239-s0zm5uc","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220802212352-0uxx339","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"经验教训","id":"20220805093239-dkcg9j1","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220805093239-s0zm5uc","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3}],"level":2},{"title":"应用启动不同步引发的故障","id":"20220805093446-cypkdar","type":"h","href":"/topic/系统设计/系统常见故障#应用启动不同步引发的故障","parentId":"20220802204018-p5gpqgu","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"故障现象","id":"20220805093450-omj1m8k","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220805093446-cypkdar","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220805093446-ycpvo18","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220805093446-cypkdar","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220805093511-eji1e9f","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220805093446-cypkdar","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"大文件读写独占磁盘引发的故障","id":"20220805095411-ps3caqq","type":"h","href":"/topic/系统设计/系统常见故障#大文件读写独占磁盘引发的故障","parentId":"20220802204018-p5gpqgu","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"故障现象","id":"20220805095418-yzbpm82","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220805095411-ps3caqq","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220805095411-8oz0ee9","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220805095411-ps3caqq","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220805095411-plav986","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220805095411-ps3caqq","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"滥用生产环境引发的故障","id":"20220805095411-vqiw12l","type":"h","href":"/topic/系统设计/系统常见故障#滥用生产环境引发的故障","parentId":"20220802204018-p5gpqgu","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"故障现象","id":"20220805095411-387t1yi","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220805095411-vqiw12l","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220805095411-g1pdror","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220805095411-vqiw12l","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220805095411-ghccimu","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220805095411-vqiw12l","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"不规范的流程引发的故障","id":"20220805095411-46g2x35","type":"h","href":"/topic/系统设计/系统常见故障#不规范的流程引发的故障","parentId":"20220802204018-p5gpqgu","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[{"title":"故障现象","id":"20220805095650-sp6wd01","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220805095411-mwo9xvd","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220805095411-1h1bd30","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"不好的编程习惯引发的故障","id":"20220805095411-9s3d4la","type":"h","href":"/topic/系统设计/系统常见故障#不好的编程习惯引发的故障","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"故障现象","id":"20220805095411-14szlt8","type":"h","href":"/topic/系统设计/系统常见故障#故障现象","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"原因分析","id":"20220805095411-s1rg4us","type":"h","href":"/topic/系统设计/系统常见故障#原因分析","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"经验教训","id":"20220805095411-nx6hepo","type":"h","href":"/topic/系统设计/系统常见故障#经验教训","parentId":"20220805095411-46g2x35","path":"/topic/系统设计/系统常见故障","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2}],"level":1}],"level":0},"headings":[{"depth":1,"value":"<u>Scenario</u>场景","slug":"uscenariou场景"},{"depth":2,"value":"需要设计哪些功能","slug":"需要设计哪些功能"},{"depth":2,"value":"需要承受的访问量","slug":"需要承受的访问量"},{"depth":1,"value":"Service服务","slug":"service服务"},{"depth":1,"value":"Storage存储","slug":"storage存储"},{"depth":2,"value":"处理步骤","slug":"处理步骤"},{"depth":3,"value":"第一步：为每个Service选择存储结构","slug":"第一步为每个service选择存储结构"},{"depth":3,"value":"第二步：细化表结构","slug":"第二步细化表结构"},{"depth":2,"value":"存储模型","slug":"存储模型"},{"depth":3,"value":"Pull Model 拉模型","slug":"pull-model-拉模型"},{"depth":1,"value":"Scala扩展设计","slug":"scala扩展设计"},{"depth":2,"value":"处理步骤","slug":"处理步骤-1"},{"depth":3,"value":"第一步：优化","slug":"第一步优化"},{"depth":3,"value":"第二部：维护","slug":"第二部维护"},{"depth":2,"value":"Pull的缺陷","slug":"pull的缺陷"},{"depth":2,"value":"Push的缺陷","slug":"push的缺陷"},{"depth":2,"value":"处理","slug":"处理"},{"depth":3,"value":"最小改动","slug":"最小改动"},{"depth":3,"value":"增长预估","slug":"增长预估"}]}},
    "staticQueryHashes": ["630634786","928362550"]}