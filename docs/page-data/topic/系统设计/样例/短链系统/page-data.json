{
    "componentChunkName": "component---src-templates-topic-page-template-tsx",
    "path": "/topic/系统设计/样例/短链系统",
    "result": {"pageContext":{"id":"/topic/系统设计/样例/短链系统","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"短链系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"a短链系统设计看起来简单，但是每个点都能展开很多知识点。短链是通过访问服务器上的链接，通过Http返回的302Code，对链接进行重定向，然后访问到对应的地址上。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"sequenceDiagram\n    客户端->>短链服务器: 访问A\n    短链服务器->>客户端: status code:302  location:B\n    客户端 ->> B服务器: 访问B\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Http协议中重定向有两种code: 301 、302"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"301: 代表永久"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"重定向"}]},{"type":"text","value":"。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"302: 代表"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"临时重定向"}]},{"type":"text","value":"。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"他们的区别就在于浏览器会对301做缓存的效果，如果返回的code是301，则浏览器缓存A到B的映射，在下次发起请求的时候不会再去请求A的服务器。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概述用例和约束"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":" 输入一段文本，然后得到一个随机生成的链接"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"过期设置"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"默认的设置是不会过期的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"可以选择设置一个过期的时间"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":" 输入一个 paste 的 url 后，可以看到它存储的内容"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":" 是匿名的"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" 跟踪页面分析"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个月的访问统计"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" 删除过期的 pastes"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" 需要高可用"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"约束和假设"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"访问流量不是均匀分布的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"打开一个短链接应该是很快的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pastes 只能是文本"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"页面访问分析数据可以不用实时"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一千万的用户量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月一千万的 paste 写入量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月一亿的 paste 读取量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"读写比例在 10:1"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"预估容量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每个 paste 的大小"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每一个 paste 1 KB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"shortlink"}]},{"type":"text","value":" - 7 bytes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"expiration_length_in_minutes"}]},{"type":"text","value":" - 4 bytes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"created_at"}]},{"type":"text","value":" - 5 bytes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"总共 = ~1.27 KB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每个月新的 paste 内容在 12.7GB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"(1.27 * 10000000)KB / 月的 paste"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"三年内将近 450GB 的新 paste 内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"三年内 3.6 亿短链接"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"假设大部分都是新的 paste，而不是需要更新已存在的 paste"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"平均 4paste/s 的写入速度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"平均 40paste/s 的读取速度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"创建一个高层次设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用webServer作为请求的入口，然后调用API去访问SQL。最后采用Analytics对请求数据进行分析。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"graph TD;\n    客户端-->WebServer;\n    WebServer-->WriteAPI;\n    WebServer-->ReadAPI;\n    ReadAPI-->SQL;\n    WriteAPI-->SQL;\n   Analytics -->SQL;\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"设计核心组件"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例: "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"输入一段文本，然后得到一个随机生成的链接"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用关系型数据库直接将生成的URL映射成用户的URL。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":" 发送一个创建 paste 的请求到作为一个"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8"},"children":[{"type":"text","value":"反向代理"}]},{"type":"text","value":"启动的  "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":" 。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":" 转发请求给 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写接口"}]},{"type":"text","value":" 服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写接口"}]},{"type":"text","value":" 服务器执行如下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"生成一个唯一的 url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"检查这个 url 在 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 里面是否是唯一的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"如果这个 url 不是唯一的，生成另外一个 url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"如果我们支持自定义 url，我们可以使用用户提供的 url（也需要检查是否重复）"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"把生成的 url 和用户的url 存储到 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"pastes"}]},{"type":"text","value":" 表里面"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"返回生成的 url"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"pastes"}]},{"type":"text","value":"结构如下:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-sql"]},"children":[{"type":"text","value":"shortlink char(7) NOT NULL\nexpiration_length_in_minutes int NOT NULL\ncreated_at datetime NOT NULL\npaste varchar(2048) NOT NULL\nPRIMARY KEY(shortlink)\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"shortlink"}]},{"type":"text","value":"上创建一个数据库索引，用来提高查询的速度。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":" 发送一个获取 paste 请求到 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web Server"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web Server"}]},{"type":"text","value":" 转发请求给 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取接口"}]},{"type":"text","value":" 服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取接口"}]},{"type":"text","value":" 服务器执行如下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 检查这个生成的 url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"如果这个 url 在 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 里面，则从返回这个 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"paste"}]},{"type":"text","value":" 的内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"否则，返回一个错误页面给用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例： 服务跟踪分析页面"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因为实时分析不是必须的，所以我们可以简单的 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"MapReduce"}]},{"type":"text","value":" "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web Server"}]},{"type":"text","value":" 的日志，用来生成点击次数。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例： 服务删除过期的 pastes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"为了删除过期的 pastes，我们可以直接搜索 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 中所有的过期时间比当前时间更早的记录， 所有过期的记录将从这张表里面删除（或者将其标记为过期）。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"扩展设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"graph TD;\n\tClient-->DNS负载;\n        Client-->CDN回源;\n\tDNS负载-->LoadBalancer;\n\tLoadBalancer-->WebServer;\n\tWebServer-->WriteAPI;\n\tWebServer-->ReadAPI;\n\tReadAPI-->MemoryCache;\n\tWriteAPI-->SQLMaster-Slave;\n\tReadAPI-->SQLReadReplicas;\n\tSQLMaster-Slave --- SQLReadReplicas;\n\tAnalytics-->SQLAnalytics;\n\tSQLAnalytics-->SQLMaster-Slave\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对于请求量比较大的，应该将数据留在上游，这部分可以采用CDN来代理源站，将数据放在边缘"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用LoadBalancer来代理我们具体的服务器，以便于可以对webServer进行水平扩展"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"处理每秒40的读请求，其内容应该交由给内存级别的缓存来处理。比如Redis这种"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对于单个关系型数据库，主从切分之后每秒4次的写入问题不大。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果写入出现了瓶颈，需要额外采用别的方式。包括但不限于："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"水平、垂直分片"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"非规范化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"SQL调优"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"总结"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对于短链系统，整体的系统的设计大概如此，从架构方面应该是满足要求了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"其次，还有一些细节在我看来就是属于业务上的东西了，需要自行衡量,比如: 短链生成方法有好几种方式，Hash、Md5、UUID、redis、Snowflake、Mysql 自增主键。其选型并没有什么优劣之分，只有合适与否。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"整个系统的诞生是一个不断优化的过程，我们需要先解决有的问题，再持续进行优化。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"继续对系统进行基准测试和监控，以在瓶颈出现时解决它们"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"扩展是一个迭代的过程"}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"articleNode":{"field":{"contentType":"topic","topic":"系统设计"},"frontmatter":{"id":"/topic/系统设计/样例/短链系统","title":"短链系统","date":"2022-05-23 14:28","absolute_path":"/topic/系统设计/样例/短链系统"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"短链系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"a短链系统设计看起来简单，但是每个点都能展开很多知识点。短链是通过访问服务器上的链接，通过Http返回的302Code，对链接进行重定向，然后访问到对应的地址上。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"sequenceDiagram\n    客户端->>短链服务器: 访问A\n    短链服务器->>客户端: status code:302  location:B\n    客户端 ->> B服务器: 访问B\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Http协议中重定向有两种code: 301 、302"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"301: 代表永久"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"重定向"}]},{"type":"text","value":"。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"302: 代表"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"临时重定向"}]},{"type":"text","value":"。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"他们的区别就在于浏览器会对301做缓存的效果，如果返回的code是301，则浏览器缓存A到B的映射，在下次发起请求的时候不会再去请求A的服务器。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概述用例和约束"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":" 输入一段文本，然后得到一个随机生成的链接"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"过期设置"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"默认的设置是不会过期的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"可以选择设置一个过期的时间"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":" 输入一个 paste 的 url 后，可以看到它存储的内容"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":" 是匿名的"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" 跟踪页面分析"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个月的访问统计"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" 删除过期的 pastes"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" 需要高可用"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"约束和假设"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"访问流量不是均匀分布的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"打开一个短链接应该是很快的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pastes 只能是文本"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"页面访问分析数据可以不用实时"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一千万的用户量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月一千万的 paste 写入量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月一亿的 paste 读取量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"读写比例在 10:1"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"预估容量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每个 paste 的大小"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每一个 paste 1 KB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"shortlink"}]},{"type":"text","value":" - 7 bytes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"expiration_length_in_minutes"}]},{"type":"text","value":" - 4 bytes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"created_at"}]},{"type":"text","value":" - 5 bytes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"总共 = ~1.27 KB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每个月新的 paste 内容在 12.7GB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"(1.27 * 10000000)KB / 月的 paste"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"三年内将近 450GB 的新 paste 内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"三年内 3.6 亿短链接"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"假设大部分都是新的 paste，而不是需要更新已存在的 paste"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"平均 4paste/s 的写入速度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"平均 40paste/s 的读取速度"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"创建一个高层次设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用webServer作为请求的入口，然后调用API去访问SQL。最后采用Analytics对请求数据进行分析。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"graph TD;\n    客户端-->WebServer;\n    WebServer-->WriteAPI;\n    WebServer-->ReadAPI;\n    ReadAPI-->SQL;\n    WriteAPI-->SQL;\n   Analytics -->SQL;\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"设计核心组件"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例: "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"输入一段文本，然后得到一个随机生成的链接"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用关系型数据库直接将生成的URL映射成用户的URL。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":" 发送一个创建 paste 的请求到作为一个"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8"},"children":[{"type":"text","value":"反向代理"}]},{"type":"text","value":"启动的  "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":" 。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":" 转发请求给 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写接口"}]},{"type":"text","value":" 服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写接口"}]},{"type":"text","value":" 服务器执行如下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"生成一个唯一的 url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"检查这个 url 在 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 里面是否是唯一的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"如果这个 url 不是唯一的，生成另外一个 url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"如果我们支持自定义 url，我们可以使用用户提供的 url（也需要检查是否重复）"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"把生成的 url 和用户的url 存储到 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"pastes"}]},{"type":"text","value":" 表里面"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"返回生成的 url"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"pastes"}]},{"type":"text","value":"结构如下:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-sql"]},"children":[{"type":"text","value":"shortlink char(7) NOT NULL\nexpiration_length_in_minutes int NOT NULL\ncreated_at datetime NOT NULL\npaste varchar(2048) NOT NULL\nPRIMARY KEY(shortlink)\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"shortlink"}]},{"type":"text","value":"上创建一个数据库索引，用来提高查询的速度。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":" 发送一个获取 paste 请求到 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web Server"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web Server"}]},{"type":"text","value":" 转发请求给 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取接口"}]},{"type":"text","value":" 服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取接口"}]},{"type":"text","value":" 服务器执行如下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 检查这个生成的 url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"如果这个 url 在 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 里面，则从返回这个 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"paste"}]},{"type":"text","value":" 的内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"否则，返回一个错误页面给用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例： 服务跟踪分析页面"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因为实时分析不是必须的，所以我们可以简单的 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"MapReduce"}]},{"type":"text","value":" "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web Server"}]},{"type":"text","value":" 的日志，用来生成点击次数。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例： 服务删除过期的 pastes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"为了删除过期的 pastes，我们可以直接搜索 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 中所有的过期时间比当前时间更早的记录， 所有过期的记录将从这张表里面删除（或者将其标记为过期）。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"扩展设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-mermaid"]},"children":[{"type":"text","value":"graph TD;\n\tClient-->DNS负载;\n        Client-->CDN回源;\n\tDNS负载-->LoadBalancer;\n\tLoadBalancer-->WebServer;\n\tWebServer-->WriteAPI;\n\tWebServer-->ReadAPI;\n\tReadAPI-->MemoryCache;\n\tWriteAPI-->SQLMaster-Slave;\n\tReadAPI-->SQLReadReplicas;\n\tSQLMaster-Slave --- SQLReadReplicas;\n\tAnalytics-->SQLAnalytics;\n\tSQLAnalytics-->SQLMaster-Slave\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对于请求量比较大的，应该将数据留在上游，这部分可以采用CDN来代理源站，将数据放在边缘"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用LoadBalancer来代理我们具体的服务器，以便于可以对webServer进行水平扩展"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"处理每秒40的读请求，其内容应该交由给内存级别的缓存来处理。比如Redis这种"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对于单个关系型数据库，主从切分之后每秒4次的写入问题不大。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果写入出现了瓶颈，需要额外采用别的方式。包括但不限于："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"水平、垂直分片"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"非规范化"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"SQL调优"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"总结"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对于短链系统，整体的系统的设计大概如此，从架构方面应该是满足要求了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"其次，还有一些细节在我看来就是属于业务上的东西了，需要自行衡量,比如: 短链生成方法有好几种方式，Hash、Md5、UUID、redis、Snowflake、Mysql 自增主键。其选型并没有什么优劣之分，只有合适与否。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"整个系统的诞生是一个不断优化的过程，我们需要先解决有的问题，再持续进行优化。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"继续对系统进行基准测试和监控，以在瓶颈出现时解决它们"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"扩展是一个迭代的过程"}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"headings":[{"depth":1,"value":"短链系统"},{"depth":1,"value":"概述用例和约束"},{"depth":2,"value":"用例"},{"depth":2,"value":"约束和假设"},{"depth":2,"value":"预估容量"},{"depth":1,"value":"创建一个高层次设计"},{"depth":1,"value":"设计核心组件"},{"depth":2,"value":"用例: 用户输入一段文本，然后得到一个随机生成的链接"},{"depth":2,"value":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容"},{"depth":2,"value":"用例： 服务跟踪分析页面"},{"depth":2,"value":"用例： 服务删除过期的 pastes"},{"depth":1,"value":"扩展设计"},{"depth":1,"value":"总结"}],"path":"/topic/系统设计/样例/短链系统"},"tree":{"title":"系统设计","id":"20220523142842-5ohvsi1","parentId":"","href":"/topic/系统设计","path":"/topic/系统设计","children":[{"title":"样例","id":"20220523161014-1vkr1si","type":"d","href":"/topic/系统设计/样例","parentId":"","path":"/topic/系统设计/样例","parentPath":"/topic/系统设计","sort":3,"children":[{"title":"短链系统","id":"20220523142856-tm0dduf","type":"d","href":"/topic/系统设计/样例/短链系统","parentId":"","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","sort":1,"children":[{"title":"概述用例和约束","id":"20220523152802-ora3luz","type":"h","href":"/topic/系统设计/样例/短链系统#概述用例和约束","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[{"title":"用例","id":"20220523153231-cqe7c6z","type":"h","href":"/topic/系统设计/样例/短链系统#用例","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"约束和假设","id":"20220523153213-tyokdre","type":"h","href":"/topic/系统设计/样例/短链系统#约束和假设","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"预估容量","id":"20220523153245-akx221a","type":"h","href":"/topic/系统设计/样例/短链系统#预估容量","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"创建一个高层次设计","id":"20220523154027-n2m6mb0","type":"h","href":"/topic/系统设计/样例/短链系统#创建一个高层次设计","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"设计核心组件","id":"20220523155756-as6zfq4","type":"h","href":"/topic/系统设计/样例/短链系统#设计核心组件","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[{"title":"用例: 用户输入一段文本，然后得到一个随机生成的链接","id":"20220523155920-i5awrmn","type":"h","href":"/topic/系统设计/样例/短链系统#用例: 用户输入一段文本，然后得到一个随机生成的链接","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容","id":"20220523160445-ppzjfcg","type":"h","href":"/topic/系统设计/样例/短链系统#用例：用户输入一个 paste 的 url 后可以看到它存储的内容","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例： 服务跟踪分析页面","id":"20220523160523-x0zwdli","type":"h","href":"/topic/系统设计/样例/短链系统#用例： 服务跟踪分析页面","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例： 服务删除过期的 pastes","id":"20220523160541-cln3fph","type":"h","href":"/topic/系统设计/样例/短链系统#用例： 服务删除过期的 pastes","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"扩展设计","id":"20220523160546-vbv6n9j","type":"h","href":"/topic/系统设计/样例/短链系统#扩展设计","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"总结","id":"20220523163729-9u3wkrv","type":"h","href":"/topic/系统设计/样例/短链系统#总结","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2},{"title":"微博架构设计","id":"20220524140048-zkiqvui","type":"d","href":"/topic/系统设计/样例/微博架构设计","parentId":"","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","sort":2,"children":[{"title":"概述用例和约束","id":"20220524140533-yb6pk63","type":"h","href":"/topic/系统设计/样例/微博架构设计#概述用例和约束","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[{"title":"用例","id":"20220524140955-hl15d6z","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例","parentId":"20220524140533-yb6pk63","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"限制条件与假设","id":"20220524142056-m6nm6xm","type":"h","href":"/topic/系统设计/样例/微博架构设计#限制条件与假设","parentId":"20220524140533-yb6pk63","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"概要设计","id":"20220524145303-hrsunb1","type":"h","href":"/topic/系统设计/样例/微博架构设计#概要设计","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"设计核心组件","id":"20220524154837-c7lw852","type":"h","href":"/topic/系统设计/样例/微博架构设计#设计核心组件","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[{"title":"用例: 用户发表了一篇微博","id":"20220524155958-ygnj4py","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例: 用户发表了一篇微博","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户浏览聚合主页时间轴","id":"20220524163832-k1u2urx","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户浏览聚合主页时间轴","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户浏览用户时间轴","id":"20220524164247-audibq3","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户浏览用户时间轴","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户搜索关键词","id":"20220524164312-1obgv97","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户搜索关键词","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"架构扩展","id":"20220524164325-q9o9ung","type":"h","href":"/topic/系统设计/样例/微博架构设计#架构扩展","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2},{"title":"秒杀","id":"20220616202141-hy1nbif","type":"d","href":"/topic/系统设计/样例/秒杀","parentId":"","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"需求拆解","id":"20220623170337-upk31iw","type":"h","href":"/topic/系统设计/样例/秒杀#需求拆解","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"Service 服务","id":"20220623170617-lfeu5ob","type":"h","href":"/topic/系统设计/样例/秒杀#Service 服务","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"单体架构","id":"20220623170621-7pp1cp8","type":"h","href":"/topic/系统设计/样例/秒杀#单体架构","parentId":"20220623170617-lfeu5ob","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"微服务架构","id":"20220623171604-0oyu28v","type":"h","href":"/topic/系统设计/样例/秒杀#微服务架构","parentId":"20220623170617-lfeu5ob","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"存储方面","id":"20220623210002-oh2z3zd","type":"h","href":"/topic/系统设计/样例/秒杀#存储方面","parentId":"20220623170617-lfeu5ob","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"商品信息表 commodity_info","id":"20220624113741-lsybjg4","type":"h","href":"/topic/系统设计/样例/秒杀#商品信息表 commodity_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"秒杀活动表 seckill_info","id":"20220624113935-pc2me4m","type":"h","href":"/topic/系统设计/样例/秒杀#秒杀活动表 seckill_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"库存信息表 stock_info","id":"20220624131344-2oot3xz","type":"h","href":"/topic/系统设计/样例/秒杀#库存信息表 stock_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"订单信息表 order_info","id":"20220624131601-lgvwksl","type":"h","href":"/topic/系统设计/样例/秒杀#订单信息表 order_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5}],"level":4},{"title":"数据流向","id":"20220624131855-pzpipel","type":"h","href":"/topic/系统设计/样例/秒杀#数据流向","parentId":"20220623170617-lfeu5ob","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"Scenario场景","id":"20220616202308-9bgzn5z","type":"h","href":"/topic/系统设计/样例/秒杀#Scenario场景","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2}],"level":1},{"title":"每个程序员都应该知道的延迟数字","id":"20220524194105-29b5zns","type":"d","href":"/topic/系统设计/每个程序员都应该知道的延迟数字","parentId":"","path":"/topic/系统设计/每个程序员都应该知道的延迟数字","parentPath":"/topic/系统设计","sort":4,"children":[],"level":1},{"title":"概念","id":"20220615132453-664g7l0","type":"d","href":"/topic/系统设计/概念","parentId":"","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[{"title":"数据库系统 VS 文件系统","id":"20220615102743-qj0plmz","type":"h","href":"/topic/系统设计/概念#数据库系统 VS 文件系统","parentId":"20220615132453-664g7l0","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[{"title":"关系","id":"20220615102811-lmbzu19","type":"h","href":"/topic/系统设计/概念#关系","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"区别","id":"20220615102835-8kegc0y","type":"h","href":"/topic/系统设计/概念#区别","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"总结","id":"20220615103035-c70ck6k","type":"h","href":"/topic/系统设计/概念#总结","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2}],"level":1},{"title":"4S分析法","id":"20220531175247-wjawyqd","type":"d","href":"/topic/系统设计/4S分析法","parentId":"","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","sort":1,"children":[{"title":"Storage存储","id":"20220616132404-d4ylqml","type":"h","href":"/topic/系统设计/4S分析法#Storage存储","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"处理步骤","id":"20220616132411-bvaq4hy","type":"h","href":"/topic/系统设计/4S分析法#处理步骤","parentId":"20220616132404-d4ylqml","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"第一步：为每个Service选择存储结构","id":"20220616132411-o42gm70","type":"h","href":"/topic/系统设计/4S分析法#第一步：为每个Service选择存储结构","parentId":"20220616132411-bvaq4hy","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"第二步：细化表结构","id":"20220616132411-fu7embq","type":"h","href":"/topic/系统设计/4S分析法#第二步：细化表结构","parentId":"20220616132411-bvaq4hy","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3},{"title":"存储模型","id":"20220616132411-wuznh3m","type":"h","href":"/topic/系统设计/4S分析法#存储模型","parentId":"20220616132404-d4ylqml","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"Pull Model 拉模型","id":"20220616132411-ltf0w00","type":"h","href":"/topic/系统设计/4S分析法#Pull Model 拉模型","parentId":"20220616132411-wuznh3m","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3}],"level":2},{"title":"Scala扩展设计","id":"20220616132437-btg0npi","type":"h","href":"/topic/系统设计/4S分析法#Scala扩展设计","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"处理步骤","id":"20220616132443-l9hc1mr","type":"h","href":"/topic/系统设计/4S分析法#处理步骤","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"第一步：优化","id":"20220616132443-i0no8v4","type":"h","href":"/topic/系统设计/4S分析法#第一步：优化","parentId":"20220616132443-l9hc1mr","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"第二部：维护","id":"20220616132443-xo6qd61","type":"h","href":"/topic/系统设计/4S分析法#第二部：维护","parentId":"20220616132443-l9hc1mr","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3},{"title":"Pull的缺陷","id":"20220616132451-87l1875","type":"h","href":"/topic/系统设计/4S分析法#Pull的缺陷","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"Service服务","id":"20220616132326-j1gz6ab","type":"h","href":"/topic/系统设计/4S分析法#Service服务","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":2},{"title":"Scenario场景","id":"20220614162313-ymy6pxo","type":"h","href":"/topic/系统设计/4S分析法#Scenario场景","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"需要设计哪些功能","id":"20220616132326-s55nquu","type":"h","href":"/topic/系统设计/4S分析法#需要设计哪些功能","parentId":"20220614162313-ymy6pxo","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"需要承受的访问量","id":"20220616132326-y5xmygg","type":"h","href":"/topic/系统设计/4S分析法#需要承受的访问量","parentId":"20220614162313-ymy6pxo","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2}],"level":1}],"level":0},"headings":[{"depth":1,"value":"短链系统","slug":"短链系统"},{"depth":1,"value":"概述用例和约束","slug":"概述用例和约束"},{"depth":2,"value":"用例","slug":"用例"},{"depth":2,"value":"约束和假设","slug":"约束和假设"},{"depth":2,"value":"预估容量","slug":"预估容量"},{"depth":1,"value":"创建一个高层次设计","slug":"创建一个高层次设计"},{"depth":1,"value":"设计核心组件","slug":"设计核心组件"},{"depth":2,"value":"用例: 用户输入一段文本，然后得到一个随机生成的链接","slug":"用例-用户输入一段文本然后得到一个随机生成的链接"},{"depth":2,"value":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容","slug":"用例用户输入一个-paste-的-url-后可以看到它存储的内容"},{"depth":2,"value":"用例： 服务跟踪分析页面","slug":"用例-服务跟踪分析页面"},{"depth":2,"value":"用例： 服务删除过期的 pastes","slug":"用例-服务删除过期的-pastes"},{"depth":1,"value":"扩展设计","slug":"扩展设计"},{"depth":1,"value":"总结","slug":"总结"}]}},
    "staticQueryHashes": ["630634786","928362550"]}