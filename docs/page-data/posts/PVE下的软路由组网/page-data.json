{
    "componentChunkName": "component---src-templates-article-page-template-tsx",
    "path": "/posts/PVE下的软路由组网",
    "result": {"pageContext":{"id":"/posts/PVE下的软路由组网","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"从最开始折腾iKuai+OpenWrt到单Openwrt，到最后使用PVE搭建路由环境，前后将近快一年的时间。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　经历过频繁的断网，断流，死机，已经摸索出一套相对稳定的方案。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"软路由"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　我对软路由的需求有三个:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"分流设备，全局翻墙"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"DNS去广告"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"局域网存储用于播放内网视频"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　基于这些需求，我选择了J3160作为软路由的硬件配置。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　硬件:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"J3160 + 4G内存 + 32G固态 + 500G机械"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"小米A3600做的AP"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　网络拓扑图如下:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/%E8%BD%AF%E8%B7%AF%E7%94%B1.png","alt":"软路由"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"PVE系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　为了在折腾其他比如NAS，DNS的时候，依然能够保证网络的畅通，所以选用了PVE来当做底层系统，这样即使路由挂了，依然能够通过网页访问PVE中的各种系统。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"接口"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　我买的提供了4个网口，Lan 3口接入光猫，Lan1口接入路由。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/image-20211221165148379.png","alt":"image-20211221165148379"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"PVE中安装的系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Lede"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　lede作为主路由，承担了拨号、科学上网的职责。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　固件是自己编译的:  "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/zxcvbnmzsedr/Actions-OpenWrt-Template"},"children":[{"type":"text","value":"https://github.com/zxcvbnmzsedr/Actions-OpenWrt-Template"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　为了运行的稳定，只保留了相对基础的功能，以及 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"OpenClash"}]},{"type":"text","value":"、"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Zerotier"}]},{"type":"text","value":"、"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Ipv6"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"AdguardHome"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　直接通过PVE的LXC容器的alpine系统安装，最简化配置。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　分离DNS是由于OpenClash和DNS的依赖性太强了，而且AdguardHome和OpenClash共存方案都不够优雅，就直接分离了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　注意事项参考: "},{"type":"element","tagName":"a","properties":{"href":"https://www.ztianzeng.com/post/zai-shang-alpine-linux-an-zhuang-adguard-home/"},"children":[{"type":"text","value":"https://www.ztianzeng.com/post/zai-shang-alpine-linux-an-zhuang-adguard-home/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"openmediavault"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　采用OMV作为NAS的原因是它的资源远比群晖的低，且开源。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"硬路由"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　硬路由就是普通的家用路由。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　作用就两个:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"作为小型交换机，扩展LAN口"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"提供wifi信号"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　唯一需要注意的是，在设置路由的时候，将路由模式设置成桥接模式，这样对于硬路由而言它不再提供上网服务，只是作为流量的中间站，流量全会交给软路由进行处理。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/image-20211221171438933.png","alt":"image-20211221171438933"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　PS: 光猫需要改桥接，以获得最佳性能。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}},"html":"<p updated=\"20220722161128\">　　从最开始折腾iKuai+OpenWrt到单Openwrt，到最后使用PVE搭建路由环境，前后将近快一年的时间。</p>\n<p updated=\"20220722161128\">　　经历过频繁的断网，断流，死机，已经摸索出一套相对稳定的方案。</p>\n<h2 id=\"软路由\">软路由</h2>\n<p updated=\"20220722161128\">　　我对软路由的需求有三个:</p>\n<ol updated=\"20220722161128\">\n<li id=\"20220722161128-q7vfvte\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">分流设备，全局翻墙</p>\n</li>\n<li id=\"20220722161128-ew8y6kt\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">DNS去广告</p>\n</li>\n<li id=\"20220722161128-3iirscf\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">局域网存储用于播放内网视频</p>\n</li>\n</ol>\n<p updated=\"20220722161128\">　　基于这些需求，我选择了J3160作为软路由的硬件配置。</p>\n<p updated=\"20220722161128\">　　硬件:</p>\n<ul updated=\"20220722161128\">\n<li id=\"20220722161128-mja8j3u\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">J3160 + 4G内存 + 32G固态 + 500G机械</p>\n</li>\n<li id=\"20220722161128-9ovkguy\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">小米A3600做的AP</p>\n</li>\n</ul>\n<p updated=\"20220722161128\">　　网络拓扑图如下:</p>\n<p updated=\"20220722161128\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/%E8%BD%AF%E8%B7%AF%E7%94%B1.png\" alt=\"软路由\" /></span></p>\n<h2 id=\"PVE系统\">PVE系统</h2>\n<p updated=\"20220722161128\">　　为了在折腾其他比如NAS，DNS的时候，依然能够保证网络的畅通，所以选用了PVE来当做底层系统，这样即使路由挂了，依然能够通过网页访问PVE中的各种系统。</p>\n<h3 id=\"接口\">接口</h3>\n<p updated=\"20220722161128\">　　我买的提供了4个网口，Lan 3口接入光猫，Lan1口接入路由。</p>\n<p updated=\"20220722161128\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/image-20211221165148379.png\" alt=\"image-20211221165148379\" /></span></p>\n<h2 id=\"PVE中安装的系统\">PVE中安装的系统</h2>\n<h3 id=\"Lede\">Lede</h3>\n<p updated=\"20220722161128\">　　lede作为主路由，承担了拨号、科学上网的职责。</p>\n<p updated=\"20220722161128\">　　固件是自己编译的:  https://github.com/zxcvbnmzsedr/Actions-OpenWrt-Template</p>\n<p updated=\"20220722161128\">　　为了运行的稳定，只保留了相对基础的功能，以及 <code>OpenClash</code>、<code>Zerotier</code>、<code>Ipv6</code></p>\n<h3 id=\"AdguardHome\">AdguardHome</h3>\n<p updated=\"20220722161128\">　　直接通过PVE的LXC容器的alpine系统安装，最简化配置。</p>\n<p updated=\"20220722161128\">　　分离DNS是由于OpenClash和DNS的依赖性太强了，而且AdguardHome和OpenClash共存方案都不够优雅，就直接分离了。</p>\n<p updated=\"20220722161128\">　　注意事项参考: https://www.ztianzeng.com/post/zai-shang-alpine-linux-an-zhuang-adguard-home/</p>\n<h3 id=\"openmediavault\">openmediavault</h3>\n<p updated=\"20220722161128\">　　采用OMV作为NAS的原因是它的资源远比群晖的低，且开源。</p>\n<h2 id=\"硬路由\">硬路由</h2>\n<p updated=\"20220722161128\">　　硬路由就是普通的家用路由。</p>\n<p updated=\"20220722161128\">　　作用就两个:</p>\n<ol updated=\"20220722161128\">\n<li id=\"20220722161128-m4d8tfe\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">作为小型交换机，扩展LAN口</p>\n</li>\n<li id=\"20220722161128-vovupkp\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">提供wifi信号</p>\n</li>\n</ol>\n<p updated=\"20220722161128\">　　唯一需要注意的是，在设置路由的时候，将路由模式设置成桥接模式，这样对于硬路由而言它不再提供上网服务，只是作为流量的中间站，流量全会交给软路由进行处理。</p>\n<p updated=\"20220722161128\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/image-20211221171438933.png\" alt=\"image-20211221171438933\" /></span></p>\n<p updated=\"20220722161128\">　　PS: 光猫需要改桥接，以获得最佳性能。</p>\n","articleNode":{"field":{"contentType":"posts","topic":null},"frontmatter":{"id":"/posts/PVE下的软路由组网","title":"PVE下的软路由组网","date":"2022-04-21 15:48","absolute_path":"/posts/PVE下的软路由组网"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"从最开始折腾iKuai+OpenWrt到单Openwrt，到最后使用PVE搭建路由环境，前后将近快一年的时间。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　经历过频繁的断网，断流，死机，已经摸索出一套相对稳定的方案。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"软路由"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　我对软路由的需求有三个:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"分流设备，全局翻墙"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"DNS去广告"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"局域网存储用于播放内网视频"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　基于这些需求，我选择了J3160作为软路由的硬件配置。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　硬件:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"J3160 + 4G内存 + 32G固态 + 500G机械"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"小米A3600做的AP"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　网络拓扑图如下:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/%E8%BD%AF%E8%B7%AF%E7%94%B1.png","alt":"软路由"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"PVE系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　为了在折腾其他比如NAS，DNS的时候，依然能够保证网络的畅通，所以选用了PVE来当做底层系统，这样即使路由挂了，依然能够通过网页访问PVE中的各种系统。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"接口"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　我买的提供了4个网口，Lan 3口接入光猫，Lan1口接入路由。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/image-20211221165148379.png","alt":"image-20211221165148379"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"PVE中安装的系统"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Lede"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　lede作为主路由，承担了拨号、科学上网的职责。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　固件是自己编译的:  "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/zxcvbnmzsedr/Actions-OpenWrt-Template"},"children":[{"type":"text","value":"https://github.com/zxcvbnmzsedr/Actions-OpenWrt-Template"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　为了运行的稳定，只保留了相对基础的功能，以及 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"OpenClash"}]},{"type":"text","value":"、"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Zerotier"}]},{"type":"text","value":"、"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Ipv6"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"AdguardHome"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　直接通过PVE的LXC容器的alpine系统安装，最简化配置。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　分离DNS是由于OpenClash和DNS的依赖性太强了，而且AdguardHome和OpenClash共存方案都不够优雅，就直接分离了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　注意事项参考: "},{"type":"element","tagName":"a","properties":{"href":"https://www.ztianzeng.com/post/zai-shang-alpine-linux-an-zhuang-adguard-home/"},"children":[{"type":"text","value":"https://www.ztianzeng.com/post/zai-shang-alpine-linux-an-zhuang-adguard-home/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"openmediavault"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　采用OMV作为NAS的原因是它的资源远比群晖的低，且开源。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"硬路由"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　硬路由就是普通的家用路由。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　作用就两个:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"作为小型交换机，扩展LAN口"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"提供wifi信号"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　唯一需要注意的是，在设置路由的时候，将路由模式设置成桥接模式，这样对于硬路由而言它不再提供上网服务，只是作为流量的中间站，流量全会交给软路由进行处理。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　"},{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/image-20211221171438933.png","alt":"image-20211221171438933"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"　　PS: 光猫需要改桥接，以获得最佳性能。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}},"html":"<p updated=\"20220722161128\">　　从最开始折腾iKuai+OpenWrt到单Openwrt，到最后使用PVE搭建路由环境，前后将近快一年的时间。</p>\n<p updated=\"20220722161128\">　　经历过频繁的断网，断流，死机，已经摸索出一套相对稳定的方案。</p>\n<h2 id=\"软路由\">软路由</h2>\n<p updated=\"20220722161128\">　　我对软路由的需求有三个:</p>\n<ol updated=\"20220722161128\">\n<li id=\"20220722161128-q7vfvte\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">分流设备，全局翻墙</p>\n</li>\n<li id=\"20220722161128-ew8y6kt\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">DNS去广告</p>\n</li>\n<li id=\"20220722161128-3iirscf\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">局域网存储用于播放内网视频</p>\n</li>\n</ol>\n<p updated=\"20220722161128\">　　基于这些需求，我选择了J3160作为软路由的硬件配置。</p>\n<p updated=\"20220722161128\">　　硬件:</p>\n<ul updated=\"20220722161128\">\n<li id=\"20220722161128-mja8j3u\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">J3160 + 4G内存 + 32G固态 + 500G机械</p>\n</li>\n<li id=\"20220722161128-9ovkguy\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">小米A3600做的AP</p>\n</li>\n</ul>\n<p updated=\"20220722161128\">　　网络拓扑图如下:</p>\n<p updated=\"20220722161128\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/%E8%BD%AF%E8%B7%AF%E7%94%B1.png\" alt=\"软路由\" /></span></p>\n<h2 id=\"PVE系统\">PVE系统</h2>\n<p updated=\"20220722161128\">　　为了在折腾其他比如NAS，DNS的时候，依然能够保证网络的畅通，所以选用了PVE来当做底层系统，这样即使路由挂了，依然能够通过网页访问PVE中的各种系统。</p>\n<h3 id=\"接口\">接口</h3>\n<p updated=\"20220722161128\">　　我买的提供了4个网口，Lan 3口接入光猫，Lan1口接入路由。</p>\n<p updated=\"20220722161128\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/image-20211221165148379.png\" alt=\"image-20211221165148379\" /></span></p>\n<h2 id=\"PVE中安装的系统\">PVE中安装的系统</h2>\n<h3 id=\"Lede\">Lede</h3>\n<p updated=\"20220722161128\">　　lede作为主路由，承担了拨号、科学上网的职责。</p>\n<p updated=\"20220722161128\">　　固件是自己编译的:  https://github.com/zxcvbnmzsedr/Actions-OpenWrt-Template</p>\n<p updated=\"20220722161128\">　　为了运行的稳定，只保留了相对基础的功能，以及 <code>OpenClash</code>、<code>Zerotier</code>、<code>Ipv6</code></p>\n<h3 id=\"AdguardHome\">AdguardHome</h3>\n<p updated=\"20220722161128\">　　直接通过PVE的LXC容器的alpine系统安装，最简化配置。</p>\n<p updated=\"20220722161128\">　　分离DNS是由于OpenClash和DNS的依赖性太强了，而且AdguardHome和OpenClash共存方案都不够优雅，就直接分离了。</p>\n<p updated=\"20220722161128\">　　注意事项参考: https://www.ztianzeng.com/post/zai-shang-alpine-linux-an-zhuang-adguard-home/</p>\n<h3 id=\"openmediavault\">openmediavault</h3>\n<p updated=\"20220722161128\">　　采用OMV作为NAS的原因是它的资源远比群晖的低，且开源。</p>\n<h2 id=\"硬路由\">硬路由</h2>\n<p updated=\"20220722161128\">　　硬路由就是普通的家用路由。</p>\n<p updated=\"20220722161128\">　　作用就两个:</p>\n<ol updated=\"20220722161128\">\n<li id=\"20220722161128-m4d8tfe\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">作为小型交换机，扩展LAN口</p>\n</li>\n<li id=\"20220722161128-vovupkp\" updated=\"20220722161128\">\n<p updated=\"20220722161128\">提供wifi信号</p>\n</li>\n</ol>\n<p updated=\"20220722161128\">　　唯一需要注意的是，在设置路由的时候，将路由模式设置成桥接模式，这样对于硬路由而言它不再提供上网服务，只是作为流量的中间站，流量全会交给软路由进行处理。</p>\n<p updated=\"20220722161128\">　　<span class=\"img\"><img src=\"https://image.ztianzeng.com/uPic/image-20211221171438933.png\" alt=\"image-20211221171438933\" /></span></p>\n<p updated=\"20220722161128\">　　PS: 光猫需要改桥接，以获得最佳性能。</p>\n","headings":[{"depth":2,"value":"软路由"},{"depth":2,"value":"PVE系统"},{"depth":3,"value":"接口"},{"depth":2,"value":"PVE中安装的系统"},{"depth":3,"value":"Lede"},{"depth":3,"value":"AdguardHome"},{"depth":3,"value":"openmediavault"},{"depth":2,"value":"硬路由"}],"path":"/posts/PVE下的软路由组网"},"headings":[{"depth":2,"value":"软路由","slug":"软路由"},{"depth":2,"value":"PVE系统","slug":"pve系统"},{"depth":3,"value":"接口","slug":"接口"},{"depth":2,"value":"PVE中安装的系统","slug":"pve中安装的系统"},{"depth":3,"value":"Lede","slug":"lede"},{"depth":3,"value":"AdguardHome","slug":"adguardhome"},{"depth":3,"value":"openmediavault","slug":"openmediavault"},{"depth":2,"value":"硬路由","slug":"硬路由"}]}},
    "staticQueryHashes": ["630634786","928362550"]}