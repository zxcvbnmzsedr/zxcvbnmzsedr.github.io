{
    "componentChunkName": "component---src-templates-article-page-template-tsx",
    "path": "/posts/Cloudflare让IPV6不在鸡肋",
    "result": {"pageContext":{"id":"/posts/Cloudflare让IPV6不在鸡肋","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Cloudflare让IPV6不在鸡肋"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"前言"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"随着国内IPV4的公网地址越来越少，以及IPV6的不断普及，我们能够很方便的获取到公网的IPV6地址。但是在外面没有IPV6的情况下，想要访问家里的IPV6服务是一件很困难的事情。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"虽然有着共有的6in4，或者ipv4转v6的代理隧道可以用，但是实际用下来，感觉由于代理服务器的影响，没有办法达到预期的速度。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://tunnelbroker.net/"},"children":[{"type":"text","value":"https://tunnelbroker.net/"}]},{"type":"text","value":" 提供了免费的IPV6隧道服务"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"不过，国外有一个非常好用的CDN提供商，"},{"type":"element","tagName":"a","properties":{"href":"https://www.cloudflare.com/zh-cn/"},"children":[{"type":"text","value":"CloudFlare"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"它提供了一整套免费的CDN加速和代理，我们只需要通过CDN来代理请求的IPV6地址即可。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220613131516.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"准备工作"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"要想使用这套服务，直接访问到家中的设备需要准备下面这几样东西:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个属于自己的域名"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个能够编写脚本的路由器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"有一定动手能力,爱折腾"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"开始折腾"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们第一步需要确保域名接入到了cloudflare中。通过修改名称服务器，将域名交给cloudflare进行托管。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"然后在cloudflare中新建一个了类型是AAAA的DNS，内容随便写啥。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因为我用的是Openwrt，所以会以OpenWrt来进行说明"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"先登录OpenWrt的路由器, 查看LAN口的获取到的IPV6地址，把这个IPV6地址粘贴到CloudFlare中。（关于OpenWrt如何开启IPV6，网上教程很多）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"然后将Openwrt的端口修改成下面的任何一个（下面这些端口是CloudFlare支持的反向代理的端口，其次国内家用端口封80和443，我选择的是2095）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"8880"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2052"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2082"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2086"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2095"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果不能访问，一般是由于防火墙的问题，我们可以用5G手机，直接访问[:IPV6地址:]:2095，来确定是不是防火墙的问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"assets/image-20220613133004-4e6ek00.png","alt":"image.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果一切设置完成，就能访问了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"必须将代理状态设置成已代理，否则就会你和配置的域名之间就会走IPV6的方式访问。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"DDNS"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"由于我们拿到的IPV6是每次拨号都是在变化的，所以要能定时将最新的IPV6地址上报上去。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"脚本在下面:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"脚本需要用到jq，所以提取先安装"},{"type":"element","tagName":"a","properties":{"href":"https://stedolan.github.io/jq/download/"},"children":[{"type":"text","value":"jq"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"#!/bin/bash\n\n#LEDE/Openwrt may need install ca-bundle curl(opkg install ca-bundle curl)\n\n#Add you custom record to the CloudFlare first.\n\n#Your sub domain\nSUB_DOMAIN=\"webdav.shiyitopo.tech\"\n#dash --> example.com --> Overview --> Zone ID:\n#https://dash.cloudflare.com/_your_account_id_/example.com\nZONE_ID=\"\"\n#API Tokens\n#https://dash.cloudflare.com/profile/api-tokens\n#Manage access and permissions for your accounts, sites, and products\n#example.com- Zone:Read, DNS:Edit\nTOKEN_ID=\"\"\n#The path of jq binaries . Download from https://stedolan.github.io/jq/download/\n#If the system has installed jq. Just typed jq.\n#If you custom a special binary. Just type the path of jq\nJQ_PATH=\"/root/jq-linux64\"\n\nif [ -n \"$DNS_ZONE_ID\" ]; then\n    echo \"The user has not configure the the ZONE ID \"\n    exit 1\nfi\n\necho \"Your dns zone id is: $ZONE_ID\"\njsonResult=$(curl -s -X GET \"https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records\" \\\n    -H \"Authorization: Bearer ${TOKEN_ID}\" \\\n    -H \"Content-Type: application/json\")\n\ncurlResult=$(echo $jsonResult | $JQ_PATH -r .success)\n\nif [ \"$curlResult\" = true ]; then\n    echo \"Get dns record success.\"\nelse\n    echo \"Get dns record fail.$jsonResult\"\n    exit 1\nfi\n\nrecordSize=$(echo $jsonResult | $JQ_PATH .result | $JQ_PATH length)\necho \"Total found $recordSize record\"\n\nindex=0\nwhile [ $index -lt $recordSize ]; do\n    tResult=$(echo $jsonResult | $JQ_PATH -r .result[$index])\n    tmpDomain=$(echo $tResult | $JQ_PATH -r .name)\n    type=$(echo $tResult | $JQ_PATH -r .type)\n\n    if [ \"$tmpDomain\"x = \"$SUB_DOMAIN\"x ]; then\n        if [ \"AAAA\"x = \"$type\"x ]; then\n            echo \"Found AAAA domain:$tmpDomain\"\n            identifier_v6=$(echo $tResult | $JQ_PATH -r .id)\n        elif [ \"A\"x = \"$type\"x ]; then\n            echo \"Found A domain:$tmpDomain\"\n            identifier_v4=$(echo $tResult | $JQ_PATH -r .id)\n        else\n            echo \"Please add the A or AAAA record manually first.\"\n        fi\n    fi\n    index=$(expr $index + 1)\ndone\n\nif [ -z \"$identifier_v4\" ] && [ -z \"$identifier_v6\" ]; then\n    echo \"Get '$SUB_DOMAIN' identifier failed. Please add the A or AAAA record manually first.\"\n    exit 1\nelse\n    echo \"Get '$SUB_DOMAIN' identifier success. [A] identifier:$identifier_v4 [AAAA] identifier:$identifier_v6\"\nfi\n\nif [ -z \"$identifier_v4\" ]; then\n    echo \"IPv4 address are not required.\"\nelse\n    #IP=$(curl -s http://members.3322.org/dyndns/getip)\n    IP=$(curl -s http://ip.3322.net/)\n    regex='\\b((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\\.|$)){4}\\b'\n    matchIP=$(echo $IP | grep -E $regex)\n    if [ -n \"$matchIP\" ]; then\n        echo \"[$IP] IPv4 matches...\"\n        jsonResult=$(curl -s -X PUT \"https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records/${identifier_v4}\" \\\n            -H \"Authorization: Bearer ${TOKEN_ID}\" \\\n            -H \"Content-Type: application/json\" \\\n            --data '{\"type\":\"A\",\"name\":\"'${SUB_DOMAIN}'\",\"content\":\"'${IP}'\",\"ttl\":1,\"proxied\":false}')\n        curlResult=$(echo $jsonResult | $JQ_PATH -r .success)\n\n        if [ \"$curlResult\" = true ]; then\n            echo \"Update IPv4 dns record success.\"\n        else\n            echo \"Update IPv4 dns record fail.\"\n        fi\n    else\n        echo \"[$IP]IPv4 doesn't match!\"\n    fi\nfi\n\nif [ -z \"$identifier_v6\" ]; then\n    echo \"IPv6 addresses are not required.\"\nelse\n    #IP=$(curl -6 ip.sb)\n    IP=$(ip addr show dev  ens18|sed -e's/^.*inet6 \\([^ ]*\\)\\/.*$/\\1/;t;d'|grep 2409|head -1)\n    regex='^([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}$'\n    matchIP=$(echo $IP | grep -E $regex)\n    if [ -n \"$matchIP\" ]; then\n        echo \"[$IP] IPv6 matches...\"\n        echo \"Update IPv6 ...\"\n        jsonResult=$(curl -s -X PUT \"https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records/${identifier_v6}\" \\\n            -H \"Authorization: Bearer ${TOKEN_ID}\" \\\n            -H \"Content-Type: application/json\" \\\n            --data '{\"type\":\"AAAA\",\"name\":\"'${SUB_DOMAIN}'\",\"content\":\"'${IP}'\",\"ttl\":1,\"proxied\":true}')\n        curlResult=$(echo $jsonResult | $JQ_PATH -r .success)\n\n        if [ \"$curlResult\" = true ]; then\n            echo \"Update IPv6 dns record success.\"\n        else\n            echo \"Update IPv6 dns record fail.\"\n        fi\n    else\n        echo \"[$IP] IPv6 doesn't match!\"\n    fi\nfi\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"后续也能通过Nginx进行反向代理，这样就不用配置其他服务的域名了，只需要通过nginx进行统一的转发即可。"}]}],"data":{"quirksMode":false}},"articleNode":{"field":{"contentType":"posts","topic":null},"frontmatter":{"id":"/posts/Cloudflare让IPV6不在鸡肋","title":"Cloudflare让IPV6不在鸡肋","date":"2022-06-13 11:13","absolute_path":"/posts/Cloudflare让IPV6不在鸡肋"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Cloudflare让IPV6不在鸡肋"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"前言"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"随着国内IPV4的公网地址越来越少，以及IPV6的不断普及，我们能够很方便的获取到公网的IPV6地址。但是在外面没有IPV6的情况下，想要访问家里的IPV6服务是一件很困难的事情。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"虽然有着共有的6in4，或者ipv4转v6的代理隧道可以用，但是实际用下来，感觉由于代理服务器的影响，没有办法达到预期的速度。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://tunnelbroker.net/"},"children":[{"type":"text","value":"https://tunnelbroker.net/"}]},{"type":"text","value":" 提供了免费的IPV6隧道服务"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"不过，国外有一个非常好用的CDN提供商，"},{"type":"element","tagName":"a","properties":{"href":"https://www.cloudflare.com/zh-cn/"},"children":[{"type":"text","value":"CloudFlare"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"它提供了一整套免费的CDN加速和代理，我们只需要通过CDN来代理请求的IPV6地址即可。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://image.ztianzeng.com/uPic/20220613131516.png","alt":""},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"准备工作"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"要想使用这套服务，直接访问到家中的设备需要准备下面这几样东西:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个属于自己的域名"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"一个能够编写脚本的路由器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"有一定动手能力,爱折腾"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"开始折腾"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们第一步需要确保域名接入到了cloudflare中。通过修改名称服务器，将域名交给cloudflare进行托管。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"然后在cloudflare中新建一个了类型是AAAA的DNS，内容随便写啥。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因为我用的是Openwrt，所以会以OpenWrt来进行说明"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"先登录OpenWrt的路由器, 查看LAN口的获取到的IPV6地址，把这个IPV6地址粘贴到CloudFlare中。（关于OpenWrt如何开启IPV6，网上教程很多）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"然后将Openwrt的端口修改成下面的任何一个（下面这些端口是CloudFlare支持的反向代理的端口，其次国内家用端口封80和443，我选择的是2095）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"8880"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2052"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2082"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2086"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"2095"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果不能访问，一般是由于防火墙的问题，我们可以用5G手机，直接访问[:IPV6地址:]:2095，来确定是不是防火墙的问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"assets/image-20220613133004-4e6ek00.png","alt":"image.png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果一切设置完成，就能访问了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"必须将代理状态设置成已代理，否则就会你和配置的域名之间就会走IPV6的方式访问。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"DDNS"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"由于我们拿到的IPV6是每次拨号都是在变化的，所以要能定时将最新的IPV6地址上报上去。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"脚本在下面:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"脚本需要用到jq，所以提取先安装"},{"type":"element","tagName":"a","properties":{"href":"https://stedolan.github.io/jq/download/"},"children":[{"type":"text","value":"jq"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"#!/bin/bash\n\n#LEDE/Openwrt may need install ca-bundle curl(opkg install ca-bundle curl)\n\n#Add you custom record to the CloudFlare first.\n\n#Your sub domain\nSUB_DOMAIN=\"webdav.shiyitopo.tech\"\n#dash --> example.com --> Overview --> Zone ID:\n#https://dash.cloudflare.com/_your_account_id_/example.com\nZONE_ID=\"\"\n#API Tokens\n#https://dash.cloudflare.com/profile/api-tokens\n#Manage access and permissions for your accounts, sites, and products\n#example.com- Zone:Read, DNS:Edit\nTOKEN_ID=\"\"\n#The path of jq binaries . Download from https://stedolan.github.io/jq/download/\n#If the system has installed jq. Just typed jq.\n#If you custom a special binary. Just type the path of jq\nJQ_PATH=\"/root/jq-linux64\"\n\nif [ -n \"$DNS_ZONE_ID\" ]; then\n    echo \"The user has not configure the the ZONE ID \"\n    exit 1\nfi\n\necho \"Your dns zone id is: $ZONE_ID\"\njsonResult=$(curl -s -X GET \"https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records\" \\\n    -H \"Authorization: Bearer ${TOKEN_ID}\" \\\n    -H \"Content-Type: application/json\")\n\ncurlResult=$(echo $jsonResult | $JQ_PATH -r .success)\n\nif [ \"$curlResult\" = true ]; then\n    echo \"Get dns record success.\"\nelse\n    echo \"Get dns record fail.$jsonResult\"\n    exit 1\nfi\n\nrecordSize=$(echo $jsonResult | $JQ_PATH .result | $JQ_PATH length)\necho \"Total found $recordSize record\"\n\nindex=0\nwhile [ $index -lt $recordSize ]; do\n    tResult=$(echo $jsonResult | $JQ_PATH -r .result[$index])\n    tmpDomain=$(echo $tResult | $JQ_PATH -r .name)\n    type=$(echo $tResult | $JQ_PATH -r .type)\n\n    if [ \"$tmpDomain\"x = \"$SUB_DOMAIN\"x ]; then\n        if [ \"AAAA\"x = \"$type\"x ]; then\n            echo \"Found AAAA domain:$tmpDomain\"\n            identifier_v6=$(echo $tResult | $JQ_PATH -r .id)\n        elif [ \"A\"x = \"$type\"x ]; then\n            echo \"Found A domain:$tmpDomain\"\n            identifier_v4=$(echo $tResult | $JQ_PATH -r .id)\n        else\n            echo \"Please add the A or AAAA record manually first.\"\n        fi\n    fi\n    index=$(expr $index + 1)\ndone\n\nif [ -z \"$identifier_v4\" ] && [ -z \"$identifier_v6\" ]; then\n    echo \"Get '$SUB_DOMAIN' identifier failed. Please add the A or AAAA record manually first.\"\n    exit 1\nelse\n    echo \"Get '$SUB_DOMAIN' identifier success. [A] identifier:$identifier_v4 [AAAA] identifier:$identifier_v6\"\nfi\n\nif [ -z \"$identifier_v4\" ]; then\n    echo \"IPv4 address are not required.\"\nelse\n    #IP=$(curl -s http://members.3322.org/dyndns/getip)\n    IP=$(curl -s http://ip.3322.net/)\n    regex='\\b((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\\.|$)){4}\\b'\n    matchIP=$(echo $IP | grep -E $regex)\n    if [ -n \"$matchIP\" ]; then\n        echo \"[$IP] IPv4 matches...\"\n        jsonResult=$(curl -s -X PUT \"https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records/${identifier_v4}\" \\\n            -H \"Authorization: Bearer ${TOKEN_ID}\" \\\n            -H \"Content-Type: application/json\" \\\n            --data '{\"type\":\"A\",\"name\":\"'${SUB_DOMAIN}'\",\"content\":\"'${IP}'\",\"ttl\":1,\"proxied\":false}')\n        curlResult=$(echo $jsonResult | $JQ_PATH -r .success)\n\n        if [ \"$curlResult\" = true ]; then\n            echo \"Update IPv4 dns record success.\"\n        else\n            echo \"Update IPv4 dns record fail.\"\n        fi\n    else\n        echo \"[$IP]IPv4 doesn't match!\"\n    fi\nfi\n\nif [ -z \"$identifier_v6\" ]; then\n    echo \"IPv6 addresses are not required.\"\nelse\n    #IP=$(curl -6 ip.sb)\n    IP=$(ip addr show dev  ens18|sed -e's/^.*inet6 \\([^ ]*\\)\\/.*$/\\1/;t;d'|grep 2409|head -1)\n    regex='^([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}$'\n    matchIP=$(echo $IP | grep -E $regex)\n    if [ -n \"$matchIP\" ]; then\n        echo \"[$IP] IPv6 matches...\"\n        echo \"Update IPv6 ...\"\n        jsonResult=$(curl -s -X PUT \"https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records/${identifier_v6}\" \\\n            -H \"Authorization: Bearer ${TOKEN_ID}\" \\\n            -H \"Content-Type: application/json\" \\\n            --data '{\"type\":\"AAAA\",\"name\":\"'${SUB_DOMAIN}'\",\"content\":\"'${IP}'\",\"ttl\":1,\"proxied\":true}')\n        curlResult=$(echo $jsonResult | $JQ_PATH -r .success)\n\n        if [ \"$curlResult\" = true ]; then\n            echo \"Update IPv6 dns record success.\"\n        else\n            echo \"Update IPv6 dns record fail.\"\n        fi\n    else\n        echo \"[$IP] IPv6 doesn't match!\"\n    fi\nfi\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"后续也能通过Nginx进行反向代理，这样就不用配置其他服务的域名了，只需要通过nginx进行统一的转发即可。"}]}],"data":{"quirksMode":false}},"headings":[{"depth":1,"value":"Cloudflare让IPV6不在鸡肋"},{"depth":1,"value":"前言"},{"depth":1,"value":"准备工作"},{"depth":1,"value":"开始折腾"},{"depth":1,"value":"DDNS"}],"path":"/posts/Cloudflare让IPV6不在鸡肋"},"headings":[{"depth":1,"value":"Cloudflare让IPV6不在鸡肋","slug":"cloudflare让ipv6不在鸡肋"},{"depth":1,"value":"前言","slug":"前言"},{"depth":1,"value":"准备工作","slug":"准备工作"},{"depth":1,"value":"开始折腾","slug":"开始折腾"},{"depth":1,"value":"DDNS","slug":"ddns"}]}},
    "staticQueryHashes": ["630634786","928362550"]}