(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{402:function(a,s,t){"use strict";t.r(s);var e=t(7),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"mysql性能优化-索引下推"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql性能优化-索引下推"}},[a._v("#")]),a._v(" MySQL性能优化-索引下推")]),a._v(" "),s("p",[a._v("索引下推是MySQL5.6的一个新特性，在之前是没有的，这块的知识比较冷门。")]),a._v(" "),s("p",[a._v("索引下推通俗一点讲就是 "),s("code",[a._v("在Service层把查询工作下推到引擎层去处理")]),a._v("。其下推的目的是为了减少回表次数，提高查询效率，节约IO开销。")]),a._v(" "),s("p",[a._v("‍")]),a._v(" "),s("h2",{attrs:{id:"mysql的查询逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql的查询逻辑"}},[a._v("#")]),a._v(" MySQL的查询逻辑")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ztianzeng.com/uPic/20220808152254.png",alt:""}}),a._v("​")]),a._v(" "),s("p",[a._v("当客户端从连接过来之后，就交由给Service层来进行处理，Service主要是执行一些语句的处理和优化，然后交由给引擎层进行处理。")]),a._v(" "),s("p",[a._v("在这个当中，原本由Service层处理的一些逻辑，下推到引擎层进行处理，这个过程就叫做索引下推。")]),a._v(" "),s("h2",{attrs:{id:"案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[a._v("#")]),a._v(" 案例")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ztianzeng.com/uPic/20220808153434.png",alt:""}}),a._v("​")]),a._v(" "),s("p",[a._v("创建一个表，然后对name 和 age 建立一个联合索引。")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("index")]),a._v(" idx "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("然后我们执行一个简单的查询，来分析他是怎么进行处理的")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("select")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("where")]),a._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("like")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'张%'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("and")]),a._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"没有使用索引下推"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#没有使用索引下推"}},[a._v("#")]),a._v(" 没有使用索引下推")]),a._v(" "),s("p",[a._v("在没有使用索引下推的情况下")]),a._v(" "),s("p",[a._v("存储引擎读取索引记录，根据索引中的主键值回表读取出完整的行记录；")]),a._v(" "),s("p",[a._v("存储引擎将回表之后的数据提交给Service层去检测，剩下的age是否满足Where条件。")]),a._v(" "),s("p",[a._v("也就是说，原本即使配置了二级索引，也不会起效")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ztianzeng.com/uPic/20220808154308.png",alt:""}}),a._v("​")]),a._v(" "),s("h3",{attrs:{id:"使用了索引下推"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用了索引下推"}},[a._v("#")]),a._v(" 使用了索引下推")]),a._v(" "),s("p",[a._v("使用了索引下推之后，在引擎层就做了age的判断，因为做了判断在回表的时候只需要回表一次即可。")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ztianzeng.com/uPic/20220808154457.png",alt:""}}),a._v("​")]),a._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("如果我么能用Explain去查看这个SQL")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("explain")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("select")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("where")]),a._v(" name linke "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'张%'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("and")]),a._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n")])])]),s("p",[a._v("就能看到Extra一列中，Using index condition。这就是用到索引下推。")]),a._v(" "),s("p",[a._v("‍")])])}),[],!1,null,null,null);s.default=r.exports}}]);