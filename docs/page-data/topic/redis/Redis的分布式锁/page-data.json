{
    "componentChunkName": "component---src-templates-topic-page-template-tsx",
    "path": "/topic/redis/Redis的分布式锁",
    "result": {"pageContext":{"id":"/topic/redis/Redis的分布式锁","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Redis的分布式锁"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"利用redis实现分布式锁"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"三个重要因素"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"加锁:  加锁实际上就是在redis中，给Key键设置一个值，为避免死锁，并给定一个过期时间"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"解锁: 将Key键删除。但也不能乱删，不能说客户端1的请求将客户端2的锁给删除掉，只能自己删除自己的锁"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"超时: 不能长期占用"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"涉及命令"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"SETNX: 当KEY不存在的时候设置KEY的值为value，返回1，当KEY存在的时候，不做任何动作返回0。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"shell","dataIndex":"0"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"redis> setnx key value"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"\t1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"redis> setnx key value"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"\t0"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{"start":2},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"EXPIRE: 为KEY设计一个超时时间，到期自动释放，避免死锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"DELETE: 删除KEY，用于业务处理完手动释放锁。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"实现思想"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"随机生成一个UUID，标记是当前线程，调用SETNX方法设置值，并且调用expire方法为锁加一个超期时间，到期自动释放锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"获取锁的时候，加一个超期时间，超过时间则放弃去竞争锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"释放锁的时候，判断UUID是不是  该锁，如果是则执行DELETE进行释放。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["mermaid"],"dataProcessed":"true"},"children":[{"type":"element","tagName":"svg","properties":{"id":"mermaid-1656552808215","width":"100%","xmlns":"http://www.w3.org/2000/svg","xmlnsXLink":"http://www.w3.org/1999/xlink","height":"805","style":"max-width: 488.462890625px;","viewBox":"0 0 488.462890625 805"},"children":[{"type":"element","tagName":"style","properties":{},"children":[{"type":"text","value":"#mermaid-1656552808215 {font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1656552808215 .error-icon{fill:#552222;}#mermaid-1656552808215 .error-text{fill:#552222;stroke:#552222;}#mermaid-1656552808215 .edge-thickness-normal{stroke-width:2px;}#mermaid-1656552808215 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1656552808215 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1656552808215 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1656552808215 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1656552808215 .marker{fill:#333333;stroke:#333333;}#mermaid-1656552808215 .marker.cross{stroke:#333333;}#mermaid-1656552808215 svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-1656552808215 .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-1656552808215 .cluster-label text{fill:#333;}#mermaid-1656552808215 .cluster-label span{color:#333;}#mermaid-1656552808215 .label text,#mermaid-1656552808215 span{fill:#333;color:#333;}#mermaid-1656552808215 .node rect,#mermaid-1656552808215 .node circle,#mermaid-1656552808215 .node ellipse,#mermaid-1656552808215 .node polygon,#mermaid-1656552808215 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1656552808215 .node .label{text-align:center;}#mermaid-1656552808215 .node.clickable{cursor:pointer;}#mermaid-1656552808215 .arrowheadPath{fill:#333333;}#mermaid-1656552808215 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1656552808215 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1656552808215 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1656552808215 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1656552808215 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1656552808215 .cluster text{fill:#333;}#mermaid-1656552808215 .cluster span{color:#333;}#mermaid-1656552808215 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1656552808215 :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}"}]},{"type":"element","tagName":"g","properties":{"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"marker","properties":{"id":"flowchart-pointEnd","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"12","markerHeight":"12","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-pointStart","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"0","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"12","markerHeight":"12","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 5 L 10 10 L 10 0 z","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-circleEnd","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"11","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"circle","properties":{"cx":"5","cy":"5","r":"5","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-circleStart","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"-1","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"circle","properties":{"cx":"5","cy":"5","r":"5","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-crossEnd","className":["marker","cross","flowchart"],"viewBox":"0 0 11 11","refX":"12","refY":"5.2","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 1,1 l 9,9 M 10,1 l -9,9","className":["arrowMarkerPath"],"style":"stroke-width: 2; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-crossStart","className":["marker","cross","flowchart"],"viewBox":"0 0 11 11","refX":"-1","refY":"5.2","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 1,1 l 9,9 M 10,1 l -9,9","className":["arrowMarkerPath"],"style":"stroke-width: 2; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"g","properties":{"className":["root"]},"children":[{"type":"element","tagName":"g","properties":{"className":["clusters"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["edgePaths"]},"children":[{"type":"element","tagName":"path","properties":{"d":"M161.15625,45.5L161.15625,49.666666666666664C161.15625,53.833333333333336,161.15625,62.166666666666664,161.15625,70.5C161.15625,78.83333333333333,161.15625,87.16666666666667,161.15625,91.33333333333333L161.15625,95.5","id":"L-获取锁-B-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-获取锁","LE-B"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M134.27678571428572,133L128.30357142857144,137.16666666666666C122.33035714285715,141.33333333333334,110.38392857142857,149.66666666666666,104.49404761904763,165.92578125C98.60416666666667,182.18489583333334,98.77083333333333,206.36979166666666,98.85416666666667,218.46223958333334L98.9375,230.5546875","id":"L-B-C-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-B","LE-C"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.9375,355.4453125L98.85416666666667,369.24609375C98.77083333333333,383.046875,98.60416666666667,410.6484375,98.52083333333333,430.4908854166667C98.4375,450.3333333333333,98.4375,462.4166666666667,98.4375,468.4583333333333L98.4375,474.5","id":"L-C-E-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-C","LE-E"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.4375,512L98.4375,518.0416666666666C98.4375,524.0833333333334,98.4375,536.1666666666666,98.4375,548.25C98.4375,560.3333333333334,98.4375,572.4166666666666,98.4375,578.4583333333334L98.4375,584.5","id":"L-E-F-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-E","LE-F"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.4375,622L98.4375,626.1666666666666C98.4375,630.3333333333334,98.4375,638.6666666666666,98.4375,647C98.4375,655.3333333333334,98.4375,663.6666666666666,98.4375,667.8333333333334L98.4375,672","id":"L-F-G-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-F","LE-G"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.4375,709.5L98.4375,713.6666666666666C98.4375,717.8333333333334,98.4375,726.1666666666666,104.97395833333333,734.892895698389C111.51041666666667,743.6191247301113,124.58333333333333,752.7382494602225,131.11979166666666,757.2978118252782L137.65625,761.8573741903339","id":"L-G-结束-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-G","LE-结束"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M188.03571428571428,133L194.00892857142856,137.16666666666666C199.98214285714286,141.33333333333334,211.92857142857142,149.66666666666666,217.9017857142857,176.25C223.875,202.83333333333334,223.875,247.66666666666666,223.875,294.375C223.875,341.0833333333333,223.875,389.6666666666667,223.875,423.125C223.875,456.5833333333333,223.875,474.9166666666667,223.875,493.25C223.875,511.5833333333333,223.875,529.9166666666666,223.875,548.25C223.875,566.5833333333334,223.875,584.9166666666666,223.875,601.375C223.875,617.8333333333334,223.875,632.4166666666666,223.875,647C223.875,661.5833333333334,223.875,676.1666666666666,223.875,690.75C223.875,705.3333333333334,223.875,719.9166666666666,217.33854166666666,731.767895698389C210.80208333333334,743.6191247301113,197.72916666666666,752.7382494602225,191.19270833333334,757.2978118252782L184.65625,761.8573741903339","id":"L-B-结束-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-B","LE-结束"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M370.962890625,45.5L370.962890625,49.666666666666664C370.962890625,53.833333333333336,370.962890625,62.166666666666664,370.962890625,70.5C370.962890625,78.83333333333333,370.962890625,87.16666666666667,370.962890625,91.33333333333333L370.962890625,95.5","id":"L-释放锁-执行GET-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-释放锁","LE-执行GET"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M370.962890625,133L370.962890625,137.16666666666666C370.962890625,141.33333333333334,370.962890625,149.66666666666666,371.0462239583333,158.08333333333334C371.1295572916667,166.5,371.2962239583333,175,371.3795572916667,179.25L371.462890625,183.5","id":"L-执行GET-Z-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-执行GET","LE-Z"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M347.88371331198147,378.92082268698147L345.0639017183178,388.8090189058178C342.2440901246543,398.6972151246543,336.6044669373271,418.4736075623271,333.7846553436636,434.4034704478302C330.96484375,450.3333333333333,330.96484375,462.4166666666667,330.96484375,468.4583333333333L330.96484375,474.5","id":"L-Z-执行del-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-Z","LE-执行del"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M330.96484375,512L330.96484375,518.0416666666666C330.96484375,524.0833333333334,330.96484375,536.1666666666666,335.35856859611744,548.25C339.7522934422348,560.3333333333334,348.5397431344697,572.4166666666666,352.9334679805872,578.4583333333334L357.32719282670456,584.5","id":"L-执行del-Y-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-执行del","LE-Y"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M394.50296045888,379.45993016612L397.0529227782333,389.25827513843336C399.6028850975867,399.0566201107467,404.7028097362933,418.65331005537337,407.25277205564663,437.61832169435337C409.802734375,456.5833333333333,409.802734375,474.9166666666667,409.802734375,493.25C409.802734375,511.5833333333333,409.802734375,529.9166666666666,405.53623638731057,545.125C401.2697383996212,560.3333333333334,392.73674242424244,572.4166666666666,388.470244436553,578.4583333333334L384.2037464488636,584.5","id":"L-Z-Y-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-Z","LE-Y"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabels"]},"children":[{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(98.4375, 438.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"是"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(223.875, 548.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"否"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(330.96484375, 438.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"是"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(409.802734375, 493.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"否"}]}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["nodes"]},"children":[{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-获取锁-24","transform":"translate(161.15625, 26.75)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-31.5","y":"-18.75","width":"63","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-24, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"48","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"获取锁"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-B-25","transform":"translate(161.15625, 114.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-61.8359375","y":"-18.75","width":"123.671875","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-54.3359375, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"108.671875","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行SETNX命令"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-C-27","transform":"translate(98.4375, 292.5)"},"children":[{"type":"element","tagName":"polygon","properties":{"points":"62.4453125,0 124.890625,-62.4453125 62.4453125,-124.890625 0,-62.4453125","className":["label-container"],"transform":"translate(-62.4453125,62.4453125)","style":""},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-36.1953125, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"72.390625","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"是否返回1"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-E-29","transform":"translate(98.4375, 493.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-78.08203125","y":"-18.75","width":"156.1640625","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-70.58203125, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"141.1640625","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行expire延长时间"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-F-31","transform":"translate(98.4375, 603.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-90.4375","y":"-18.75","width":"180.875","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-82.9375, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"165.875","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"获取到锁,执行业务逻辑"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-G-33","transform":"translate(98.4375, 690.75)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-31.5","y":"-18.75","width":"63","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-24, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"48","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"释放锁"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-结束-35","transform":"translate(161.15625, 778.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-23.5","y":"-18.75","width":"47","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-16, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"32","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"结束"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-释放锁-38","transform":"translate(370.962890625, 26.75)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-31.5","y":"-18.75","width":"63","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-24, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"48","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"释放锁"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-执行GET-39","transform":"translate(370.962890625, 114.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-37.83984375","y":"-18.75","width":"75.6796875","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-30.33984375, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"60.6796875","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行GET"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-Z-41","transform":"translate(370.962890625, 292.5)"},"children":[{"type":"element","tagName":"polygon","properties":{"points":"109.5,0 219,-109.5 109.5,-219 0,-109.5","className":["label-container"],"transform":"translate(-109.5,109.5)","style":""},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-72, -22.5)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"144","height":"45"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"返回的值"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"是否是自己设定的值"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-执行del-43","transform":"translate(330.96484375, 493.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-34.6796875","y":"-18.75","width":"69.359375","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-27.1796875, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"54.359375","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行del"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-Y-45","transform":"translate(370.962890625, 603.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-23.5","y":"-18.75","width":"47","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-16, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"32","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"结束"}]}]}]}]}]}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上面这么实现有什么问题么?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"业务执行的时间大于redis锁过期的时间"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"一个锁设置了1分钟超时释放，如果拿到这个锁的线程在一分钟内没有执行完毕，那么这个锁就会被其他线程拿到，可能会导致严重的线上问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"redis部署模式的影响"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在单机模式下，redis是CP模式，在对并发量不大的情况下，是可以用这种代码去实现的，单机也能够扛得住。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果在集群模式下，redis异步复制造成的锁丢失，如果主节点没来的及把刚刚set进来这条数据给从节点，就挂了，就导致锁没有锁上，释放也是同样的逻辑"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因此针对上述的情况，业界有统一的解决方案: Redlock 红锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"原子性问题"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SETNX + EXPIRE不是原子性的，不满足事务性 , 如果expire未执行成功，锁只能主动释放，锁存在永远得不到释放的情况, 可以使用下面的命令进行设置。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"shell","dataIndex":"1"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"SET key value NX EX 1000"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"或者可以用lua进行设置"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"lua","dataIndex":"2"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" key     = KEYS["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" content = ARGV["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" ttl     = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"tonumber"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(ARGV["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"2"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"])"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" lockSet = redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'setnx'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key, content)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" lockSet == "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"then"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'PEXPIRE'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key, ttl)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3"]},"children":[{"type":"text","value":"-- 如果value相同，则认为是同一个线程的请求，则认为重入锁"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" value = redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'get'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(value == content) "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"then"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    lockSet = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'PEXPIRE'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key, ttl)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"end"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"end"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" lockSet"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"同样的，get+delete也不是原子性的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"lua","dataIndex":"3"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" key     = KEYS["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" content = ARGV["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" value = redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'get'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" value == content "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"then"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'del'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"end"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用java代码优化上述的问题:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"java","dataIndex":"4"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"@"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"RestController"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"public"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"class"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"GoodController"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"public"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"static"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"final"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"REDIS_LOCK_KEY"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"redisLockPay\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    @"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Autowired"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"private"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"StringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    @"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Value"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"${server.port}\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"private"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"serverPort"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    @"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"/buy_goods\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"public"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"buy_Goods"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"() {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"value"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"UUID"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"randomUUID"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"toString"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"() + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Thread"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"currentThread"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"getName"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"();"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"try"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Boolean"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"flag"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"opsForValue"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"setIfAbsent"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(REDIS_LOCK_KEY, value, "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"30L"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"TimeUnit"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"SECONDS"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" (!flag) {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 抢夺锁失败，请下次尝试 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"result"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"opsForValue"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"get"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"goods:001\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"goodsNumber"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = result == "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"?"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Integer"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"parseInt"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(result);"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" (goodsNumber > "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":") {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"realNumber"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = goodsNumber - "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"opsForValue"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"set"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"goods:001\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", realNumber + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 你已经成功秒杀商品，此时还剩余： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + realNumber + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 件 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort);"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 你已经成功秒杀商品，此时还剩余： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + realNumber + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 件 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort;"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort);"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort;"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"finally"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"RedisUtils"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"getJedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"();"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"script"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"if redis.call('get', KEYS[1]) == ARGV[1] \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"then \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"return redis.call('del', KEYS[1]) \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"else \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"   return 0 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"end\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"try"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Object"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"result"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"eval"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(script, "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Collections"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"singletonList"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(REDIS_LOCK_KEY), "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Collections"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"singletonList"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(value));"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" ("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"1\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"equals"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"result"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"toString"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"())) {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"------del REDIS_LOCK_KEY success\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"------del REDIS_LOCK_KEY error\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"finally"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" ("}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" != jedis) {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"close"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"();"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"}   "}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n"}]}],"data":{"quirksMode":false}},"html":"<h1 id=\"Redis的分布式锁\">Redis的分布式锁</h1>\n<h1 id=\"利用redis实现分布式锁\">利用redis实现分布式锁</h1>\n<h2 id=\"三个重要因素\">三个重要因素</h2>\n<ul updated=\"20220630093303\">\n<li id=\"20220630093303-2dk0iu4\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">加锁:  加锁实际上就是在redis中，给Key键设置一个值，为避免死锁，并给定一个过期时间</p>\n</li>\n<li id=\"20220630093303-avyhk14\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">解锁: 将Key键删除。但也不能乱删，不能说客户端1的请求将客户端2的锁给删除掉，只能自己删除自己的锁</p>\n</li>\n<li id=\"20220630093303-bmn4x0r\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">超时: 不能长期占用</p>\n</li>\n</ul>\n<h2 id=\"涉及命令\">涉及命令</h2>\n<ol updated=\"20220630093303\">\n<li id=\"20220630093303-jd7lixh\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">SETNX: 当KEY不存在的时候设置KEY的值为value，返回1，当KEY存在的时候，不做任何动作返回0。</p>\n</li>\n</ol>\n<pre class=\"code-block\" data-language=\"shell\"><code class=\"hljs\">redis&gt; setnx key value\n\t1\nredis&gt; setnx key value\n\t0\n</code></pre>\n<ol start=\"2\" updated=\"20220630093303\">\n<li id=\"20220630093303-vm5klwk\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">EXPIRE: 为KEY设计一个超时时间，到期自动释放，避免死锁。</p>\n</li>\n<li id=\"20220630093303-nxz0r78\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">DELETE: 删除KEY，用于业务处理完手动释放锁。</p>\n</li>\n</ol>\n<h1 id=\"实现思想\">实现思想</h1>\n<ol updated=\"20220630093303\">\n<li id=\"20220630093303-uv92rr5\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">随机生成一个UUID，标记是当前线程，调用SETNX方法设置值，并且调用expire方法为锁加一个超期时间，到期自动释放锁。</p>\n</li>\n<li id=\"20220630093303-kz29028\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">获取锁的时候，加一个超期时间，超过时间则放弃去竞争锁。</p>\n</li>\n<li id=\"20220630093303-rgn4mdz\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">释放锁的时候，判断UUID是不是  该锁，如果是则执行DELETE进行释放。</p>\n</li>\n</ol>\n<div data-content=\"flowchart TD;\n    获取锁--&gt;B(执行SETNX命令);\n    B--&gt;C{是否返回1};\n    C--&gt;|是|E(执行expire延长时间);\n    E--&gt;F(获取到锁,执行业务逻辑);\n    F--&gt;G(释放锁);\n    G--&gt;结束;\n    B--&gt;|否|结束;\n \n    释放锁--&gt;执行GET;\n    执行GET--&gt;Z{返回的值\\n是否是自己设定的值};\n    Z--&gt;|是|执行del;\n    执行del--&gt;Y(结束);\n    Z--&gt;|否|Y;\" data-subtype=\"mermaid\"><div spin=\"1\"></div></div>\n<p updated=\"20220630093303\">上面这么实现有什么问题么?</p>\n<h2 id=\"业务执行的时间大于redis锁过期的时间\">业务执行的时间大于redis锁过期的时间</h2>\n<p updated=\"20220630093303\">一个锁设置了1分钟超时释放，如果拿到这个锁的线程在一分钟内没有执行完毕，那么这个锁就会被其他线程拿到，可能会导致严重的线上问题。</p>\n<h2 id=\"redis部署模式的影响\">redis部署模式的影响</h2>\n<p updated=\"20220630093303\">在单机模式下，redis是CP模式，在对并发量不大的情况下，是可以用这种代码去实现的，单机也能够扛得住。</p>\n<p updated=\"20220630093303\">如果在集群模式下，redis异步复制造成的锁丢失，如果主节点没来的及把刚刚set进来这条数据给从节点，就挂了，就导致锁没有锁上，释放也是同样的逻辑</p>\n<p updated=\"20220630093303\">因此针对上述的情况，业界有统一的解决方案: Redlock 红锁。</p>\n<h2 id=\"原子性问题\">原子性问题</h2>\n<p updated=\"20220630093303\">SETNX + EXPIRE不是原子性的，不满足事务性 , 如果expire未执行成功，锁只能主动释放，锁存在永远得不到释放的情况, 可以使用下面的命令进行设置。</p>\n<pre class=\"code-block\" data-language=\"shell\"><code class=\"hljs\">SET key value NX EX 1000\n</code></pre>\n<p updated=\"20220630093303\">或者可以用lua进行设置</p>\n<pre class=\"code-block\" data-language=\"lua\"><code class=\"hljs\">local key     = KEYS[1]\nlocal content = ARGV[1]\nlocal ttl     = tonumber(ARGV[2])\nlocal lockSet = redis.call('setnx', key, content)\nif lockSet == 1 then\n  redis.call('PEXPIRE', key, ttl)\nelse\n  -- 如果value相同，则认为是同一个线程的请求，则认为重入锁\n  local value = redis.call('get', key)\n  if(value == content) then\n    lockSet = 1;\n    redis.call('PEXPIRE', key, ttl)\n  end\nend\nreturn lockSet\n</code></pre>\n<p updated=\"20220630093303\">同样的，get+delete也不是原子性的</p>\n<pre class=\"code-block\" data-language=\"lua\"><code class=\"hljs\">local key     = KEYS[1]\nlocal content = ARGV[1]\nlocal value = redis.call('get', key)\nif value == content then\n  return redis.call('del', key)\nelse\n    return 0\nend\n</code></pre>\n<p updated=\"20220630093303\">使用java代码优化上述的问题:</p>\n<pre class=\"code-block\" data-language=\"java\"><code class=\"hljs\">@RestController\npublic class GoodController {\n    public static final String REDIS_LOCK_KEY = &quot;redisLockPay&quot;;\n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n    @Value(&quot;${server.port}&quot;)\n    private String serverPort;\n\n    @GetMapping(&quot;/buy_goods&quot;)\n    public String buy_Goods() {\n        String value = UUID.randomUUID().toString() + Thread.currentThread().getName();\n        try {\n            Boolean flag = stringRedisTemplate.opsForValue().setIfAbsent(REDIS_LOCK_KEY, value, 30L, TimeUnit.SECONDS);\n            if (!flag) {\n                return &quot; 抢夺锁失败，请下次尝试 &quot;;\n            }\n            String result = stringRedisTemplate.opsForValue().get(&quot;goods:001&quot;);\n            int goodsNumber = result == null ? 0 : Integer.parseInt(result);\n            if (goodsNumber &gt; 0) {\n                int realNumber = goodsNumber - 1;\n                stringRedisTemplate.opsForValue().set(&quot;goods:001&quot;, realNumber + &quot;&quot;);\n                System.out.println(&quot; 你已经成功秒杀商品，此时还剩余： &quot; + realNumber + &quot; 件 &quot; + &quot; \\t  服务器端口： &quot; + serverPort);\n                return &quot; 你已经成功秒杀商品，此时还剩余： &quot; + realNumber + &quot; 件 &quot; + &quot; \\t  服务器端口： &quot; + serverPort;\n            } else {\n                System.out.println(&quot; 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 &quot; + &quot; \\t  服务器端口： &quot; + serverPort);\n            }\n            return &quot; 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 &quot; + &quot; \\t  服务器端口： &quot; + serverPort;\n        } finally {\n            Jedis jedis = RedisUtils.getJedis();\n            String script = &quot;if redis.call('get', KEYS[1]) == ARGV[1] &quot; + &quot;then &quot; + &quot;return redis.call('del', KEYS[1]) &quot; + &quot;else &quot; + &quot;   return 0 &quot; + &quot;end&quot;;\n            try {\n                Object result = jedis.eval(script, Collections.singletonList(REDIS_LOCK_KEY), Collections.singletonList(value));\n                if (&quot;1&quot;.equals(result.toString())) {\n                    System.out.println(&quot;------del REDIS_LOCK_KEY success&quot;);\n                } else {\n                    System.out.println(&quot;------del REDIS_LOCK_KEY error&quot;);\n                }\n            } finally {\n                if (null != jedis) {\n                    jedis.close();\n                }\n            }\n        }\n    }\n}   \n</code></pre>","articleNode":{"field":{"contentType":"topic","topic":"redis"},"frontmatter":{"id":"/topic/redis/Redis的分布式锁","title":"Redis的分布式锁","date":"2022-04-28 14:17","absolute_path":"/topic/redis/Redis的分布式锁"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Redis的分布式锁"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"利用redis实现分布式锁"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"三个重要因素"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"加锁:  加锁实际上就是在redis中，给Key键设置一个值，为避免死锁，并给定一个过期时间"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"解锁: 将Key键删除。但也不能乱删，不能说客户端1的请求将客户端2的锁给删除掉，只能自己删除自己的锁"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"超时: 不能长期占用"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"涉及命令"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"SETNX: 当KEY不存在的时候设置KEY的值为value，返回1，当KEY存在的时候，不做任何动作返回0。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"shell","dataIndex":"0"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"redis> setnx key value"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"\t1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"redis> setnx key value"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"\t0"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{"start":2},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"EXPIRE: 为KEY设计一个超时时间，到期自动释放，避免死锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"DELETE: 删除KEY，用于业务处理完手动释放锁。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"实现思想"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"随机生成一个UUID，标记是当前线程，调用SETNX方法设置值，并且调用expire方法为锁加一个超期时间，到期自动释放锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"获取锁的时候，加一个超期时间，超过时间则放弃去竞争锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"释放锁的时候，判断UUID是不是  该锁，如果是则执行DELETE进行释放。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["mermaid"],"dataProcessed":"true"},"children":[{"type":"element","tagName":"svg","properties":{"id":"mermaid-1656552808215","width":"100%","xmlns":"http://www.w3.org/2000/svg","xmlnsXLink":"http://www.w3.org/1999/xlink","height":"805","style":"max-width: 488.462890625px;","viewBox":"0 0 488.462890625 805"},"children":[{"type":"element","tagName":"style","properties":{},"children":[{"type":"text","value":"#mermaid-1656552808215 {font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1656552808215 .error-icon{fill:#552222;}#mermaid-1656552808215 .error-text{fill:#552222;stroke:#552222;}#mermaid-1656552808215 .edge-thickness-normal{stroke-width:2px;}#mermaid-1656552808215 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1656552808215 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1656552808215 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1656552808215 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1656552808215 .marker{fill:#333333;stroke:#333333;}#mermaid-1656552808215 .marker.cross{stroke:#333333;}#mermaid-1656552808215 svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-1656552808215 .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-1656552808215 .cluster-label text{fill:#333;}#mermaid-1656552808215 .cluster-label span{color:#333;}#mermaid-1656552808215 .label text,#mermaid-1656552808215 span{fill:#333;color:#333;}#mermaid-1656552808215 .node rect,#mermaid-1656552808215 .node circle,#mermaid-1656552808215 .node ellipse,#mermaid-1656552808215 .node polygon,#mermaid-1656552808215 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1656552808215 .node .label{text-align:center;}#mermaid-1656552808215 .node.clickable{cursor:pointer;}#mermaid-1656552808215 .arrowheadPath{fill:#333333;}#mermaid-1656552808215 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1656552808215 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1656552808215 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1656552808215 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1656552808215 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1656552808215 .cluster text{fill:#333;}#mermaid-1656552808215 .cluster span{color:#333;}#mermaid-1656552808215 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1656552808215 :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}"}]},{"type":"element","tagName":"g","properties":{"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"marker","properties":{"id":"flowchart-pointEnd","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"12","markerHeight":"12","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-pointStart","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"0","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"12","markerHeight":"12","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 5 L 10 10 L 10 0 z","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-circleEnd","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"11","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"circle","properties":{"cx":"5","cy":"5","r":"5","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-circleStart","className":["marker","flowchart"],"viewBox":"0 0 10 10","refX":"-1","refY":"5","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"circle","properties":{"cx":"5","cy":"5","r":"5","className":["arrowMarkerPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-crossEnd","className":["marker","cross","flowchart"],"viewBox":"0 0 11 11","refX":"12","refY":"5.2","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 1,1 l 9,9 M 10,1 l -9,9","className":["arrowMarkerPath"],"style":"stroke-width: 2; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"marker","properties":{"id":"flowchart-crossStart","className":["marker","cross","flowchart"],"viewBox":"0 0 11 11","refX":"-1","refY":"5.2","markerUnits":"userSpaceOnUse","markerWidth":"11","markerHeight":"11","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 1,1 l 9,9 M 10,1 l -9,9","className":["arrowMarkerPath"],"style":"stroke-width: 2; stroke-dasharray: 1, 0;"},"children":[]}]},{"type":"element","tagName":"g","properties":{"className":["root"]},"children":[{"type":"element","tagName":"g","properties":{"className":["clusters"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["edgePaths"]},"children":[{"type":"element","tagName":"path","properties":{"d":"M161.15625,45.5L161.15625,49.666666666666664C161.15625,53.833333333333336,161.15625,62.166666666666664,161.15625,70.5C161.15625,78.83333333333333,161.15625,87.16666666666667,161.15625,91.33333333333333L161.15625,95.5","id":"L-获取锁-B-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-获取锁","LE-B"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M134.27678571428572,133L128.30357142857144,137.16666666666666C122.33035714285715,141.33333333333334,110.38392857142857,149.66666666666666,104.49404761904763,165.92578125C98.60416666666667,182.18489583333334,98.77083333333333,206.36979166666666,98.85416666666667,218.46223958333334L98.9375,230.5546875","id":"L-B-C-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-B","LE-C"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.9375,355.4453125L98.85416666666667,369.24609375C98.77083333333333,383.046875,98.60416666666667,410.6484375,98.52083333333333,430.4908854166667C98.4375,450.3333333333333,98.4375,462.4166666666667,98.4375,468.4583333333333L98.4375,474.5","id":"L-C-E-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-C","LE-E"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.4375,512L98.4375,518.0416666666666C98.4375,524.0833333333334,98.4375,536.1666666666666,98.4375,548.25C98.4375,560.3333333333334,98.4375,572.4166666666666,98.4375,578.4583333333334L98.4375,584.5","id":"L-E-F-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-E","LE-F"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.4375,622L98.4375,626.1666666666666C98.4375,630.3333333333334,98.4375,638.6666666666666,98.4375,647C98.4375,655.3333333333334,98.4375,663.6666666666666,98.4375,667.8333333333334L98.4375,672","id":"L-F-G-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-F","LE-G"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M98.4375,709.5L98.4375,713.6666666666666C98.4375,717.8333333333334,98.4375,726.1666666666666,104.97395833333333,734.892895698389C111.51041666666667,743.6191247301113,124.58333333333333,752.7382494602225,131.11979166666666,757.2978118252782L137.65625,761.8573741903339","id":"L-G-结束-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-G","LE-结束"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M188.03571428571428,133L194.00892857142856,137.16666666666666C199.98214285714286,141.33333333333334,211.92857142857142,149.66666666666666,217.9017857142857,176.25C223.875,202.83333333333334,223.875,247.66666666666666,223.875,294.375C223.875,341.0833333333333,223.875,389.6666666666667,223.875,423.125C223.875,456.5833333333333,223.875,474.9166666666667,223.875,493.25C223.875,511.5833333333333,223.875,529.9166666666666,223.875,548.25C223.875,566.5833333333334,223.875,584.9166666666666,223.875,601.375C223.875,617.8333333333334,223.875,632.4166666666666,223.875,647C223.875,661.5833333333334,223.875,676.1666666666666,223.875,690.75C223.875,705.3333333333334,223.875,719.9166666666666,217.33854166666666,731.767895698389C210.80208333333334,743.6191247301113,197.72916666666666,752.7382494602225,191.19270833333334,757.2978118252782L184.65625,761.8573741903339","id":"L-B-结束-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-B","LE-结束"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M370.962890625,45.5L370.962890625,49.666666666666664C370.962890625,53.833333333333336,370.962890625,62.166666666666664,370.962890625,70.5C370.962890625,78.83333333333333,370.962890625,87.16666666666667,370.962890625,91.33333333333333L370.962890625,95.5","id":"L-释放锁-执行GET-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-释放锁","LE-执行GET"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M370.962890625,133L370.962890625,137.16666666666666C370.962890625,141.33333333333334,370.962890625,149.66666666666666,371.0462239583333,158.08333333333334C371.1295572916667,166.5,371.2962239583333,175,371.3795572916667,179.25L371.462890625,183.5","id":"L-执行GET-Z-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-执行GET","LE-Z"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M347.88371331198147,378.92082268698147L345.0639017183178,388.8090189058178C342.2440901246543,398.6972151246543,336.6044669373271,418.4736075623271,333.7846553436636,434.4034704478302C330.96484375,450.3333333333333,330.96484375,462.4166666666667,330.96484375,468.4583333333333L330.96484375,474.5","id":"L-Z-执行del-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-Z","LE-执行del"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M330.96484375,512L330.96484375,518.0416666666666C330.96484375,524.0833333333334,330.96484375,536.1666666666666,335.35856859611744,548.25C339.7522934422348,560.3333333333334,348.5397431344697,572.4166666666666,352.9334679805872,578.4583333333334L357.32719282670456,584.5","id":"L-执行del-Y-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-执行del","LE-Y"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]},{"type":"element","tagName":"path","properties":{"d":"M394.50296045888,379.45993016612L397.0529227782333,389.25827513843336C399.6028850975867,399.0566201107467,404.7028097362933,418.65331005537337,407.25277205564663,437.61832169435337C409.802734375,456.5833333333333,409.802734375,474.9166666666667,409.802734375,493.25C409.802734375,511.5833333333333,409.802734375,529.9166666666666,405.53623638731057,545.125C401.2697383996212,560.3333333333334,392.73674242424244,572.4166666666666,388.470244436553,578.4583333333334L384.2037464488636,584.5","id":"L-Z-Y-0","className":["edge-thickness-normal","edge-pattern-solid","flowchart-link","LS-Z","LE-Y"],"style":"fill:none;","markerEnd":"url(#flowchart-pointEnd)"},"children":[]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabels"]},"children":[{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(98.4375, 438.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"是"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(223.875, 548.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"否"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(330.96484375, 438.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"是"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"]},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0, 0)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"translate(409.802734375, 493.25)"},"children":[{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(-8, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"16","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["edgeLabel"]},"children":[{"type":"text","value":"否"}]}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["nodes"]},"children":[{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-获取锁-24","transform":"translate(161.15625, 26.75)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-31.5","y":"-18.75","width":"63","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-24, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"48","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"获取锁"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-B-25","transform":"translate(161.15625, 114.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-61.8359375","y":"-18.75","width":"123.671875","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-54.3359375, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"108.671875","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行SETNX命令"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-C-27","transform":"translate(98.4375, 292.5)"},"children":[{"type":"element","tagName":"polygon","properties":{"points":"62.4453125,0 124.890625,-62.4453125 62.4453125,-124.890625 0,-62.4453125","className":["label-container"],"transform":"translate(-62.4453125,62.4453125)","style":""},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-36.1953125, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"72.390625","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"是否返回1"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-E-29","transform":"translate(98.4375, 493.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-78.08203125","y":"-18.75","width":"156.1640625","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-70.58203125, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"141.1640625","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行expire延长时间"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-F-31","transform":"translate(98.4375, 603.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-90.4375","y":"-18.75","width":"180.875","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-82.9375, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"165.875","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"获取到锁,执行业务逻辑"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-G-33","transform":"translate(98.4375, 690.75)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-31.5","y":"-18.75","width":"63","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-24, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"48","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"释放锁"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-结束-35","transform":"translate(161.15625, 778.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-23.5","y":"-18.75","width":"47","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-16, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"32","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"结束"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-释放锁-38","transform":"translate(370.962890625, 26.75)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-31.5","y":"-18.75","width":"63","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-24, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"48","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"释放锁"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-执行GET-39","transform":"translate(370.962890625, 114.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-37.83984375","y":"-18.75","width":"75.6796875","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-30.33984375, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"60.6796875","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行GET"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-Z-41","transform":"translate(370.962890625, 292.5)"},"children":[{"type":"element","tagName":"polygon","properties":{"points":"109.5,0 219,-109.5 109.5,-219 0,-109.5","className":["label-container"],"transform":"translate(-109.5,109.5)","style":""},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-72, -22.5)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"144","height":"45"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"返回的值"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"是否是自己设定的值"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-执行del-43","transform":"translate(330.96484375, 493.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"0","ry":"0","x":"-34.6796875","y":"-18.75","width":"69.359375","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-27.1796875, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"54.359375","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"执行del"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default","default"],"id":"flowchart-Y-45","transform":"translate(370.962890625, 603.25)"},"children":[{"type":"element","tagName":"rect","properties":{"className":["basic","label-container"],"style":"","rx":"5","ry":"5","x":"-23.5","y":"-18.75","width":"47","height":"37.5"},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"style":"","transform":"translate(-16, -11.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"32","height":"22.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"className":["nodeLabel"]},"children":[{"type":"text","value":"结束"}]}]}]}]}]}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上面这么实现有什么问题么?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"业务执行的时间大于redis锁过期的时间"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"一个锁设置了1分钟超时释放，如果拿到这个锁的线程在一分钟内没有执行完毕，那么这个锁就会被其他线程拿到，可能会导致严重的线上问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"redis部署模式的影响"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在单机模式下，redis是CP模式，在对并发量不大的情况下，是可以用这种代码去实现的，单机也能够扛得住。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果在集群模式下，redis异步复制造成的锁丢失，如果主节点没来的及把刚刚set进来这条数据给从节点，就挂了，就导致锁没有锁上，释放也是同样的逻辑"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因此针对上述的情况，业界有统一的解决方案: Redlock 红锁。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"原子性问题"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SETNX + EXPIRE不是原子性的，不满足事务性 , 如果expire未执行成功，锁只能主动释放，锁存在永远得不到释放的情况, 可以使用下面的命令进行设置。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"shell","dataIndex":"1"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"SET key value NX EX 1000"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"或者可以用lua进行设置"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"lua","dataIndex":"2"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" key     = KEYS["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" content = ARGV["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" ttl     = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"tonumber"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(ARGV["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"2"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"])"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" lockSet = redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'setnx'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key, content)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" lockSet == "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"then"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'PEXPIRE'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key, ttl)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk3"]},"children":[{"type":"text","value":"-- 如果value相同，则认为是同一个线程的请求，则认为重入锁"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" value = redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'get'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(value == content) "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"then"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    lockSet = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'PEXPIRE'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key, ttl)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"end"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"end"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" lockSet"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"同样的，get+delete也不是原子性的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"lua","dataIndex":"3"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" key     = KEYS["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" content = ARGV["}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"]"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"local"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" value = redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'get'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" value == content "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"then"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"  "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" redis."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"call"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"'del'"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", key)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"end"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用java代码优化上述的问题:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{"className":["grvsc-container","dark-default-dark"],"dataLanguage":"java","dataIndex":"4"},"children":[{"type":"element","tagName":"code","properties":{"className":["grvsc-code"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"@"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"RestController"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"public"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"class"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"GoodController"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"public"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"static"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"final"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"REDIS_LOCK_KEY"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"redisLockPay\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    @"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Autowired"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"private"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"StringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    @"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Value"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"${server.port}\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"private"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"serverPort"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    @"}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"/buy_goods\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":")"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"public"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"buy_Goods"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"() {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"value"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"UUID"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"randomUUID"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"toString"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"() + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Thread"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"currentThread"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"getName"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"();"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"try"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Boolean"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"flag"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"opsForValue"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"setIfAbsent"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(REDIS_LOCK_KEY, value, "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"30L"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"TimeUnit"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"SECONDS"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" (!flag) {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 抢夺锁失败，请下次尝试 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"result"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"opsForValue"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"get"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"goods:001\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"goodsNumber"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = result == "}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"?"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Integer"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"parseInt"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(result);"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" (goodsNumber > "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":") {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"realNumber"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = goodsNumber - "}]},{"type":"element","tagName":"span","properties":{"className":["mtk7"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"stringRedisTemplate"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"opsForValue"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"()."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"set"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"goods:001\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":", realNumber + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 你已经成功秒杀商品，此时还剩余： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + realNumber + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 件 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort);"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 你已经成功秒杀商品，此时还剩余： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + realNumber + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 件 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort;"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort);"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk6"]},"children":[{"type":"text","value":"\\t"}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"  服务器端口： \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + serverPort;"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"finally"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"RedisUtils"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"getJedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"();"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"script"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"if redis.call('get', KEYS[1]) == ARGV[1] \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"then \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"return redis.call('del', KEYS[1]) \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"else \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"   return 0 \""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" + "}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"end\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":";"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"try"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk10"]},"children":[{"type":"text","value":"Object"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"result"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" = "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"eval"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(script, "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Collections"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"singletonList"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(REDIS_LOCK_KEY), "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"Collections"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"singletonList"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"(value));"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" ("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"1\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"equals"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"result"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"toString"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"())) {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"------del REDIS_LOCK_KEY success\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"else"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"System"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"out"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"println"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["mtk8"]},"children":[{"type":"text","value":"\"------del REDIS_LOCK_KEY error\""}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":");"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            } "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"finally"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                "}]},{"type":"element","tagName":"span","properties":{"className":["mtk15"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" ("}]},{"type":"element","tagName":"span","properties":{"className":["mtk4"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":" != jedis) {"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                    "}]},{"type":"element","tagName":"span","properties":{"className":["mtk12"]},"children":[{"type":"text","value":"jedis"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["mtk11"]},"children":[{"type":"text","value":"close"}]},{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"();"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"                }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"            }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"        }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"    }"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["grvsc-line"]},"children":[{"type":"element","tagName":"span","properties":{"className":["grvsc-source"]},"children":[{"type":"element","tagName":"span","properties":{"className":["mtk1"]},"children":[{"type":"text","value":"}   "}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n"}]}],"data":{"quirksMode":false}},"html":"<h1 id=\"Redis的分布式锁\">Redis的分布式锁</h1>\n<h1 id=\"利用redis实现分布式锁\">利用redis实现分布式锁</h1>\n<h2 id=\"三个重要因素\">三个重要因素</h2>\n<ul updated=\"20220630093303\">\n<li id=\"20220630093303-2dk0iu4\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">加锁:  加锁实际上就是在redis中，给Key键设置一个值，为避免死锁，并给定一个过期时间</p>\n</li>\n<li id=\"20220630093303-avyhk14\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">解锁: 将Key键删除。但也不能乱删，不能说客户端1的请求将客户端2的锁给删除掉，只能自己删除自己的锁</p>\n</li>\n<li id=\"20220630093303-bmn4x0r\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">超时: 不能长期占用</p>\n</li>\n</ul>\n<h2 id=\"涉及命令\">涉及命令</h2>\n<ol updated=\"20220630093303\">\n<li id=\"20220630093303-jd7lixh\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">SETNX: 当KEY不存在的时候设置KEY的值为value，返回1，当KEY存在的时候，不做任何动作返回0。</p>\n</li>\n</ol>\n<pre class=\"code-block\" data-language=\"shell\"><code class=\"hljs\">redis&gt; setnx key value\n\t1\nredis&gt; setnx key value\n\t0\n</code></pre>\n<ol start=\"2\" updated=\"20220630093303\">\n<li id=\"20220630093303-vm5klwk\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">EXPIRE: 为KEY设计一个超时时间，到期自动释放，避免死锁。</p>\n</li>\n<li id=\"20220630093303-nxz0r78\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">DELETE: 删除KEY，用于业务处理完手动释放锁。</p>\n</li>\n</ol>\n<h1 id=\"实现思想\">实现思想</h1>\n<ol updated=\"20220630093303\">\n<li id=\"20220630093303-uv92rr5\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">随机生成一个UUID，标记是当前线程，调用SETNX方法设置值，并且调用expire方法为锁加一个超期时间，到期自动释放锁。</p>\n</li>\n<li id=\"20220630093303-kz29028\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">获取锁的时候，加一个超期时间，超过时间则放弃去竞争锁。</p>\n</li>\n<li id=\"20220630093303-rgn4mdz\" updated=\"20220630093303\">\n<p updated=\"20220630093303\">释放锁的时候，判断UUID是不是  该锁，如果是则执行DELETE进行释放。</p>\n</li>\n</ol>\n<div data-content=\"flowchart TD;\n    获取锁--&gt;B(执行SETNX命令);\n    B--&gt;C{是否返回1};\n    C--&gt;|是|E(执行expire延长时间);\n    E--&gt;F(获取到锁,执行业务逻辑);\n    F--&gt;G(释放锁);\n    G--&gt;结束;\n    B--&gt;|否|结束;\n \n    释放锁--&gt;执行GET;\n    执行GET--&gt;Z{返回的值\\n是否是自己设定的值};\n    Z--&gt;|是|执行del;\n    执行del--&gt;Y(结束);\n    Z--&gt;|否|Y;\" data-subtype=\"mermaid\"><div spin=\"1\"></div></div>\n<p updated=\"20220630093303\">上面这么实现有什么问题么?</p>\n<h2 id=\"业务执行的时间大于redis锁过期的时间\">业务执行的时间大于redis锁过期的时间</h2>\n<p updated=\"20220630093303\">一个锁设置了1分钟超时释放，如果拿到这个锁的线程在一分钟内没有执行完毕，那么这个锁就会被其他线程拿到，可能会导致严重的线上问题。</p>\n<h2 id=\"redis部署模式的影响\">redis部署模式的影响</h2>\n<p updated=\"20220630093303\">在单机模式下，redis是CP模式，在对并发量不大的情况下，是可以用这种代码去实现的，单机也能够扛得住。</p>\n<p updated=\"20220630093303\">如果在集群模式下，redis异步复制造成的锁丢失，如果主节点没来的及把刚刚set进来这条数据给从节点，就挂了，就导致锁没有锁上，释放也是同样的逻辑</p>\n<p updated=\"20220630093303\">因此针对上述的情况，业界有统一的解决方案: Redlock 红锁。</p>\n<h2 id=\"原子性问题\">原子性问题</h2>\n<p updated=\"20220630093303\">SETNX + EXPIRE不是原子性的，不满足事务性 , 如果expire未执行成功，锁只能主动释放，锁存在永远得不到释放的情况, 可以使用下面的命令进行设置。</p>\n<pre class=\"code-block\" data-language=\"shell\"><code class=\"hljs\">SET key value NX EX 1000\n</code></pre>\n<p updated=\"20220630093303\">或者可以用lua进行设置</p>\n<pre class=\"code-block\" data-language=\"lua\"><code class=\"hljs\">local key     = KEYS[1]\nlocal content = ARGV[1]\nlocal ttl     = tonumber(ARGV[2])\nlocal lockSet = redis.call('setnx', key, content)\nif lockSet == 1 then\n  redis.call('PEXPIRE', key, ttl)\nelse\n  -- 如果value相同，则认为是同一个线程的请求，则认为重入锁\n  local value = redis.call('get', key)\n  if(value == content) then\n    lockSet = 1;\n    redis.call('PEXPIRE', key, ttl)\n  end\nend\nreturn lockSet\n</code></pre>\n<p updated=\"20220630093303\">同样的，get+delete也不是原子性的</p>\n<pre class=\"code-block\" data-language=\"lua\"><code class=\"hljs\">local key     = KEYS[1]\nlocal content = ARGV[1]\nlocal value = redis.call('get', key)\nif value == content then\n  return redis.call('del', key)\nelse\n    return 0\nend\n</code></pre>\n<p updated=\"20220630093303\">使用java代码优化上述的问题:</p>\n<pre class=\"code-block\" data-language=\"java\"><code class=\"hljs\">@RestController\npublic class GoodController {\n    public static final String REDIS_LOCK_KEY = &quot;redisLockPay&quot;;\n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n    @Value(&quot;${server.port}&quot;)\n    private String serverPort;\n\n    @GetMapping(&quot;/buy_goods&quot;)\n    public String buy_Goods() {\n        String value = UUID.randomUUID().toString() + Thread.currentThread().getName();\n        try {\n            Boolean flag = stringRedisTemplate.opsForValue().setIfAbsent(REDIS_LOCK_KEY, value, 30L, TimeUnit.SECONDS);\n            if (!flag) {\n                return &quot; 抢夺锁失败，请下次尝试 &quot;;\n            }\n            String result = stringRedisTemplate.opsForValue().get(&quot;goods:001&quot;);\n            int goodsNumber = result == null ? 0 : Integer.parseInt(result);\n            if (goodsNumber &gt; 0) {\n                int realNumber = goodsNumber - 1;\n                stringRedisTemplate.opsForValue().set(&quot;goods:001&quot;, realNumber + &quot;&quot;);\n                System.out.println(&quot; 你已经成功秒杀商品，此时还剩余： &quot; + realNumber + &quot; 件 &quot; + &quot; \\t  服务器端口： &quot; + serverPort);\n                return &quot; 你已经成功秒杀商品，此时还剩余： &quot; + realNumber + &quot; 件 &quot; + &quot; \\t  服务器端口： &quot; + serverPort;\n            } else {\n                System.out.println(&quot; 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 &quot; + &quot; \\t  服务器端口： &quot; + serverPort);\n            }\n            return &quot; 商品已经售罄 / 活动结束 / 调用超时，欢迎下次光临 &quot; + &quot; \\t  服务器端口： &quot; + serverPort;\n        } finally {\n            Jedis jedis = RedisUtils.getJedis();\n            String script = &quot;if redis.call('get', KEYS[1]) == ARGV[1] &quot; + &quot;then &quot; + &quot;return redis.call('del', KEYS[1]) &quot; + &quot;else &quot; + &quot;   return 0 &quot; + &quot;end&quot;;\n            try {\n                Object result = jedis.eval(script, Collections.singletonList(REDIS_LOCK_KEY), Collections.singletonList(value));\n                if (&quot;1&quot;.equals(result.toString())) {\n                    System.out.println(&quot;------del REDIS_LOCK_KEY success&quot;);\n                } else {\n                    System.out.println(&quot;------del REDIS_LOCK_KEY error&quot;);\n                }\n            } finally {\n                if (null != jedis) {\n                    jedis.close();\n                }\n            }\n        }\n    }\n}   \n</code></pre>","headings":[{"depth":1,"value":"Redis的分布式锁"},{"depth":1,"value":"利用redis实现分布式锁"},{"depth":2,"value":"三个重要因素"},{"depth":2,"value":"涉及命令"},{"depth":1,"value":"实现思想"},{"depth":2,"value":"业务执行的时间大于redis锁过期的时间"},{"depth":2,"value":"redis部署模式的影响"},{"depth":2,"value":"原子性问题"}],"path":"/topic/redis/Redis的分布式锁"},"tree":{"title":"redis","id":"20220428141727-a3p03i0","parentId":"","href":"/topic/redis","path":"/topic/redis","children":[{"title":"Redis为什么这么快","id":"20220428141727-jbyo2wp","type":"d","href":"/topic/redis/Redis为什么这么快","parentId":"","path":"/topic/redis/Redis为什么这么快","parentPath":"/topic/redis","sort":1,"children":[{"title":"完全基于内存","id":"20220428141727-m8thckv","type":"h","href":"/topic/redis/Redis为什么这么快#完全基于内存","parentId":"20220428141727-jbyo2wp","path":"/topic/redis/Redis为什么这么快","parentPath":"/topic/redis","children":[],"level":2},{"title":"数据结构简单","id":"20220428141727-0532nq9","type":"h","href":"/topic/redis/Redis为什么这么快#数据结构简单","parentId":"20220428141727-jbyo2wp","path":"/topic/redis/Redis为什么这么快","parentPath":"/topic/redis","children":[],"level":2},{"title":"工作线程采用单线程，避免了线程上下文切换所带来的损耗","id":"20220428141727-kw7bg9v","type":"h","href":"/topic/redis/Redis为什么这么快#工作线程采用单线程，避免了线程上下文切换所带来的损耗","parentId":"20220428141727-jbyo2wp","path":"/topic/redis/Redis为什么这么快","parentPath":"/topic/redis","children":[],"level":2},{"title":"对于客户端的连接采用多路复用和非阻塞I/O","id":"20220428141727-m7ruuk1","type":"h","href":"/topic/redis/Redis为什么这么快#对于客户端的连接采用多路复用和非阻塞I/O","parentId":"20220428141727-jbyo2wp","path":"/topic/redis/Redis为什么这么快","parentPath":"/topic/redis","children":[],"level":2},{"title":"redis单线程的问题","id":"20220428141728-w6wf4kq","type":"d","href":"/topic/redis/Redis为什么这么快/redis单线程的问题","parentId":"","path":"/topic/redis/Redis为什么这么快/redis单线程的问题","parentPath":"/topic/redis/Redis为什么这么快","sort":11,"children":[],"level":2}],"level":1},{"title":"Redis基本数据结构","id":"20220428141727-imsmasu","type":"d","href":"/topic/redis/Redis基本数据结构","parentId":"","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","sort":2,"children":[{"title":"常用的","id":"20220428141727-1gclyg6","type":"h","href":"/topic/redis/Redis基本数据结构#常用的","parentId":"20220428141727-imsmasu","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[{"title":"string","id":"20220428141727-u2m7nzt","type":"h","href":"/topic/redis/Redis基本数据结构#string","parentId":"20220428141727-1gclyg6","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"hash","id":"20220428141727-po0l8p4","type":"h","href":"/topic/redis/Redis基本数据结构#hash","parentId":"20220428141727-1gclyg6","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"list","id":"20220428141727-nyjx5v1","type":"h","href":"/topic/redis/Redis基本数据结构#list","parentId":"20220428141727-1gclyg6","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"set","id":"20220428141727-ujl3jkq","type":"h","href":"/topic/redis/Redis基本数据结构#set","parentId":"20220428141727-1gclyg6","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"zset","id":"20220428141727-8lh8dqt","type":"h","href":"/topic/redis/Redis基本数据结构#zset","parentId":"20220428141727-1gclyg6","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"扩展结构","id":"20220428141727-9xu8ei1","type":"h","href":"/topic/redis/Redis基本数据结构#扩展结构","parentId":"20220428141727-imsmasu","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[{"title":"bitmap","id":"20220428141727-89gt7iy","type":"h","href":"/topic/redis/Redis基本数据结构#bitmap","parentId":"20220428141727-9xu8ei1","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"hyperloglog","id":"20220428141727-08upaib","type":"h","href":"/topic/redis/Redis基本数据结构#hyperloglog","parentId":"20220428141727-9xu8ei1","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"GEO","id":"20220428141727-6z03dvm","type":"h","href":"/topic/redis/Redis基本数据结构#GEO","parentId":"20220428141727-9xu8ei1","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"扩展功能","id":"20220428141727-x5n4s7y","type":"h","href":"/topic/redis/Redis基本数据结构#扩展功能","parentId":"20220428141727-imsmasu","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[{"title":"pub/sub","id":"20220428141727-zay76x9","type":"h","href":"/topic/redis/Redis基本数据结构#pub/sub","parentId":"20220428141727-x5n4s7y","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"pipeline","id":"20220428141727-m3750uw","type":"h","href":"/topic/redis/Redis基本数据结构#pipeline","parentId":"20220428141727-x5n4s7y","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"Lua 脚本","id":"20220428141727-6rc0qt7","type":"h","href":"/topic/redis/Redis基本数据结构#Lua 脚本","parentId":"20220428141727-x5n4s7y","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3},{"title":"事务","id":"20220428141727-8i9gpxn","type":"h","href":"/topic/redis/Redis基本数据结构#事务","parentId":"20220428141727-x5n4s7y","path":"/topic/redis/Redis基本数据结构","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"String的底层实现","id":"20220428141728-d2hmuxd","type":"d","href":"/topic/redis/Redis基本数据结构/String的底层实现","parentId":"","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","sort":1,"children":[{"title":"SDS 结构","id":"20220428141728-y2039os","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#SDS 结构","parentId":"20220428141728-d2hmuxd","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":3},{"title":"相对于C语言的优势","id":"20220428141728-8t63ohh","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#相对于C语言的优势","parentId":"20220428141728-d2hmuxd","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[{"title":"统计长度时间复杂度 O(1)","id":"20220428141728-xeqpgol","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#统计长度时间复杂度 O(1)","parentId":"20220428141728-8t63ohh","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":4},{"title":"数据溢出","id":"20220428141728-coew455","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#数据溢出","parentId":"20220428141728-8t63ohh","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":4},{"title":"内存重分配策略","id":"20220428141728-mbwnou1","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#内存重分配策略","parentId":"20220428141728-8t63ohh","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":4},{"title":"数据格式多样性","id":"20220428141728-5h2se0u","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#数据格式多样性","parentId":"20220428141728-8t63ohh","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":4}],"level":3},{"title":"三大编码","id":"20220428141728-t4votze","type":"h","href":"/topic/redis/Redis基本数据结构/String的底层实现#三大编码","parentId":"20220428141728-d2hmuxd","path":"/topic/redis/Redis基本数据结构/String的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":3}],"level":2},{"title":"List的底层实现","id":"20220428141727-skh553t","type":"d","href":"/topic/redis/Redis基本数据结构/List的底层实现","parentId":"","path":"/topic/redis/Redis基本数据结构/List的底层实现","parentPath":"/topic/redis/Redis基本数据结构","sort":2,"children":[],"level":2},{"title":"Hash的底层实现","id":"20220428141727-g51ewzt","type":"d","href":"/topic/redis/Redis基本数据结构/Hash的底层实现","parentId":"","path":"/topic/redis/Redis基本数据结构/Hash的底层实现","parentPath":"/topic/redis/Redis基本数据结构","sort":3,"children":[{"title":"ZipList编码的哈希对象","id":"20220428141727-fo8pixs","type":"h","href":"/topic/redis/Redis基本数据结构/Hash的底层实现#ZipList编码的哈希对象","parentId":"20220428141727-g51ewzt","path":"/topic/redis/Redis基本数据结构/Hash的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":3},{"title":"hashtable对象","id":"20220428141727-f7zok8f","type":"h","href":"/topic/redis/Redis基本数据结构/Hash的底层实现#hashtable对象","parentId":"20220428141727-g51ewzt","path":"/topic/redis/Redis基本数据结构/Hash的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":3}],"level":2},{"title":"Set的底层实现","id":"20220428141728-5c6e914","type":"d","href":"/topic/redis/Redis基本数据结构/Set的底层实现","parentId":"","path":"/topic/redis/Redis基本数据结构/Set的底层实现","parentPath":"/topic/redis/Redis基本数据结构","sort":4,"children":[],"level":2},{"title":"ZSet的底层实现","id":"20220428141728-58eined","type":"d","href":"/topic/redis/Redis基本数据结构/ZSet的底层实现","parentId":"","path":"/topic/redis/Redis基本数据结构/ZSet的底层实现","parentPath":"/topic/redis/Redis基本数据结构","sort":5,"children":[{"title":"跳表是什么?","id":"20220428141728-9by553n","type":"h","href":"/topic/redis/Redis基本数据结构/ZSet的底层实现#跳表是什么?","parentId":"20220428141728-58eined","path":"/topic/redis/Redis基本数据结构/ZSet的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[{"title":"优缺点","id":"20220428141728-rvbr2il","type":"h","href":"/topic/redis/Redis基本数据结构/ZSet的底层实现#优缺点","parentId":"20220428141728-9by553n","path":"/topic/redis/Redis基本数据结构/ZSet的底层实现","parentPath":"/topic/redis/Redis基本数据结构","children":[],"level":4}],"level":3}],"level":2}],"level":1},{"title":"Redis分布式缓存","id":"20220428141727-3x1i5zp","type":"d","href":"/topic/redis/Redis分布式缓存","parentId":"","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","sort":3,"children":[{"title":"双写一致性","id":"20220428141727-zahxna7","type":"h","href":"/topic/redis/Redis分布式缓存#双写一致性","parentId":"20220428141727-3x1i5zp","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":2},{"title":"缓存更新策略","id":"20220428141727-iqgn80l","type":"h","href":"/topic/redis/Redis分布式缓存#缓存更新策略","parentId":"20220428141727-3x1i5zp","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"最常见的策略","id":"20220428141727-45wxv7a","type":"h","href":"/topic/redis/Redis分布式缓存#最常见的策略","parentId":"20220428141727-iqgn80l","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"优点剖析","id":"20220428141727-tfanvhu","type":"h","href":"/topic/redis/Redis分布式缓存#优点剖析","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"1. “先淘汰缓存，再写数据库” 合理","id":"20220428141727-vzyp7bi","type":"h","href":"/topic/redis/Redis分布式缓存#1. “先淘汰缓存，再写数据库” 合理","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"2. 异步刷新，补缺补漏","id":"20220428141727-kbueoxr","type":"h","href":"/topic/redis/Redis分布式缓存#2. 异步刷新，补缺补漏","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"缺点剖析","id":"20220428141727-sd1lbh3","type":"h","href":"/topic/redis/Redis分布式缓存#缺点剖析","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"1. 容灾不足","id":"20220428141727-aff14q4","type":"h","href":"/topic/redis/Redis分布式缓存#1. 容灾不足","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"2. 并发问题","id":"20220428141727-7kjhtfn","type":"h","href":"/topic/redis/Redis分布式缓存#2. 并发问题","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"方案总结","id":"20220428141727-5w2loli","type":"h","href":"/topic/redis/Redis分布式缓存#方案总结","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"写流程：","id":"20220428141727-s959uv0","type":"h","href":"/topic/redis/Redis分布式缓存#写流程：","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"读流程：","id":"20220428141727-sceljri","type":"h","href":"/topic/redis/Redis分布式缓存#读流程：","parentId":"20220428141727-45wxv7a","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4}],"level":3},{"title":"方案分析","id":"20220428141727-7flpl0m","type":"h","href":"/topic/redis/Redis分布式缓存#方案分析","parentId":"20220428141727-iqgn80l","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"优点剖析","id":"20220428141727-1cqjx66","type":"h","href":"/topic/redis/Redis分布式缓存#优点剖析","parentId":"20220428141727-7flpl0m","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"1. 容灾","id":"20220428141727-w9bvsqf","type":"h","href":"/topic/redis/Redis分布式缓存#1. 容灾","parentId":"20220428141727-1cqjx66","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":5}],"level":4},{"title":"缺点剖析","id":"20220428141727-n1twxfd","type":"h","href":"/topic/redis/Redis分布式缓存#缺点剖析","parentId":"20220428141727-7flpl0m","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"1. 只适合简单业务，复杂业务容易发生并发问题","id":"20220428141727-t5kobxh","type":"h","href":"/topic/redis/Redis分布式缓存#1. 只适合简单业务，复杂业务容易发生并发问题","parentId":"20220428141727-n1twxfd","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"缺点1的改进","id":"20220428141727-bz5ta88","type":"h","href":"/topic/redis/Redis分布式缓存#缺点1的改进","parentId":"20220428141727-t5kobxh","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":6}],"level":5},{"title":"2. 依然是并发问题","id":"20220428141727-gysgmg1","type":"h","href":"/topic/redis/Redis分布式缓存#2. 依然是并发问题","parentId":"20220428141727-n1twxfd","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":5}],"level":4}],"level":3},{"title":"方案总结","id":"20220428141727-01sdgjy","type":"h","href":"/topic/redis/Redis分布式缓存#方案总结","parentId":"20220428141727-iqgn80l","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"写流程：","id":"20220428141727-eglmgkf","type":"h","href":"/topic/redis/Redis分布式缓存#写流程：","parentId":"20220428141727-01sdgjy","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4},{"title":"读流程：","id":"20220428141727-1vywbk4","type":"h","href":"/topic/redis/Redis分布式缓存#读流程：","parentId":"20220428141727-01sdgjy","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":4}],"level":3},{"title":"方案分析","id":"20220428141727-137lw2k","type":"h","href":"/topic/redis/Redis分布式缓存#方案分析","parentId":"20220428141727-iqgn80l","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"优点剖析","id":"20220428141727-p0zad1o","type":"h","href":"/topic/redis/Redis分布式缓存#优点剖析","parentId":"20220428141727-137lw2k","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"1. 容灾完善","id":"20220428141727-cawius6","type":"h","href":"/topic/redis/Redis分布式缓存#1. 容灾完善","parentId":"20220428141727-p0zad1o","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"写流程容灾分析","id":"20220428141727-2d2z7fz","type":"h","href":"/topic/redis/Redis分布式缓存#写流程容灾分析","parentId":"20220428141727-cawius6","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":6},{"title":"读流程容灾分析","id":"20220428141727-4hr5okn","type":"h","href":"/topic/redis/Redis分布式缓存#读流程容灾分析","parentId":"20220428141727-cawius6","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":6}],"level":5},{"title":"2. 无并发问题","id":"20220428141727-uvwj2ga","type":"h","href":"/topic/redis/Redis分布式缓存#2. 无并发问题","parentId":"20220428141727-p0zad1o","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":5}],"level":4},{"title":"缺点剖析","id":"20220428141727-fmiz5zl","type":"h","href":"/topic/redis/Redis分布式缓存#缺点剖析","parentId":"20220428141727-137lw2k","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[{"title":"1. 增加Cache_0强依赖","id":"20220428141727-hr6lxu9","type":"h","href":"/topic/redis/Redis分布式缓存#1. 增加Cache_0强依赖","parentId":"20220428141727-fmiz5zl","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":5},{"title":"2. 复杂度是比较高的","id":"20220428141727-vbiftey","type":"h","href":"/topic/redis/Redis分布式缓存#2. 复杂度是比较高的","parentId":"20220428141727-fmiz5zl","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":5}],"level":4}],"level":3},{"title":"方案总结","id":"20220428141727-0an20z6","type":"h","href":"/topic/redis/Redis分布式缓存#方案总结","parentId":"20220428141727-iqgn80l","path":"/topic/redis/Redis分布式缓存","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"缓存击穿","id":"20220428141728-p93afgy","type":"d","href":"/topic/redis/Redis分布式缓存/缓存击穿","parentId":"","path":"/topic/redis/Redis分布式缓存/缓存击穿","parentPath":"/topic/redis/Redis分布式缓存","sort":1,"children":[{"title":"解决方案","id":"20220428141728-27esyuz","type":"h","href":"/topic/redis/Redis分布式缓存/缓存击穿#解决方案","parentId":"20220428141728-p93afgy","path":"/topic/redis/Redis分布式缓存/缓存击穿","parentPath":"/topic/redis/Redis分布式缓存","children":[{"title":"不过期","id":"20220428141728-foxjedm","type":"h","href":"/topic/redis/Redis分布式缓存/缓存击穿#不过期","parentId":"20220428141728-27esyuz","path":"/topic/redis/Redis分布式缓存/缓存击穿","parentPath":"/topic/redis/Redis分布式缓存","children":[],"level":4},{"title":"互斥锁","id":"20220428141728-68zg08m","type":"h","href":"/topic/redis/Redis分布式缓存/缓存击穿#互斥锁","parentId":"20220428141728-27esyuz","path":"/topic/redis/Redis分布式缓存/缓存击穿","parentPath":"/topic/redis/Redis分布式缓存","children":[],"level":4}],"level":3}],"level":2},{"title":"缓存穿透","id":"20220428141728-64iljj5","type":"d","href":"/topic/redis/Redis分布式缓存/缓存穿透","parentId":"","path":"/topic/redis/Redis分布式缓存/缓存穿透","parentPath":"/topic/redis/Redis分布式缓存","sort":3,"children":[{"title":"接口校验","id":"20220428141728-wny00tb","type":"h","href":"/topic/redis/Redis分布式缓存/缓存穿透#接口校验","parentId":"20220428141728-64iljj5","path":"/topic/redis/Redis分布式缓存/缓存穿透","parentPath":"/topic/redis/Redis分布式缓存","children":[],"level":3},{"title":"空对象缓存或者缺省值","id":"20220428141728-6wjc642","type":"h","href":"/topic/redis/Redis分布式缓存/缓存穿透#空对象缓存或者缺省值","parentId":"20220428141728-64iljj5","path":"/topic/redis/Redis分布式缓存/缓存穿透","parentPath":"/topic/redis/Redis分布式缓存","children":[],"level":3},{"title":"布隆过滤器","id":"20220428141728-r9yad28","type":"h","href":"/topic/redis/Redis分布式缓存/缓存穿透#布隆过滤器","parentId":"20220428141728-64iljj5","path":"/topic/redis/Redis分布式缓存/缓存穿透","parentPath":"/topic/redis/Redis分布式缓存","children":[],"level":3}],"level":2},{"title":"缓存雪崩","id":"20220428141728-9ti4duq","type":"d","href":"/topic/redis/Redis分布式缓存/缓存雪崩","parentId":"","path":"/topic/redis/Redis分布式缓存/缓存雪崩","parentPath":"/topic/redis/Redis分布式缓存","sort":4,"children":[{"title":"解决方案","id":"20220428141728-zu9jxq3","type":"h","href":"/topic/redis/Redis分布式缓存/缓存雪崩#解决方案","parentId":"20220428141728-9ti4duq","path":"/topic/redis/Redis分布式缓存/缓存雪崩","parentPath":"/topic/redis/Redis分布式缓存","children":[{"title":"三步骤","id":"20220428141728-0vnf8gp","type":"h","href":"/topic/redis/Redis分布式缓存/缓存雪崩#三步骤","parentId":"20220428141728-zu9jxq3","path":"/topic/redis/Redis分布式缓存/缓存雪崩","parentPath":"/topic/redis/Redis分布式缓存","children":[],"level":4}],"level":3}],"level":2},{"title":"缓存预热","id":"20220428141728-fz10tn2","type":"d","href":"/topic/redis/Redis分布式缓存/缓存预热","parentId":"","path":"/topic/redis/Redis分布式缓存/缓存预热","parentPath":"/topic/redis/Redis分布式缓存","sort":7,"children":[],"level":2}],"level":1},{"title":"Redis的分布式锁","id":"20220428141727-sgydg0x","type":"d","href":"/topic/redis/Redis的分布式锁","parentId":"","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","sort":4,"children":[{"title":"利用redis实现分布式锁","id":"20220428141727-e4nwnv1","type":"h","href":"/topic/redis/Redis的分布式锁#利用redis实现分布式锁","parentId":"20220428141727-sgydg0x","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[{"title":"三个重要因素","id":"20220428141727-zthzzjq","type":"h","href":"/topic/redis/Redis的分布式锁#三个重要因素","parentId":"20220428141727-e4nwnv1","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[],"level":3},{"title":"涉及命令","id":"20220428141727-hs1yg88","type":"h","href":"/topic/redis/Redis的分布式锁#涉及命令","parentId":"20220428141727-e4nwnv1","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"实现思想","id":"20220428141727-5jo3h6s","type":"h","href":"/topic/redis/Redis的分布式锁#实现思想","parentId":"20220428141727-sgydg0x","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[{"title":"业务执行的时间大于redis锁过期的时间","id":"20220428141727-q83o36l","type":"h","href":"/topic/redis/Redis的分布式锁#业务执行的时间大于redis锁过期的时间","parentId":"20220428141727-5jo3h6s","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[],"level":3},{"title":"redis部署模式的影响","id":"20220428141727-9xczwbf","type":"h","href":"/topic/redis/Redis的分布式锁#redis部署模式的影响","parentId":"20220428141727-5jo3h6s","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[],"level":3},{"title":"原子性问题","id":"20220428141727-u4jomll","type":"h","href":"/topic/redis/Redis的分布式锁#原子性问题","parentId":"20220428141727-5jo3h6s","path":"/topic/redis/Redis的分布式锁","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"看门狗模式","id":"20220428141728-gdeeql2","type":"d","href":"/topic/redis/Redis的分布式锁/看门狗模式","parentId":"","path":"/topic/redis/Redis的分布式锁/看门狗模式","parentPath":"/topic/redis/Redis的分布式锁","sort":1,"children":[],"level":2},{"title":"Redlock","id":"20220428141728-qbzn1tc","type":"d","href":"/topic/redis/Redis的分布式锁/Redlock","parentId":"","path":"/topic/redis/Redis的分布式锁/Redlock","parentPath":"/topic/redis/Redis的分布式锁","sort":2,"children":[{"title":"问题1","id":"20220428141728-lg0r797","type":"h","href":"/topic/redis/Redis的分布式锁/Redlock#问题1","parentId":"20220428141728-qbzn1tc","path":"/topic/redis/Redis的分布式锁/Redlock","parentPath":"/topic/redis/Redis的分布式锁","children":[],"level":3},{"title":"问题2","id":"20220428141728-nhr8fen","type":"h","href":"/topic/redis/Redis的分布式锁/Redlock#问题2","parentId":"20220428141728-qbzn1tc","path":"/topic/redis/Redis的分布式锁/Redlock","parentPath":"/topic/redis/Redis的分布式锁","children":[],"level":3},{"title":"问题3","id":"20220428141728-5jc3ave","type":"h","href":"/topic/redis/Redis的分布式锁/Redlock#问题3","parentId":"20220428141728-qbzn1tc","path":"/topic/redis/Redis的分布式锁/Redlock","parentPath":"/topic/redis/Redis的分布式锁","children":[],"level":3}],"level":2}],"level":1},{"title":"Redis集群","id":"20220428141727-awm7yu5","type":"d","href":"/topic/redis/Redis集群","parentId":"","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","sort":6,"children":[{"title":"三种集群方案","id":"20220428141727-id6w37y","type":"h","href":"/topic/redis/Redis集群#三种集群方案","parentId":"20220428141727-awm7yu5","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":2},{"title":"主从复制模式","id":"20220428141727-01yokji","type":"h","href":"/topic/redis/Redis集群#主从复制模式","parentId":"20220428141727-awm7yu5","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[{"title":"原理","id":"20220428141727-2xgqon2","type":"h","href":"/topic/redis/Redis集群#原理","parentId":"20220428141727-01yokji","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3},{"title":"redis主从复制的坑","id":"20220428141727-h04f0fa","type":"h","href":"/topic/redis/Redis集群#redis主从复制的坑","parentId":"20220428141727-01yokji","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"哨兵模式","id":"20220428141727-jxcatge","type":"h","href":"/topic/redis/Redis集群#哨兵模式","parentId":"20220428141727-awm7yu5","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[{"title":"哨兵模式的作用","id":"20220428141727-3jb6vil","type":"h","href":"/topic/redis/Redis集群#哨兵模式的作用","parentId":"20220428141727-jxcatge","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3},{"title":"故障切换的过程","id":"20220428141727-uscl9hh","type":"h","href":"/topic/redis/Redis集群#故障切换的过程","parentId":"20220428141727-jxcatge","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3},{"title":"哨兵模式的工作方式：","id":"20220428141727-fe5liq6","type":"h","href":"/topic/redis/Redis集群#哨兵模式的工作方式：","parentId":"20220428141727-jxcatge","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3},{"title":"哨兵模式的优缺点","id":"20220428141727-fq18erp","type":"h","href":"/topic/redis/Redis集群#哨兵模式的优缺点","parentId":"20220428141727-jxcatge","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"Cluster 集群模式（Redis官方）","id":"20220428141727-z0udk1o","type":"h","href":"/topic/redis/Redis集群#Cluster 集群模式（Redis官方）","parentId":"20220428141727-awm7yu5","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[{"title":"集群的数据分片","id":"20220428141727-zez6jhc","type":"h","href":"/topic/redis/Redis集群#集群的数据分片","parentId":"20220428141727-z0udk1o","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3},{"title":"Redis 集群的主从复制模型","id":"20220428141727-guu9h2l","type":"h","href":"/topic/redis/Redis集群#Redis 集群的主从复制模型","parentId":"20220428141727-z0udk1o","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3},{"title":"集群的特点","id":"20220428141727-a9a9ogo","type":"h","href":"/topic/redis/Redis集群#集群的特点","parentId":"20220428141727-z0udk1o","path":"/topic/redis/Redis集群","parentPath":"/topic/redis","children":[],"level":3}],"level":2},{"title":"Redis数据淘汰策略","id":"20220428141727-oaw8wmd","type":"d","href":"/topic/redis/Redis集群/Redis数据淘汰策略","parentId":"","path":"/topic/redis/Redis集群/Redis数据淘汰策略","parentPath":"/topic/redis/Redis集群","sort":5,"children":[{"title":"Redis的内存淘汰策略，有以下几种","id":"20220428141727-aort8cn","type":"h","href":"/topic/redis/Redis集群/Redis数据淘汰策略#Redis的内存淘汰策略，有以下几种","parentId":"20220428141727-oaw8wmd","path":"/topic/redis/Redis集群/Redis数据淘汰策略","parentPath":"/topic/redis/Redis集群","children":[],"level":3},{"title":"数据库中有 3000w 的数据，而 Redis 中只有 100w 数据，如何保证 Redis 中存放的都是热点数据","id":"20220428141727-egla613","type":"h","href":"/topic/redis/Redis集群/Redis数据淘汰策略#数据库中有 3000w 的数据，而 Redis 中只有 100w 数据，如何保证 Redis 中存放的都是热点数据","parentId":"20220428141727-oaw8wmd","path":"/topic/redis/Redis集群/Redis数据淘汰策略","parentPath":"/topic/redis/Redis集群","children":[],"level":3}],"level":2},{"title":"redis持久化","id":"20220428141728-ahu8hnn","type":"d","href":"/topic/redis/Redis集群/redis持久化","parentId":"","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","sort":8,"children":[{"title":"策略","id":"20220428141728-h8spnbe","type":"h","href":"/topic/redis/Redis集群/redis持久化#策略","parentId":"20220428141728-ahu8hnn","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":3},{"title":"AOF持久化","id":"20220428141728-8sb3e90","type":"h","href":"/topic/redis/Redis集群/redis持久化#AOF持久化","parentId":"20220428141728-ahu8hnn","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[{"title":"执行流程","id":"20220428141728-xdy9wq3","type":"h","href":"/topic/redis/Redis集群/redis持久化#执行流程","parentId":"20220428141728-8sb3e90","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":4},{"title":"怎么防止AOF文件越来越大？","id":"20220428141728-2fjjnsi","type":"h","href":"/topic/redis/Redis集群/redis持久化#怎么防止AOF文件越来越大？","parentId":"20220428141728-8sb3e90","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[{"title":"AOF文件追加阻塞？","id":"20220428141728-jggnla6","type":"h","href":"/topic/redis/Redis集群/redis持久化#AOF文件追加阻塞？","parentId":"20220428141728-2fjjnsi","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":5}],"level":4}],"level":3},{"title":"RDB持久化","id":"20220428141728-3uk1dzb","type":"h","href":"/topic/redis/Redis集群/redis持久化#RDB持久化","parentId":"20220428141728-ahu8hnn","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[{"title":"执行流程","id":"20220428141728-b6xujxs","type":"h","href":"/topic/redis/Redis集群/redis持久化#执行流程","parentId":"20220428141728-3uk1dzb","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":4}],"level":3},{"title":"混合持久化（Redis4.0+）","id":"20220428141728-z9bdsb4","type":"h","href":"/topic/redis/Redis集群/redis持久化#混合持久化（Redis4.0+）","parentId":"20220428141728-ahu8hnn","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[{"title":"执行流程","id":"20220428141728-flzi42f","type":"h","href":"/topic/redis/Redis集群/redis持久化#执行流程","parentId":"20220428141728-z9bdsb4","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":4}],"level":3},{"title":"Redis的数据恢复策略","id":"20220428141728-x9y47t6","type":"h","href":"/topic/redis/Redis集群/redis持久化#Redis的数据恢复策略","parentId":"20220428141728-ahu8hnn","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":3},{"title":"Redis持久化策略该如何进行选择","id":"20220428141728-54y3bdq","type":"h","href":"/topic/redis/Redis集群/redis持久化#Redis持久化策略该如何进行选择","parentId":"20220428141728-ahu8hnn","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[{"title":"1.不需要考虑数据丢失的情况","id":"20220428141728-ujbrmwt","type":"h","href":"/topic/redis/Redis集群/redis持久化#1.不需要考虑数据丢失的情况","parentId":"20220428141728-54y3bdq","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":4},{"title":"2.单机实例情况下","id":"20220428141728-zahznfw","type":"h","href":"/topic/redis/Redis集群/redis持久化#2.单机实例情况下","parentId":"20220428141728-54y3bdq","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":4},{"title":"3.在主从环境下","id":"20220428141728-jbd8vij","type":"h","href":"/topic/redis/Redis集群/redis持久化#3.在主从环境下","parentId":"20220428141728-54y3bdq","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[{"title":"那么在从服务器进行数据热备份的情况下，是否还需要持久化呢？","id":"20220428141728-sjs8krt","type":"h","href":"/topic/redis/Redis集群/redis持久化#那么在从服务器进行数据热备份的情况下，是否还需要持久化呢？","parentId":"20220428141728-jbd8vij","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":5},{"title":"4.异地灾备","id":"20220428141728-aryf17w","type":"h","href":"/topic/redis/Redis集群/redis持久化#4.异地灾备","parentId":"20220428141728-jbd8vij","path":"/topic/redis/Redis集群/redis持久化","parentPath":"/topic/redis/Redis集群","children":[],"level":5}],"level":4}],"level":3}],"level":2},{"title":"Redis数据删除策略","id":"20220428141727-pvzi1zo","type":"d","href":"/topic/redis/Redis集群/Redis数据删除策略","parentId":"","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","sort":13,"children":[{"title":"惰性删除","id":"20220428141727-o0rija8","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#惰性删除","parentId":"20220428141727-pvzi1zo","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":3},{"title":"定期删除","id":"20220428141727-wq9axfb","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#定期删除","parentId":"20220428141727-pvzi1zo","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":3},{"title":"AOF、RDB 和复制功能对过期键的处理","id":"20220428141727-gr8a4lk","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#AOF、RDB 和复制功能对过期键的处理","parentId":"20220428141727-pvzi1zo","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[{"title":"RDB","id":"20220428141727-xhxrdyf","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#RDB","parentId":"20220428141727-gr8a4lk","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":4},{"title":"AOF","id":"20220428141727-z7l5azb","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#AOF","parentId":"20220428141727-gr8a4lk","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":4},{"title":"复制","id":"20220428141727-vdap5h4","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#复制","parentId":"20220428141727-gr8a4lk","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":4}],"level":3},{"title":"疑问点？","id":"20220428141727-5x39avu","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#疑问点？","parentId":"20220428141727-pvzi1zo","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[{"title":"如果主从服务器链接断开怎么办？","id":"20220428141727-4505lb0","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#如果主从服务器链接断开怎么办？","parentId":"20220428141727-5x39avu","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":4},{"title":"如果发生网络抖动，主服务器发送的 del 命令没有传递到从服务器怎么办？","id":"20220428141727-4x9rpfk","type":"h","href":"/topic/redis/Redis集群/Redis数据删除策略#如果发生网络抖动，主服务器发送的 del 命令没有传递到从服务器怎么办？","parentId":"20220428141727-5x39avu","path":"/topic/redis/Redis集群/Redis数据删除策略","parentPath":"/topic/redis/Redis集群","children":[],"level":4}],"level":3}],"level":2}],"level":1}],"level":0},"headings":[{"depth":1,"value":"Redis的分布式锁","slug":"redis的分布式锁"},{"depth":1,"value":"利用redis实现分布式锁","slug":"利用redis实现分布式锁"},{"depth":2,"value":"三个重要因素","slug":"三个重要因素"},{"depth":2,"value":"涉及命令","slug":"涉及命令"},{"depth":1,"value":"实现思想","slug":"实现思想"},{"depth":2,"value":"业务执行的时间大于redis锁过期的时间","slug":"业务执行的时间大于redis锁过期的时间"},{"depth":2,"value":"redis部署模式的影响","slug":"redis部署模式的影响"},{"depth":2,"value":"原子性问题","slug":"原子性问题"}]}},
    "staticQueryHashes": ["630634786","928362550"]}