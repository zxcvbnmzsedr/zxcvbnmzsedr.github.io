(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{448:function(a,s,t){"use strict";t.r(s);var e=t(7),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"定时备份数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定时备份数据"}},[a._v("#")]),a._v(" 定时备份数据")]),a._v(" "),s("p",[a._v("为了防止硬盘的损坏，因此需要定时将数据同步到阿里云盘中。。。。")]),a._v(" "),s("p",[a._v("通过 rclone 命令将定时任务挂载到阿里云盘中。")]),a._v(" "),s("p",[a._v("在配置 rclone 的时候，如果是 webdav 一定要选择 webdav，而不能选择 http，如果选择了 http 协议在挂载和读取的过程中没有任何问题，但是在上传文件的时候会爆出权限异常，"),s("code",[a._v("http remotes are read only")])]),a._v(" "),s("p",[a._v("rclone 同步的命令是:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# transfers 指定同时上传数量")]),a._v("\nrclone "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sync")]),a._v(" /home ali:/omv/back/home "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--transfers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v("\n")])])]),s("p",[a._v("将 rclone 配置成服务:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/systemd/system/backup.service\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("backup\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("After")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("network.target\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("oneshot\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("User")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ExecStart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/usr/bin/rclone "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sync")]),a._v(" /home ali:/omv/back/home "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--transfers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("on-failure\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("WantedBy")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("multi-user.target\n")])])]),s("p",[a._v("将 rclone 配置成定时任务:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/systemd/system/backup.timer\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("backUp Timer\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Timer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("OnUnitActiveSec")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1h\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Unit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("backup.service\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("WantedBy")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("multi-user.target\n")])])]),s("p",[a._v("之后只需要开启定时任务即可:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("systemctl daemon-reload\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" backup.timer\nsystemctl start backup.timer\n")])])]),s("p",[a._v("如果不放心，手动启动一遍看有没有错:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("systemctl start backup\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看状态")]),a._v("\nsystemctl status backup\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 连续打印日志")]),a._v("\njournalctl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" backup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);