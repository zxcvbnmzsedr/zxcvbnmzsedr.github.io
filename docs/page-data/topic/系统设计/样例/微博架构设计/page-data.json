{
    "componentChunkName": "component---src-templates-topic-page-template-tsx",
    "path": "/topic/系统设计/样例/微博架构设计",
    "result": {"pageContext":{"id":"/topic/系统设计/样例/微博架构设计","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"微博架构设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"微博日活跃用户1.6亿+，每日访问量达百亿级，面对庞大用户群的海量访问，需要有良好的架构设计来支撑微博这庞大的访问量。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概述用例和约束"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"发布了一条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"服务"}]},{"type":"text","value":"将微博推送给关注者，并且进行手机推送"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"浏览自己的微博列表"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"浏览主页的微博列表（聚合关注的人的微博）"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"可以通过关键词搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"服务"}]},{"type":"text","value":"应该具有高可用性"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"限制条件与假设"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"普遍情况"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"网络流量不是均匀分布的"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"发布微博的速度需要足够快速"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"除非有上百万的关注者，否则将微博推送给粉丝的速度要足够快"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1 亿个活跃用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每天新发布 5 亿条微博，每月新发布 150 亿条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"平均每条微博需要推送给 5 个人"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每天需要进行 50 亿次推送"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月需要进行 1500 亿次推送"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月需要处理 2500 亿次读取请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月需要处理 100 亿次搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"浏览功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"浏览的速度需要足够快"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"读取的负载远大于写入的负载"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索的速度需要足够快"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索是高负载的读取功能"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"计算用量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每条微博的大小："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"weibo_id"}]},{"type":"text","value":" - 8 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"user_id"}]},{"type":"text","value":" - 32 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"text"}]},{"type":"text","value":" - 140 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"media"}]},{"type":"text","value":" - 平均 10 KB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"总计： 大约 10 KB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月产生新微博的内容为 150 TB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每条微博 10 KB * 每天 5 亿条微博* 每月 30 天"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"3 年产生的内容为 5.4 PB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒需要处理 10 万次读取请求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月需要处理 2500 亿次请求 * (每秒 400 次请求 / 每月 10 亿次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒发布 6000 条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月发布 150 亿条微博 * (每秒 400 次请求 / 每月 10 次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒推送 6 万条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月推送 1500 亿条微博 * (每秒 400 次请求 / 每月 10 亿次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒 4000 次搜索请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概要设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["mermaid"],"dataProcessed":"true"},"children":[{"type":"element","tagName":"svg","properties":{"id":"mermaid-1656998103768","width":"100%","xmlns":"http://www.w3.org/2000/svg","xmlnsXLink":"http://www.w3.org/1999/xlink","height":"408.5","style":"max-width: 1179.525390625px;","viewBox":"0 0 1179.525390625 408.5"},"children":[{"type":"element","tagName":"style","properties":{},"children":[{"type":"text","value":"#mermaid-1656998103768 {font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1656998103768 .error-icon{fill:#552222;}#mermaid-1656998103768 .error-text{fill:#552222;stroke:#552222;}#mermaid-1656998103768 .edge-thickness-normal{stroke-width:2px;}#mermaid-1656998103768 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1656998103768 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1656998103768 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1656998103768 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1656998103768 .marker{fill:#333333;stroke:#333333;}#mermaid-1656998103768 .marker.cross{stroke:#333333;}#mermaid-1656998103768 svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-1656998103768 .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-1656998103768 .cluster-label text{fill:#333;}#mermaid-1656998103768 .cluster-label span{color:#333;}#mermaid-1656998103768 .label text,#mermaid-1656998103768 span{fill:#333;color:#333;}#mermaid-1656998103768 .node rect,#mermaid-1656998103768 .node circle,#mermaid-1656998103768 .node ellipse,#mermaid-1656998103768 .node polygon,#mermaid-1656998103768 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1656998103768 .node .label{text-align:center;}#mermaid-1656998103768 .node.clickable{cursor:pointer;}#mermaid-1656998103768 .arrowheadPath{fill:#333333;}#mermaid-1656998103768 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1656998103768 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1656998103768 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1656998103768 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1656998103768 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1656998103768 .cluster text{fill:#333;}#mermaid-1656998103768 .cluster span{color:#333;}#mermaid-1656998103768 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1656998103768 :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}"}]},{"type":"element","tagName":"g","properties":{},"children":[{"type":"element","tagName":"g","properties":{"className":["output"]},"children":[{"type":"element","tagName":"g","properties":{"className":["clusters"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["edgePaths"]},"children":[{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-Client","LE-WebServer"],"id":"L-Client-WebServer","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M580.08984375,46.5L580.08984375,50.666666666666664C580.08984375,54.833333333333336,580.08984375,63.166666666666664,580.08984375,71.5C580.08984375,79.83333333333333,580.08984375,88.16666666666667,580.08984375,92.33333333333333L580.08984375,96.5","markerEnd":"url(#arrowhead37)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead37","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WebServer","LE-WriteAPI"],"id":"L-WebServer-WriteAPI","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M628.0703125,125.6961584913947L655.6507161458334,131.4134654094956C683.2311197916666,137.13077232759647,738.3919270833334,148.56538616379825,765.9723307291666,158.4493597485658C793.552734375,168.33333333333334,793.552734375,176.66666666666666,793.552734375,180.83333333333334L793.552734375,185","markerEnd":"url(#arrowhead38)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead38","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WebServer","LE-ReadAPI"],"id":"L-WebServer-ReadAPI","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M580.08984375,135L580.08984375,139.16666666666666C580.08984375,143.33333333333334,580.08984375,151.66666666666666,580.08984375,160C580.08984375,168.33333333333334,580.08984375,176.66666666666666,580.08984375,180.83333333333334L580.08984375,185","markerEnd":"url(#arrowhead39)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead39","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-ReadAPI","LE-TimeLineService"],"id":"L-ReadAPI-TimeLineService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M541.328125,215.78397733093422L523.0035807291666,221.2366477757785C504.6790364583333,226.68931822062282,468.0299479166667,237.59465911031143,449.7054036458333,247.21399622182238C431.380859375,256.8333333333333,431.380859375,265.1666666666667,431.380859375,269.3333333333333L431.380859375,273.5","markerEnd":"url(#arrowhead40)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead40","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-TimeLineService","LE-WeiboInfoService"],"id":"L-TimeLineService-WeiboInfoService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M431.380859375,312L431.380859375,316.1666666666667C431.380859375,320.3333333333333,431.380859375,328.6666666666667,431.380859375,337C431.380859375,345.3333333333333,431.380859375,353.6666666666667,431.380859375,357.8333333333333L431.380859375,362","markerEnd":"url(#arrowhead41)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead41","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-TimeLineService","LE-UserInfoService"],"id":"L-TimeLineService-UserInfoService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M362.873046875,301.22274126721584L314.6591796875,307.18561772267986C266.4453125,313.1484941781439,170.017578125,325.07424708907195,121.8037109375,335.20379021120266C73.58984375,345.3333333333333,73.58984375,353.6666666666667,73.58984375,357.8333333333333L73.58984375,362","markerEnd":"url(#arrowhead42)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead42","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-TimeLineService","LE-MemoryCache"],"id":"L-TimeLineService-MemoryCache","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M499.888671875,306.4658498435871L525.3072916666666,311.55487486965586C550.7259114583334,316.6438998957247,601.5631510416666,326.8219499478624,632.2923581685499,336.07764164059785C663.0215652954331,345.3333333333333,673.6427399658663,353.6666666666667,678.9533273010828,357.8333333333333L684.2639146362994,362","markerEnd":"url(#arrowhead43)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead43","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WriteAPI","LE-FansService"],"id":"L-WriteAPI-FansService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M761.0326734639831,223.5L753.9936992408193,227.66666666666666C746.9547250176553,231.83333333333334,732.8767765713277,240.16666666666666,725.8378023481638,248.5C718.798828125,256.8333333333333,718.798828125,265.1666666666667,718.798828125,269.3333333333333L718.798828125,273.5","markerEnd":"url(#arrowhead44)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead44","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-MemoryCache"],"id":"L-FansService-MemoryCache","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M718.798828125,312L718.798828125,316.1666666666667C718.798828125,320.3333333333333,718.798828125,328.6666666666667,717.8572085393126,337C716.9155889536252,345.3333333333333,715.0323497822504,353.6666666666667,714.0907301965631,357.8333333333333L713.1491106108757,362","markerEnd":"url(#arrowhead45)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead45","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-UserGraphService"],"id":"L-FansService-UserGraphService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M770.654296875,298.79744685231896L825.2506510416666,305.1645390435991C879.8470052083334,311.5316312348793,989.0397135416666,324.2658156174396,1043.6360677083333,334.79957447538646C1098.232421875,345.3333333333333,1098.232421875,353.6666666666667,1098.232421875,357.8333333333333L1098.232421875,362","markerEnd":"url(#arrowhead46)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead46","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-SearchService"],"id":"L-FansService-SearchService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M666.943359375,296.9405651089876L584.3251953125,303.617137590823C501.70703125,310.29371007265837,336.470703125,323.6468550363292,261.1637001971516,334.49009418483126C185.85669726930323,345.3333333333333,200.4790195386064,353.6666666666667,207.790180673258,357.8333333333333L215.1013418079096,362","markerEnd":"url(#arrowhead47)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead47","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-SearchAPI","LE-SearchService"],"id":"L-SearchAPI-SearchService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M210.99534339689265,312L218.9759372057439,316.1666666666667C226.95653101459507,320.3333333333333,242.91771863229755,328.6666666666667,249.95669285546137,337C256.9956670786252,345.3333333333333,255.11242790725046,353.6666666666667,254.17080832156307,357.8333333333333L253.2291887358757,362","markerEnd":"url(#arrowhead48)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead48","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-NotificationService"],"id":"L-FansService-NotificationService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M770.654296875,305.6464137522229L791.666015625,310.8720114601858C812.677734375,316.0976091681486,854.701171875,326.5488045840743,875.712890625,335.94106895870385C896.724609375,345.3333333333333,896.724609375,353.6666666666667,896.724609375,357.8333333333333L896.724609375,362","markerEnd":"url(#arrowhead49)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead49","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WebServer","LE-SearchAPI"],"id":"L-WebServer-SearchAPI","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M532.109375,120.979851241737L472.4453125,127.48320936811416C412.78125,133.9865674944913,293.453125,146.99328374724567,233.7890625,160.87164187362285C174.125,174.75,174.125,189.5,174.125,204.25C174.125,219,174.125,233.75,174.125,245.29166666666666C174.125,256.8333333333333,174.125,265.1666666666667,174.125,269.3333333333333L174.125,273.5","markerEnd":"url(#arrowhead50)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead50","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-ReadAPI","LE-MySQL"],"id":"L-ReadAPI-MySQL","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M618.8515625,212.18710853827173L648.4078776041666,218.23925711522645C677.9641927083334,224.29140569218114,737.0768229166666,236.3957028460906,772.7304926583098,246.61451808971196C808.384162399953,256.8333333333333,820.5788716749058,265.1666666666667,826.6762263123824,269.3333333333333L832.7735809498588,273.5","markerEnd":"url(#arrowhead51)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead51","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WriteAPI","LE-MySQL"],"id":"L-WriteAPI-MySQL","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M827.2198424258474,223.5L834.5070952507062,227.66666666666666C841.7943480755649,231.83333333333334,856.3688537252825,240.16666666666666,862.714486964454,248.5C869.0601202036252,256.8333333333333,867.1768810322504,265.1666666666667,866.2352614465631,269.3333333333333L865.2936418608757,273.5","markerEnd":"url(#arrowhead52)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead52","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-OSS"],"id":"L-FansService-OSS","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M666.943359375,308.81901055914216L651.7864583333334,313.51584213261845C636.6295572916666,318.2126737060948,606.3157552083334,327.60633685304737,591.1588541666666,336.46983509319034C576.001953125,345.3333333333333,576.001953125,353.6666666666667,576.001953125,357.8333333333333L576.001953125,362","markerEnd":"url(#arrowhead53)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead53","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabels"]},"children":[{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-Client-WebServer","className":["edgeLabel","L-LS-Client'","L-LE-WebServer"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WebServer-WriteAPI","className":["edgeLabel","L-LS-WebServer'","L-LE-WriteAPI"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WebServer-ReadAPI","className":["edgeLabel","L-LS-WebServer'","L-LE-ReadAPI"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-ReadAPI-TimeLineService","className":["edgeLabel","L-LS-ReadAPI'","L-LE-TimeLineService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-TimeLineService-WeiboInfoService","className":["edgeLabel","L-LS-TimeLineService'","L-LE-WeiboInfoService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-TimeLineService-UserInfoService","className":["edgeLabel","L-LS-TimeLineService'","L-LE-UserInfoService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-TimeLineService-MemoryCache","className":["edgeLabel","L-LS-TimeLineService'","L-LE-MemoryCache"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WriteAPI-FansService","className":["edgeLabel","L-LS-WriteAPI'","L-LE-FansService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-MemoryCache","className":["edgeLabel","L-LS-FansService'","L-LE-MemoryCache"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-UserGraphService","className":["edgeLabel","L-LS-FansService'","L-LE-UserGraphService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-SearchService","className":["edgeLabel","L-LS-FansService'","L-LE-SearchService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-SearchAPI-SearchService","className":["edgeLabel","L-LS-SearchAPI'","L-LE-SearchService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-NotificationService","className":["edgeLabel","L-LS-FansService'","L-LE-NotificationService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WebServer-SearchAPI","className":["edgeLabel","L-LS-WebServer'","L-LE-SearchAPI"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-ReadAPI-MySQL","className":["edgeLabel","L-LS-ReadAPI'","L-LE-MySQL"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WriteAPI-MySQL","className":["edgeLabel","L-LS-WriteAPI'","L-LE-MySQL"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-OSS","className":["edgeLabel","L-LS-FansService'","L-LE-OSS"]},"children":[]}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["nodes"]},"children":[{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-Client-34","transform":"translate(580.08984375,27.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-31.33203125","y":"-19.25","width":"62.6640625","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-21.33203125,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"42.6640625","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"Client"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-WebServer-35","transform":"translate(580.08984375,115.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-47.98046875","y":"-19.25","width":"95.9609375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-37.98046875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"75.9609375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"WebServer"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-WriteAPI-37","transform":"translate(793.552734375,204.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-40.74609375","y":"-19.25","width":"81.4921875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-30.74609375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"61.4921875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"WriteAPI"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-ReadAPI-39","transform":"translate(580.08984375,204.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-38.76171875","y":"-19.25","width":"77.5234375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-28.76171875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"57.5234375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"ReadAPI"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-TimeLineService-41","transform":"translate(431.380859375,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-68.5078125","y":"-19.25","width":"137.015625","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-58.5078125,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"117.015625","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"TimeLineService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-WeiboInfoService-43","transform":"translate(431.380859375,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-71.53515625","y":"-19.25","width":"143.0703125","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-61.53515625,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"123.0703125","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"WeiboInfoService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-UserInfoService-45","transform":"translate(73.58984375,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-65.58984375","y":"-19.25","width":"131.1796875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-55.58984375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"111.1796875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"UserInfoService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-MemoryCache-47","transform":"translate(708.798828125,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-59.7109375","y":"-19.25","width":"119.421875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-49.7109375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"99.421875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"MemoryCache"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-FansService-49","transform":"translate(718.798828125,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-51.85546875","y":"-19.25","width":"103.7109375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-41.85546875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"83.7109375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"FansService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-UserGraphService-53","transform":"translate(1098.232421875,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-73.29296875","y":"-19.25","width":"146.5859375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-63.29296875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"126.5859375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"UserGraphService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-SearchService-55","transform":"translate(248.87890625,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-59.69921875","y":"-19.25","width":"119.3984375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-49.69921875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"99.3984375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"SearchService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-SearchAPI-56","transform":"translate(174.125,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-45.26171875","y":"-19.25","width":"90.5234375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-35.26171875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"70.5234375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"SearchAPI"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-NotificationService-59","transform":"translate(896.724609375,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-78.21484375","y":"-19.25","width":"156.4296875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-68.21484375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"136.4296875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"NotificationService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-MySQL-63","transform":"translate(860.943359375,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-32.92578125","y":"-19.25","width":"65.8515625","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-22.92578125,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"45.8515625","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"MySQL"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-OSS-67","transform":"translate(576.001953125,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-23.0859375","y":"-19.25","width":"46.171875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-13.0859375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"26.171875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"OSS"}]}]}]}]}]}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"设计核心组件"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例: 用户发表了一篇微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们可以简单的先将数据存储到MySQL中。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查看当前用户的关注的人发的微博以及推送数据是非常麻烦的事情。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"根据预估容量，每秒大概会产生6万条数据，这个操作一般的关系型数据库可能会支撑不住，因此可以通过NoSQL数据库或者内存数据库来对数据进行存储。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"而且对于微博架构这种，大V发送了微博远比普通的用户发送的微博带来的影响大，会造成数据的倾斜。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"一般情况下处理这种情况下会采用推拉结合的模式来进行处理:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"推模式"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果用户被关注的人少，发送了微博，就直接将微博发送到各个人的收件箱中"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"拉模式"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果用户被关注的人多，发送了微博就存储在自己的发件箱里，关注的人拉取自己的关注的人时在对关注的人的发件箱和自己的收件箱进行一个聚合"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"处了数据模型，还需要对静态文件进行一个处理，可以借助于三方的对象存储来存储照片和视频之类的媒体文件。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向应用反向代理的"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发送一条微博"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"服务器将微博使用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"存储于用户收件箱"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"调用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"消息输出服务"}]},{"type":"text","value":" ，进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户服务"}]},{"type":"text","value":"找到存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中的此用户的粉丝"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将微博存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中的"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"此用户的粉丝的主页TimeLine"}]},{"type":"text","value":"中"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"O(n) 复杂度操作： 1000 名粉丝 = 1000 次查找与插入"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将微博数据存储在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索索引服务"}]},{"type":"text","value":"中，以加快搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将媒体存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"对象存储"}]},{"type":"text","value":"中"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"通知服务"}]},{"type":"text","value":"向粉丝发送推送："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"队列"}]},{"type":"text","value":"异步推送通知"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户浏览聚合主页时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发起一次读取主页的请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器调用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"TimeLine服务"}]},{"type":"text","value":"进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"读取时间轴数据，其中包括微博id 与用户 id - O(1)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"通过 "},{"type":"element","tagName":"a","properties":{"href":"http://redis.io/commands/mget"},"children":[{"type":"text","value":"multiget"}]},{"type":"text","value":" 向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"微博信息服务"}]},{"type":"text","value":"进行查询，以获取相关 id 微博的额外信息 - O(n)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"通过 muiltiget 向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户信息服务"}]},{"type":"text","value":"进行查询，以获取相关 id 用户的额外信息 - O(n)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户浏览用户时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发起获得用户时间线的请求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"从 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"中取出用户的TimeLine"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户搜索关键词"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"将搜索请求发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索 API"}]},{"type":"text","value":"调用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索服务"}]},{"type":"text","value":"进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对输入进行转换与分词，弄明白需要搜索什么东西"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"移除标点等额外内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"将文本打散为词组"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"修正拼写错误"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"规范字母大小写"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"将查询转换为布尔操作"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索集群"}]},{"type":"text","value":" （例如Lucene、ES）检索结果："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"对集群内的所有服务器进行查询，将有结果的查询进行聚合（Scatter gathers）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"合并取到的条目，进行评分与排序，最终返回结果"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"架构扩展"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"消息发送服务"}]},{"type":"text","value":"有可能成为性能瓶颈。那些有着百万数量关注着的用户可能发一条微博就需要好几分钟才能完成消息的发送进程。这有可能使 @回复 这种微博时出现竞争条件，因此需要根据服务时间进行重排序来降低影响。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们还可以避免从高关注量的用户输出。相反，我们可以通过搜索来找到高关注量用户的微博，并将搜索结果与用户的主页时间轴合并，再根据时间对其进行排序。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"此外，还可以通过以下内容进行优化："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅为每个主页时间轴在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中存储数百条数据"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中存储活动用户的主页时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果某个用户在过去 30 天都没有产生活动，那我们可以使用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"重新构建他的时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户服务"}]},{"type":"text","value":"来查询并确定用户关注的人"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"中取出推特，并将它们存入"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"微博信息服务"}]},{"type":"text","value":"中存储一个月的推特"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户信息服务"}]},{"type":"text","value":"中存储活动用户的信息"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索集群"}]},{"type":"text","value":"需要将推特保留在内存中，以降低延迟"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们还可以考虑优化 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 来解决一些瓶颈问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"能减小一些数据库的负载，靠 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL Read 副本"}]},{"type":"text","value":"已经足够处理缓存未命中情况。我们还可以考虑使用一些额外的 SQL 性能拓展技术。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"高容量的写入将淹没单个的 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 写主从"}]},{"type":"text","value":"模式，因此需要更多的拓展技术。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"除此之外，还需要对热点事件造成的流量突增进行处理。可以采用容器化进行部署，流量或者负载达到一定程度就扩容。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}},"html":"<h1 id=\"微博架构设计\">微博架构设计</h1>\n<p updated=\"20220705131435\">微博日活跃用户1.6亿+，每日访问量达百亿级，面对庞大用户群的海量访问，需要有良好的架构设计来支撑微博这庞大的访问量。</p>\n<h1 id=\"概述用例和约束\">概述用例和约束</h1>\n<h2 id=\"用例\">用例</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-x11cdi1\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>发布了一条微博</p>\n<p updated=\"20220705131435\"><strong>服务</strong>将微博推送给关注者，并且进行手机推送</p>\n</li>\n<li id=\"20220705131435-pqdsy25\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>浏览自己的微博列表</p>\n</li>\n<li id=\"20220705131435-bqi25wp\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>浏览主页的微博列表（聚合关注的人的微博）</p>\n</li>\n<li id=\"20220705131435-qhaa87d\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>可以通过关键词搜索</p>\n</li>\n<li id=\"20220705131435-ki8k6tk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>服务</strong>应该具有高可用性</p>\n</li>\n</ul>\n<h2 id=\"限制条件与假设\">限制条件与假设</h2>\n<p updated=\"20220705131435\">普遍情况</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-stnxwsl\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">网络流量不是均匀分布的</p>\n</li>\n<li id=\"20220705131435-nf9ribn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">发布微博的速度需要足够快速</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-sw26qpp\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">除非有上百万的关注者，否则将微博推送给粉丝的速度要足够快</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-c6oroyq\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">1 亿个活跃用户</p>\n</li>\n<li id=\"20220705131435-ao5q3c3\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每天新发布 5 亿条微博，每月新发布 150 亿条微博</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-mi8wsoy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">平均每条微博需要推送给 5 个人</p>\n</li>\n<li id=\"20220705131435-stz7bsz\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每天需要进行 50 亿次推送</p>\n</li>\n<li id=\"20220705131435-cvn4fbf\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月需要进行 1500 亿次推送</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-2qhvqc4\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月需要处理 2500 亿次读取请求</p>\n</li>\n<li id=\"20220705131435-nxrd4ko\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月需要处理 100 亿次搜索</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">浏览功能</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-7ihmnnt\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">浏览的速度需要足够快</p>\n</li>\n<li id=\"20220705131435-j4drizs\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">读取的负载远大于写入的负载</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">搜索功能</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-b3tl0zk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">搜索的速度需要足够快</p>\n</li>\n<li id=\"20220705131435-3o1421s\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">搜索是高负载的读取功能</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">计算用量</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ge3kayv\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每条微博的大小：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-1k9xm0h\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>weibo_id</code> - 8 字节</p>\n</li>\n<li id=\"20220705131435-67wyvze\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>user_id</code> - 32 字节</p>\n</li>\n<li id=\"20220705131435-ihhj09x\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>text</code> - 140 字节</p>\n</li>\n<li id=\"20220705131435-ft8a70q\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>media</code> - 平均 10 KB</p>\n</li>\n<li id=\"20220705131435-h6dpt0k\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">总计： 大约 10 KB</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-pkviu0t\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月产生新微博的内容为 150 TB</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-nii2mp5\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每条微博 10 KB * 每天 5 亿条微博* 每月 30 天</p>\n</li>\n<li id=\"20220705131435-2k66jgj\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">3 年产生的内容为 5.4 PB</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-smjtjsd\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒需要处理 10 万次读取请求</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-102nx8u\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每个月需要处理 2500 亿次请求 * (每秒 400 次请求 / 每月 10 亿次请求)</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-5i6vq3d\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒发布 6000 条微博</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-90nipsc\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月发布 150 亿条微博 * (每秒 400 次请求 / 每月 10 次请求)</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-y52jecl\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒推送 6 万条微博</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-7a2ejfo\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月推送 1500 亿条微博 * (每秒 400 次请求 / 每月 10 亿次请求)</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-ag5hjnn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒 4000 次搜索请求</p>\n</li>\n</ul>\n<h1 id=\"概要设计\">概要设计</h1>\n<div data-content=\"graph TD;\n\tClient--&amp;gt;WebServer;\n\tWebServer--&amp;gt;WriteAPI;\n\tWebServer--&amp;gt;ReadAPI;\n\tReadAPI--&amp;gt;TimeLineService;\n\tTimeLineService--&amp;gt;WeiboInfoService;\n\tTimeLineService--&amp;gt;UserInfoService;\n\tTimeLineService--&amp;gt;MemoryCache;\n\tWriteAPI--&amp;gt;FansService;\n\tFansService--&amp;gt;MemoryCache;\n\tFansService--&amp;gt;UserGraphService;\n\tFansService--&amp;gt;SearchService;\n\tSearchAPI--&amp;gt;SearchService;\n\tFansService--&amp;gt;NotificationService;\n\tWebServer--&amp;gt;SearchAPI;\n\tReadAPI--&amp;gt;MySQL;\n\tWriteAPI--&amp;gt;MySQL;\n\tFansService--&amp;gt;OSS;\" data-subtype=\"mermaid\"><div spin=\"1\"></div></div>\n<h1 id=\"设计核心组件\">设计核心组件</h1>\n<h2 id=\"用例--用户发表了一篇微博\">用例: 用户发表了一篇微博</h2>\n<p updated=\"20220705131435\">我们可以简单的先将数据存储到MySQL中。</p>\n<p updated=\"20220705131435\">查看当前用户的关注的人发的微博以及推送数据是非常麻烦的事情。</p>\n<p updated=\"20220705131435\">根据预估容量，每秒大概会产生6万条数据，这个操作一般的关系型数据库可能会支撑不住，因此可以通过NoSQL数据库或者内存数据库来对数据进行存储。</p>\n<p updated=\"20220705131435\">而且对于微博架构这种，大V发送了微博远比普通的用户发送的微博带来的影响大，会造成数据的倾斜。</p>\n<p updated=\"20220705131435\">一般情况下处理这种情况下会采用推拉结合的模式来进行处理:</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ukjsh2w\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">推模式</p>\n<p updated=\"20220705131435\">如果用户被关注的人少，发送了微博，就直接将微博发送到各个人的收件箱中</p>\n</li>\n<li id=\"20220705131435-w0aingf\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">拉模式</p>\n<p updated=\"20220705131435\">如果用户被关注的人多，发送了微博就存储在自己的发件箱里，关注的人拉取自己的关注的人时在对关注的人的发件箱和自己的收件箱进行一个聚合</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">处了数据模型，还需要对静态文件进行一个处理，可以借助于三方的对象存储来存储照片和视频之类的媒体文件。</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ro3m6au\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>向应用反向代理的<strong>Web 服务器</strong>发送一条微博</p>\n</li>\n<li id=\"20220705131435-41hhiq7\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>写 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-vz2xzw2\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>写 API</strong>服务器将微博使用 <strong>SQL 数据库</strong>存储于用户收件箱</p>\n</li>\n<li id=\"20220705131435-hz553ic\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>写 API</strong>调用 <strong>消息输出服务</strong> ，进行以下操作：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-a76atvy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">查询<strong>用户服务</strong>找到存储于<strong>内存缓存</strong>中的此用户的粉丝</p>\n</li>\n<li id=\"20220705131435-rk9s50c\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将微博存储于<strong>内存缓存</strong>中的<strong>此用户的粉丝的主页TimeLine</strong>中</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-mlvsfpm\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">O(n) 复杂度操作： 1000 名粉丝 = 1000 次查找与插入</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-pwq1z8c\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将微博数据存储在<strong>搜索索引服务</strong>中，以加快搜索</p>\n</li>\n<li id=\"20220705131435-e5jymuy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将媒体存储于<strong>对象存储</strong>中</p>\n</li>\n<li id=\"20220705131435-uruf6cn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">使用<strong>通知服务</strong>向粉丝发送推送：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-yvqnbcp\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">使用<strong>队列</strong>异步推送通知</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用例-用户浏览聚合主页时间轴\">用例：用户浏览聚合主页时间轴</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-3jw9sr3\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>向 <strong>Web 服务器</strong>发起一次读取主页的请求</p>\n</li>\n<li id=\"20220705131435-8hinrlm\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>读取 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-m5ahq0x\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>读取 API</strong>服务器调用<strong>TimeLine服务</strong>进行以下操作：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-02925xg\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">从<strong>内存缓存</strong>读取时间轴数据，其中包括微博id 与用户 id - O(1)</p>\n</li>\n<li id=\"20220705131435-woqcn8e\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">通过 <a href=\"http://redis.io/commands/mget\">multiget</a> 向<strong>微博信息服务</strong>进行查询，以获取相关 id 微博的额外信息 - O(n)</p>\n</li>\n<li id=\"20220705131435-cdv0ami\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">通过 muiltiget 向<strong>用户信息服务</strong>进行查询，以获取相关 id 用户的额外信息 - O(n)</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用例-用户浏览用户时间轴\">用例：用户浏览用户时间轴</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-50muszy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>向<strong>Web 服务器</strong>发起获得用户时间线的请求</p>\n</li>\n<li id=\"20220705131435-h3ntxr2\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>读取 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-7vrtpm9\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>读取 API</strong>从 <strong>SQL 数据库</strong>中取出用户的TimeLine</p>\n</li>\n</ul>\n<h2 id=\"用例-用户搜索关键词\">用例：用户搜索关键词</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-n9mzvq3\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>将搜索请求发给<strong>Web 服务器</strong></p>\n</li>\n<li id=\"20220705131435-nlay1bm\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>搜索 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-d8mcgok\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>搜索 API</strong>调用<strong>搜索服务</strong>进行以下操作：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-dm2g4hk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">对输入进行转换与分词，弄明白需要搜索什么东西</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ywcyp9m\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">移除标点等额外内容</p>\n</li>\n<li id=\"20220705131435-s209ksq\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将文本打散为词组</p>\n</li>\n<li id=\"20220705131435-6iks5q7\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">修正拼写错误</p>\n</li>\n<li id=\"20220705131435-39bq57t\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">规范字母大小写</p>\n</li>\n<li id=\"20220705131435-aadyhtk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将查询转换为布尔操作</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-pgk515r\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">查询 <strong>搜索集群</strong> （例如Lucene、ES）检索结果：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-cuh3ghn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">对集群内的所有服务器进行查询，将有结果的查询进行聚合（Scatter gathers）</p>\n</li>\n<li id=\"20220705131435-zlwp3as\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">合并取到的条目，进行评分与排序，最终返回结果</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"架构扩展\">架构扩展</h1>\n<p updated=\"20220705131435\"><strong>消息发送服务</strong>有可能成为性能瓶颈。那些有着百万数量关注着的用户可能发一条微博就需要好几分钟才能完成消息的发送进程。这有可能使 @回复 这种微博时出现竞争条件，因此需要根据服务时间进行重排序来降低影响。</p>\n<p updated=\"20220705131435\">我们还可以避免从高关注量的用户输出。相反，我们可以通过搜索来找到高关注量用户的微博，并将搜索结果与用户的主页时间轴合并，再根据时间对其进行排序。</p>\n<p updated=\"20220705131435\">此外，还可以通过以下内容进行优化：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-h6ac8sf\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅为每个主页时间轴在<strong>内存缓存</strong>中存储数百条数据</p>\n</li>\n<li id=\"20220705131435-vferyin\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅在<strong>内存缓存</strong>中存储活动用户的主页时间轴</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-i0fvj5r\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">如果某个用户在过去 30 天都没有产生活动，那我们可以使用 <strong>SQL 数据库</strong>重新构建他的时间轴</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-vxvkukl\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">使用<strong>用户服务</strong>来查询并确定用户关注的人</p>\n</li>\n<li id=\"20220705131435-mst4pkj\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">从 <strong>SQL 数据库</strong>中取出推特，并将它们存入<strong>内存缓存</strong></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-owwsq62\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅在<strong>微博信息服务</strong>中存储一个月的推特</p>\n</li>\n<li id=\"20220705131435-eenrgsn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅在<strong>用户信息服务</strong>中存储活动用户的信息</p>\n</li>\n<li id=\"20220705131435-x8o7qob\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>搜索集群</strong>需要将推特保留在内存中，以降低延迟</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">我们还可以考虑优化 <strong>SQL 数据库</strong> 来解决一些瓶颈问题。</p>\n<p updated=\"20220705131435\"><strong>内存缓存</strong>能减小一些数据库的负载，靠 <strong>SQL Read 副本</strong>已经足够处理缓存未命中情况。我们还可以考虑使用一些额外的 SQL 性能拓展技术。</p>\n<p updated=\"20220705131435\">高容量的写入将淹没单个的 <strong>SQL 写主从</strong>模式，因此需要更多的拓展技术。</p>\n<p updated=\"20220705131435\">除此之外，还需要对热点事件造成的流量突增进行处理。可以采用容器化进行部署，流量或者负载达到一定程度就扩容。</p>\n","articleNode":{"field":{"contentType":"topic","topic":"系统设计"},"frontmatter":{"id":"/topic/系统设计/样例/微博架构设计","title":"微博架构设计","date":"2022-05-24 14:00","absolute_path":"/topic/系统设计/样例/微博架构设计"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"微博架构设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"微博日活跃用户1.6亿+，每日访问量达百亿级，面对庞大用户群的海量访问，需要有良好的架构设计来支撑微博这庞大的访问量。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概述用例和约束"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"发布了一条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"服务"}]},{"type":"text","value":"将微博推送给关注者，并且进行手机推送"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"浏览自己的微博列表"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"浏览主页的微博列表（聚合关注的人的微博）"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户"}]},{"type":"text","value":"可以通过关键词搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"服务"}]},{"type":"text","value":"应该具有高可用性"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"限制条件与假设"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"普遍情况"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"网络流量不是均匀分布的"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"发布微博的速度需要足够快速"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"除非有上百万的关注者，否则将微博推送给粉丝的速度要足够快"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1 亿个活跃用户"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每天新发布 5 亿条微博，每月新发布 150 亿条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"平均每条微博需要推送给 5 个人"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每天需要进行 50 亿次推送"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月需要进行 1500 亿次推送"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月需要处理 2500 亿次读取请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月需要处理 100 亿次搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"浏览功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"浏览的速度需要足够快"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"读取的负载远大于写入的负载"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索功能"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索的速度需要足够快"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"搜索是高负载的读取功能"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"计算用量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每条微博的大小："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"weibo_id"}]},{"type":"text","value":" - 8 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"user_id"}]},{"type":"text","value":" - 32 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"text"}]},{"type":"text","value":" - 140 字节"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"media"}]},{"type":"text","value":" - 平均 10 KB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"总计： 大约 10 KB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每月产生新微博的内容为 150 TB"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每条微博 10 KB * 每天 5 亿条微博* 每月 30 天"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"3 年产生的内容为 5.4 PB"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒需要处理 10 万次读取请求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每个月需要处理 2500 亿次请求 * (每秒 400 次请求 / 每月 10 亿次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒发布 6000 条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月发布 150 亿条微博 * (每秒 400 次请求 / 每月 10 次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒推送 6 万条微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"每月推送 1500 亿条微博 * (每秒 400 次请求 / 每月 10 亿次请求)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每秒 4000 次搜索请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"概要设计"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["mermaid"],"dataProcessed":"true"},"children":[{"type":"element","tagName":"svg","properties":{"id":"mermaid-1656998103768","width":"100%","xmlns":"http://www.w3.org/2000/svg","xmlnsXLink":"http://www.w3.org/1999/xlink","height":"408.5","style":"max-width: 1179.525390625px;","viewBox":"0 0 1179.525390625 408.5"},"children":[{"type":"element","tagName":"style","properties":{},"children":[{"type":"text","value":"#mermaid-1656998103768 {font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1656998103768 .error-icon{fill:#552222;}#mermaid-1656998103768 .error-text{fill:#552222;stroke:#552222;}#mermaid-1656998103768 .edge-thickness-normal{stroke-width:2px;}#mermaid-1656998103768 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1656998103768 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1656998103768 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1656998103768 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1656998103768 .marker{fill:#333333;stroke:#333333;}#mermaid-1656998103768 .marker.cross{stroke:#333333;}#mermaid-1656998103768 svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-1656998103768 .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-1656998103768 .cluster-label text{fill:#333;}#mermaid-1656998103768 .cluster-label span{color:#333;}#mermaid-1656998103768 .label text,#mermaid-1656998103768 span{fill:#333;color:#333;}#mermaid-1656998103768 .node rect,#mermaid-1656998103768 .node circle,#mermaid-1656998103768 .node ellipse,#mermaid-1656998103768 .node polygon,#mermaid-1656998103768 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1656998103768 .node .label{text-align:center;}#mermaid-1656998103768 .node.clickable{cursor:pointer;}#mermaid-1656998103768 .arrowheadPath{fill:#333333;}#mermaid-1656998103768 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1656998103768 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1656998103768 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1656998103768 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1656998103768 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1656998103768 .cluster text{fill:#333;}#mermaid-1656998103768 .cluster span{color:#333;}#mermaid-1656998103768 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1656998103768 :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}"}]},{"type":"element","tagName":"g","properties":{},"children":[{"type":"element","tagName":"g","properties":{"className":["output"]},"children":[{"type":"element","tagName":"g","properties":{"className":["clusters"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["edgePaths"]},"children":[{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-Client","LE-WebServer"],"id":"L-Client-WebServer","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M580.08984375,46.5L580.08984375,50.666666666666664C580.08984375,54.833333333333336,580.08984375,63.166666666666664,580.08984375,71.5C580.08984375,79.83333333333333,580.08984375,88.16666666666667,580.08984375,92.33333333333333L580.08984375,96.5","markerEnd":"url(#arrowhead37)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead37","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WebServer","LE-WriteAPI"],"id":"L-WebServer-WriteAPI","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M628.0703125,125.6961584913947L655.6507161458334,131.4134654094956C683.2311197916666,137.13077232759647,738.3919270833334,148.56538616379825,765.9723307291666,158.4493597485658C793.552734375,168.33333333333334,793.552734375,176.66666666666666,793.552734375,180.83333333333334L793.552734375,185","markerEnd":"url(#arrowhead38)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead38","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WebServer","LE-ReadAPI"],"id":"L-WebServer-ReadAPI","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M580.08984375,135L580.08984375,139.16666666666666C580.08984375,143.33333333333334,580.08984375,151.66666666666666,580.08984375,160C580.08984375,168.33333333333334,580.08984375,176.66666666666666,580.08984375,180.83333333333334L580.08984375,185","markerEnd":"url(#arrowhead39)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead39","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-ReadAPI","LE-TimeLineService"],"id":"L-ReadAPI-TimeLineService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M541.328125,215.78397733093422L523.0035807291666,221.2366477757785C504.6790364583333,226.68931822062282,468.0299479166667,237.59465911031143,449.7054036458333,247.21399622182238C431.380859375,256.8333333333333,431.380859375,265.1666666666667,431.380859375,269.3333333333333L431.380859375,273.5","markerEnd":"url(#arrowhead40)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead40","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-TimeLineService","LE-WeiboInfoService"],"id":"L-TimeLineService-WeiboInfoService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M431.380859375,312L431.380859375,316.1666666666667C431.380859375,320.3333333333333,431.380859375,328.6666666666667,431.380859375,337C431.380859375,345.3333333333333,431.380859375,353.6666666666667,431.380859375,357.8333333333333L431.380859375,362","markerEnd":"url(#arrowhead41)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead41","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-TimeLineService","LE-UserInfoService"],"id":"L-TimeLineService-UserInfoService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M362.873046875,301.22274126721584L314.6591796875,307.18561772267986C266.4453125,313.1484941781439,170.017578125,325.07424708907195,121.8037109375,335.20379021120266C73.58984375,345.3333333333333,73.58984375,353.6666666666667,73.58984375,357.8333333333333L73.58984375,362","markerEnd":"url(#arrowhead42)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead42","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-TimeLineService","LE-MemoryCache"],"id":"L-TimeLineService-MemoryCache","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M499.888671875,306.4658498435871L525.3072916666666,311.55487486965586C550.7259114583334,316.6438998957247,601.5631510416666,326.8219499478624,632.2923581685499,336.07764164059785C663.0215652954331,345.3333333333333,673.6427399658663,353.6666666666667,678.9533273010828,357.8333333333333L684.2639146362994,362","markerEnd":"url(#arrowhead43)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead43","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WriteAPI","LE-FansService"],"id":"L-WriteAPI-FansService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M761.0326734639831,223.5L753.9936992408193,227.66666666666666C746.9547250176553,231.83333333333334,732.8767765713277,240.16666666666666,725.8378023481638,248.5C718.798828125,256.8333333333333,718.798828125,265.1666666666667,718.798828125,269.3333333333333L718.798828125,273.5","markerEnd":"url(#arrowhead44)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead44","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-MemoryCache"],"id":"L-FansService-MemoryCache","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M718.798828125,312L718.798828125,316.1666666666667C718.798828125,320.3333333333333,718.798828125,328.6666666666667,717.8572085393126,337C716.9155889536252,345.3333333333333,715.0323497822504,353.6666666666667,714.0907301965631,357.8333333333333L713.1491106108757,362","markerEnd":"url(#arrowhead45)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead45","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-UserGraphService"],"id":"L-FansService-UserGraphService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M770.654296875,298.79744685231896L825.2506510416666,305.1645390435991C879.8470052083334,311.5316312348793,989.0397135416666,324.2658156174396,1043.6360677083333,334.79957447538646C1098.232421875,345.3333333333333,1098.232421875,353.6666666666667,1098.232421875,357.8333333333333L1098.232421875,362","markerEnd":"url(#arrowhead46)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead46","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-SearchService"],"id":"L-FansService-SearchService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M666.943359375,296.9405651089876L584.3251953125,303.617137590823C501.70703125,310.29371007265837,336.470703125,323.6468550363292,261.1637001971516,334.49009418483126C185.85669726930323,345.3333333333333,200.4790195386064,353.6666666666667,207.790180673258,357.8333333333333L215.1013418079096,362","markerEnd":"url(#arrowhead47)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead47","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-SearchAPI","LE-SearchService"],"id":"L-SearchAPI-SearchService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M210.99534339689265,312L218.9759372057439,316.1666666666667C226.95653101459507,320.3333333333333,242.91771863229755,328.6666666666667,249.95669285546137,337C256.9956670786252,345.3333333333333,255.11242790725046,353.6666666666667,254.17080832156307,357.8333333333333L253.2291887358757,362","markerEnd":"url(#arrowhead48)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead48","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-NotificationService"],"id":"L-FansService-NotificationService","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M770.654296875,305.6464137522229L791.666015625,310.8720114601858C812.677734375,316.0976091681486,854.701171875,326.5488045840743,875.712890625,335.94106895870385C896.724609375,345.3333333333333,896.724609375,353.6666666666667,896.724609375,357.8333333333333L896.724609375,362","markerEnd":"url(#arrowhead49)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead49","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WebServer","LE-SearchAPI"],"id":"L-WebServer-SearchAPI","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M532.109375,120.979851241737L472.4453125,127.48320936811416C412.78125,133.9865674944913,293.453125,146.99328374724567,233.7890625,160.87164187362285C174.125,174.75,174.125,189.5,174.125,204.25C174.125,219,174.125,233.75,174.125,245.29166666666666C174.125,256.8333333333333,174.125,265.1666666666667,174.125,269.3333333333333L174.125,273.5","markerEnd":"url(#arrowhead50)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead50","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-ReadAPI","LE-MySQL"],"id":"L-ReadAPI-MySQL","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M618.8515625,212.18710853827173L648.4078776041666,218.23925711522645C677.9641927083334,224.29140569218114,737.0768229166666,236.3957028460906,772.7304926583098,246.61451808971196C808.384162399953,256.8333333333333,820.5788716749058,265.1666666666667,826.6762263123824,269.3333333333333L832.7735809498588,273.5","markerEnd":"url(#arrowhead51)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead51","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-WriteAPI","LE-MySQL"],"id":"L-WriteAPI-MySQL","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M827.2198424258474,223.5L834.5070952507062,227.66666666666666C841.7943480755649,231.83333333333334,856.3688537252825,240.16666666666666,862.714486964454,248.5C869.0601202036252,256.8333333333333,867.1768810322504,265.1666666666667,866.2352614465631,269.3333333333333L865.2936418608757,273.5","markerEnd":"url(#arrowhead52)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead52","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgePath","LS-FansService","LE-OSS"],"id":"L-FansService-OSS","style":"opacity: 1;"},"children":[{"type":"element","tagName":"path","properties":{"className":["path"],"d":"M666.943359375,308.81901055914216L651.7864583333334,313.51584213261845C636.6295572916666,318.2126737060948,606.3157552083334,327.60633685304737,591.1588541666666,336.46983509319034C576.001953125,345.3333333333333,576.001953125,353.6666666666667,576.001953125,357.8333333333333L576.001953125,362","markerEnd":"url(#arrowhead53)","style":"fill:none"},"children":[]},{"type":"element","tagName":"defs","properties":{},"children":[{"type":"element","tagName":"marker","properties":{"id":"arrowhead53","viewBox":"0 0 10 10","refX":"9","refY":"5","markerUnits":"strokeWidth","markerWidth":"8","markerHeight":"6","orient":"auto"},"children":[{"type":"element","tagName":"path","properties":{"d":"M 0 0 L 10 5 L 0 10 z","className":["arrowheadPath"],"style":"stroke-width: 1; stroke-dasharray: 1, 0;"},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabels"]},"children":[{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-Client-WebServer","className":["edgeLabel","L-LS-Client'","L-LE-WebServer"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WebServer-WriteAPI","className":["edgeLabel","L-LS-WebServer'","L-LE-WriteAPI"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WebServer-ReadAPI","className":["edgeLabel","L-LS-WebServer'","L-LE-ReadAPI"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-ReadAPI-TimeLineService","className":["edgeLabel","L-LS-ReadAPI'","L-LE-TimeLineService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-TimeLineService-WeiboInfoService","className":["edgeLabel","L-LS-TimeLineService'","L-LE-WeiboInfoService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-TimeLineService-UserInfoService","className":["edgeLabel","L-LS-TimeLineService'","L-LE-UserInfoService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-TimeLineService-MemoryCache","className":["edgeLabel","L-LS-TimeLineService'","L-LE-MemoryCache"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WriteAPI-FansService","className":["edgeLabel","L-LS-WriteAPI'","L-LE-FansService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-MemoryCache","className":["edgeLabel","L-LS-FansService'","L-LE-MemoryCache"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-UserGraphService","className":["edgeLabel","L-LS-FansService'","L-LE-UserGraphService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-SearchService","className":["edgeLabel","L-LS-FansService'","L-LE-SearchService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-SearchAPI-SearchService","className":["edgeLabel","L-LS-SearchAPI'","L-LE-SearchService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-NotificationService","className":["edgeLabel","L-LS-FansService'","L-LE-NotificationService"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WebServer-SearchAPI","className":["edgeLabel","L-LS-WebServer'","L-LE-SearchAPI"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-ReadAPI-MySQL","className":["edgeLabel","L-LS-ReadAPI'","L-LE-MySQL"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-WriteAPI-MySQL","className":["edgeLabel","L-LS-WriteAPI'","L-LE-MySQL"]},"children":[]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["edgeLabel"],"transform":"","style":"opacity: 1;"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(0,0)","className":["label"]},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","width":"0","height":"0"},"children":[]},{"type":"element","tagName":"foreignObject","properties":{"width":"0","height":"0"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"element","tagName":"span","properties":{"id":"L-L-FansService-OSS","className":["edgeLabel","L-LS-FansService'","L-LE-OSS"]},"children":[]}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["nodes"]},"children":[{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-Client-34","transform":"translate(580.08984375,27.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-31.33203125","y":"-19.25","width":"62.6640625","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-21.33203125,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"42.6640625","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"Client"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-WebServer-35","transform":"translate(580.08984375,115.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-47.98046875","y":"-19.25","width":"95.9609375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-37.98046875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"75.9609375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"WebServer"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-WriteAPI-37","transform":"translate(793.552734375,204.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-40.74609375","y":"-19.25","width":"81.4921875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-30.74609375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"61.4921875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"WriteAPI"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-ReadAPI-39","transform":"translate(580.08984375,204.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-38.76171875","y":"-19.25","width":"77.5234375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-28.76171875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"57.5234375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"ReadAPI"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-TimeLineService-41","transform":"translate(431.380859375,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-68.5078125","y":"-19.25","width":"137.015625","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-58.5078125,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"117.015625","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"TimeLineService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-WeiboInfoService-43","transform":"translate(431.380859375,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-71.53515625","y":"-19.25","width":"143.0703125","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-61.53515625,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"123.0703125","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"WeiboInfoService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-UserInfoService-45","transform":"translate(73.58984375,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-65.58984375","y":"-19.25","width":"131.1796875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-55.58984375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"111.1796875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"UserInfoService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-MemoryCache-47","transform":"translate(708.798828125,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-59.7109375","y":"-19.25","width":"119.421875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-49.7109375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"99.421875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"MemoryCache"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-FansService-49","transform":"translate(718.798828125,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-51.85546875","y":"-19.25","width":"103.7109375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-41.85546875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"83.7109375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"FansService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-UserGraphService-53","transform":"translate(1098.232421875,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-73.29296875","y":"-19.25","width":"146.5859375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-63.29296875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"126.5859375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"UserGraphService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-SearchService-55","transform":"translate(248.87890625,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-59.69921875","y":"-19.25","width":"119.3984375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-49.69921875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"99.3984375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"SearchService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-SearchAPI-56","transform":"translate(174.125,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-45.26171875","y":"-19.25","width":"90.5234375","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-35.26171875,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"70.5234375","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"SearchAPI"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-NotificationService-59","transform":"translate(896.724609375,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-78.21484375","y":"-19.25","width":"156.4296875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-68.21484375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"136.4296875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"NotificationService"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-MySQL-63","transform":"translate(860.943359375,292.75)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-32.92578125","y":"-19.25","width":"65.8515625","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-22.92578125,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"45.8515625","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"MySQL"}]}]}]}]}]},{"type":"element","tagName":"g","properties":{"className":["node","default"],"id":"flowchart-OSS-67","transform":"translate(576.001953125,381.25)","style":"opacity: 1;"},"children":[{"type":"element","tagName":"rect","properties":{"rx":"0","ry":"0","x":"-23.0859375","y":"-19.25","width":"46.171875","height":"38.5","className":["label-container"]},"children":[]},{"type":"element","tagName":"g","properties":{"className":["label"],"transform":"translate(0,0)"},"children":[{"type":"element","tagName":"g","properties":{"transform":"translate(-13.0859375,-9.25)"},"children":[{"type":"element","tagName":"foreignObject","properties":{"width":"26.171875","height":"18.5"},"children":[{"type":"element","tagName":"div","properties":{"xmlns":"http://www.w3.org/1999/xhtml","style":"display: inline-block; white-space: nowrap;"},"children":[{"type":"text","value":"OSS"}]}]}]}]}]}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"设计核心组件"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例: 用户发表了一篇微博"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们可以简单的先将数据存储到MySQL中。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查看当前用户的关注的人发的微博以及推送数据是非常麻烦的事情。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"根据预估容量，每秒大概会产生6万条数据，这个操作一般的关系型数据库可能会支撑不住，因此可以通过NoSQL数据库或者内存数据库来对数据进行存储。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"而且对于微博架构这种，大V发送了微博远比普通的用户发送的微博带来的影响大，会造成数据的倾斜。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"一般情况下处理这种情况下会采用推拉结合的模式来进行处理:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"推模式"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果用户被关注的人少，发送了微博，就直接将微博发送到各个人的收件箱中"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"拉模式"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果用户被关注的人多，发送了微博就存储在自己的发件箱里，关注的人拉取自己的关注的人时在对关注的人的发件箱和自己的收件箱进行一个聚合"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"处了数据模型，还需要对静态文件进行一个处理，可以借助于三方的对象存储来存储照片和视频之类的媒体文件。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向应用反向代理的"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发送一条微博"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"服务器将微博使用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"存储于用户收件箱"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"写 API"}]},{"type":"text","value":"调用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"消息输出服务"}]},{"type":"text","value":" ，进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户服务"}]},{"type":"text","value":"找到存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中的此用户的粉丝"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将微博存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中的"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"此用户的粉丝的主页TimeLine"}]},{"type":"text","value":"中"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"O(n) 复杂度操作： 1000 名粉丝 = 1000 次查找与插入"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将微博数据存储在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索索引服务"}]},{"type":"text","value":"中，以加快搜索"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将媒体存储于"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"对象存储"}]},{"type":"text","value":"中"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"通知服务"}]},{"type":"text","value":"向粉丝发送推送："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"队列"}]},{"type":"text","value":"异步推送通知"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户浏览聚合主页时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发起一次读取主页的请求"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器调用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"TimeLine服务"}]},{"type":"text","value":"进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"读取时间轴数据，其中包括微博id 与用户 id - O(1)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"通过 "},{"type":"element","tagName":"a","properties":{"href":"http://redis.io/commands/mget"},"children":[{"type":"text","value":"multiget"}]},{"type":"text","value":" 向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"微博信息服务"}]},{"type":"text","value":"进行查询，以获取相关 id 微博的额外信息 - O(n)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"通过 muiltiget 向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户信息服务"}]},{"type":"text","value":"进行查询，以获取相关 id 用户的额外信息 - O(n)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户浏览用户时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"向"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"发起获得用户时间线的请求"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"读取 API"}]},{"type":"text","value":"从 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"中取出用户的TimeLine"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"用例：用户搜索关键词"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"客户端"}]},{"type":"text","value":"将搜索请求发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Web 服务器"}]},{"type":"text","value":"将请求转发给"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索 API"}]},{"type":"text","value":"服务器"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索 API"}]},{"type":"text","value":"调用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索服务"}]},{"type":"text","value":"进行以下操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"对输入进行转换与分词，弄明白需要搜索什么东西"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"移除标点等额外内容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"将文本打散为词组"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"修正拼写错误"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"规范字母大小写"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"将查询转换为布尔操作"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索集群"}]},{"type":"text","value":" （例如Lucene、ES）检索结果："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"对集群内的所有服务器进行查询，将有结果的查询进行聚合（Scatter gathers）"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"合并取到的条目，进行评分与排序，最终返回结果"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"架构扩展"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"消息发送服务"}]},{"type":"text","value":"有可能成为性能瓶颈。那些有着百万数量关注着的用户可能发一条微博就需要好几分钟才能完成消息的发送进程。这有可能使 @回复 这种微博时出现竞争条件，因此需要根据服务时间进行重排序来降低影响。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们还可以避免从高关注量的用户输出。相反，我们可以通过搜索来找到高关注量用户的微博，并将搜索结果与用户的主页时间轴合并，再根据时间对其进行排序。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"此外，还可以通过以下内容进行优化："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅为每个主页时间轴在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中存储数百条数据"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"中存储活动用户的主页时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果某个用户在过去 30 天都没有产生活动，那我们可以使用 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"重新构建他的时间轴"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户服务"}]},{"type":"text","value":"来查询并确定用户关注的人"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":"中取出推特，并将它们存入"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"微博信息服务"}]},{"type":"text","value":"中存储一个月的推特"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"仅在"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用户信息服务"}]},{"type":"text","value":"中存储活动用户的信息"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"搜索集群"}]},{"type":"text","value":"需要将推特保留在内存中，以降低延迟"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们还可以考虑优化 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 数据库"}]},{"type":"text","value":" 来解决一些瓶颈问题。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"内存缓存"}]},{"type":"text","value":"能减小一些数据库的负载，靠 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL Read 副本"}]},{"type":"text","value":"已经足够处理缓存未命中情况。我们还可以考虑使用一些额外的 SQL 性能拓展技术。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"高容量的写入将淹没单个的 "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"SQL 写主从"}]},{"type":"text","value":"模式，因此需要更多的拓展技术。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"除此之外，还需要对热点事件造成的流量突增进行处理。可以采用容器化进行部署，流量或者负载达到一定程度就扩容。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"style","properties":{"className":["grvsc-styles"]},"children":[{"type":"text","value":"\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n"}]}],"data":{"quirksMode":false}},"html":"<h1 id=\"微博架构设计\">微博架构设计</h1>\n<p updated=\"20220705131435\">微博日活跃用户1.6亿+，每日访问量达百亿级，面对庞大用户群的海量访问，需要有良好的架构设计来支撑微博这庞大的访问量。</p>\n<h1 id=\"概述用例和约束\">概述用例和约束</h1>\n<h2 id=\"用例\">用例</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-x11cdi1\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>发布了一条微博</p>\n<p updated=\"20220705131435\"><strong>服务</strong>将微博推送给关注者，并且进行手机推送</p>\n</li>\n<li id=\"20220705131435-pqdsy25\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>浏览自己的微博列表</p>\n</li>\n<li id=\"20220705131435-bqi25wp\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>浏览主页的微博列表（聚合关注的人的微博）</p>\n</li>\n<li id=\"20220705131435-qhaa87d\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>用户</strong>可以通过关键词搜索</p>\n</li>\n<li id=\"20220705131435-ki8k6tk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>服务</strong>应该具有高可用性</p>\n</li>\n</ul>\n<h2 id=\"限制条件与假设\">限制条件与假设</h2>\n<p updated=\"20220705131435\">普遍情况</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-stnxwsl\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">网络流量不是均匀分布的</p>\n</li>\n<li id=\"20220705131435-nf9ribn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">发布微博的速度需要足够快速</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-sw26qpp\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">除非有上百万的关注者，否则将微博推送给粉丝的速度要足够快</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-c6oroyq\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">1 亿个活跃用户</p>\n</li>\n<li id=\"20220705131435-ao5q3c3\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每天新发布 5 亿条微博，每月新发布 150 亿条微博</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-mi8wsoy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">平均每条微博需要推送给 5 个人</p>\n</li>\n<li id=\"20220705131435-stz7bsz\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每天需要进行 50 亿次推送</p>\n</li>\n<li id=\"20220705131435-cvn4fbf\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月需要进行 1500 亿次推送</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-2qhvqc4\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月需要处理 2500 亿次读取请求</p>\n</li>\n<li id=\"20220705131435-nxrd4ko\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月需要处理 100 亿次搜索</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">浏览功能</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-7ihmnnt\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">浏览的速度需要足够快</p>\n</li>\n<li id=\"20220705131435-j4drizs\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">读取的负载远大于写入的负载</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">搜索功能</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-b3tl0zk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">搜索的速度需要足够快</p>\n</li>\n<li id=\"20220705131435-3o1421s\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">搜索是高负载的读取功能</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">计算用量</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ge3kayv\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每条微博的大小：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-1k9xm0h\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>weibo_id</code> - 8 字节</p>\n</li>\n<li id=\"20220705131435-67wyvze\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>user_id</code> - 32 字节</p>\n</li>\n<li id=\"20220705131435-ihhj09x\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>text</code> - 140 字节</p>\n</li>\n<li id=\"20220705131435-ft8a70q\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><code>media</code> - 平均 10 KB</p>\n</li>\n<li id=\"20220705131435-h6dpt0k\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">总计： 大约 10 KB</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-pkviu0t\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月产生新微博的内容为 150 TB</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-nii2mp5\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每条微博 10 KB * 每天 5 亿条微博* 每月 30 天</p>\n</li>\n<li id=\"20220705131435-2k66jgj\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">3 年产生的内容为 5.4 PB</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-smjtjsd\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒需要处理 10 万次读取请求</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-102nx8u\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每个月需要处理 2500 亿次请求 * (每秒 400 次请求 / 每月 10 亿次请求)</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-5i6vq3d\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒发布 6000 条微博</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-90nipsc\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月发布 150 亿条微博 * (每秒 400 次请求 / 每月 10 次请求)</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-y52jecl\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒推送 6 万条微博</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-7a2ejfo\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每月推送 1500 亿条微博 * (每秒 400 次请求 / 每月 10 亿次请求)</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-ag5hjnn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">每秒 4000 次搜索请求</p>\n</li>\n</ul>\n<h1 id=\"概要设计\">概要设计</h1>\n<div data-content=\"graph TD;\n\tClient--&amp;gt;WebServer;\n\tWebServer--&amp;gt;WriteAPI;\n\tWebServer--&amp;gt;ReadAPI;\n\tReadAPI--&amp;gt;TimeLineService;\n\tTimeLineService--&amp;gt;WeiboInfoService;\n\tTimeLineService--&amp;gt;UserInfoService;\n\tTimeLineService--&amp;gt;MemoryCache;\n\tWriteAPI--&amp;gt;FansService;\n\tFansService--&amp;gt;MemoryCache;\n\tFansService--&amp;gt;UserGraphService;\n\tFansService--&amp;gt;SearchService;\n\tSearchAPI--&amp;gt;SearchService;\n\tFansService--&amp;gt;NotificationService;\n\tWebServer--&amp;gt;SearchAPI;\n\tReadAPI--&amp;gt;MySQL;\n\tWriteAPI--&amp;gt;MySQL;\n\tFansService--&amp;gt;OSS;\" data-subtype=\"mermaid\"><div spin=\"1\"></div></div>\n<h1 id=\"设计核心组件\">设计核心组件</h1>\n<h2 id=\"用例--用户发表了一篇微博\">用例: 用户发表了一篇微博</h2>\n<p updated=\"20220705131435\">我们可以简单的先将数据存储到MySQL中。</p>\n<p updated=\"20220705131435\">查看当前用户的关注的人发的微博以及推送数据是非常麻烦的事情。</p>\n<p updated=\"20220705131435\">根据预估容量，每秒大概会产生6万条数据，这个操作一般的关系型数据库可能会支撑不住，因此可以通过NoSQL数据库或者内存数据库来对数据进行存储。</p>\n<p updated=\"20220705131435\">而且对于微博架构这种，大V发送了微博远比普通的用户发送的微博带来的影响大，会造成数据的倾斜。</p>\n<p updated=\"20220705131435\">一般情况下处理这种情况下会采用推拉结合的模式来进行处理:</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ukjsh2w\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">推模式</p>\n<p updated=\"20220705131435\">如果用户被关注的人少，发送了微博，就直接将微博发送到各个人的收件箱中</p>\n</li>\n<li id=\"20220705131435-w0aingf\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">拉模式</p>\n<p updated=\"20220705131435\">如果用户被关注的人多，发送了微博就存储在自己的发件箱里，关注的人拉取自己的关注的人时在对关注的人的发件箱和自己的收件箱进行一个聚合</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">处了数据模型，还需要对静态文件进行一个处理，可以借助于三方的对象存储来存储照片和视频之类的媒体文件。</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ro3m6au\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>向应用反向代理的<strong>Web 服务器</strong>发送一条微博</p>\n</li>\n<li id=\"20220705131435-41hhiq7\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>写 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-vz2xzw2\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>写 API</strong>服务器将微博使用 <strong>SQL 数据库</strong>存储于用户收件箱</p>\n</li>\n<li id=\"20220705131435-hz553ic\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>写 API</strong>调用 <strong>消息输出服务</strong> ，进行以下操作：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-a76atvy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">查询<strong>用户服务</strong>找到存储于<strong>内存缓存</strong>中的此用户的粉丝</p>\n</li>\n<li id=\"20220705131435-rk9s50c\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将微博存储于<strong>内存缓存</strong>中的<strong>此用户的粉丝的主页TimeLine</strong>中</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-mlvsfpm\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">O(n) 复杂度操作： 1000 名粉丝 = 1000 次查找与插入</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-pwq1z8c\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将微博数据存储在<strong>搜索索引服务</strong>中，以加快搜索</p>\n</li>\n<li id=\"20220705131435-e5jymuy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将媒体存储于<strong>对象存储</strong>中</p>\n</li>\n<li id=\"20220705131435-uruf6cn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">使用<strong>通知服务</strong>向粉丝发送推送：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-yvqnbcp\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">使用<strong>队列</strong>异步推送通知</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用例-用户浏览聚合主页时间轴\">用例：用户浏览聚合主页时间轴</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-3jw9sr3\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>向 <strong>Web 服务器</strong>发起一次读取主页的请求</p>\n</li>\n<li id=\"20220705131435-8hinrlm\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>读取 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-m5ahq0x\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>读取 API</strong>服务器调用<strong>TimeLine服务</strong>进行以下操作：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-02925xg\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">从<strong>内存缓存</strong>读取时间轴数据，其中包括微博id 与用户 id - O(1)</p>\n</li>\n<li id=\"20220705131435-woqcn8e\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">通过 <a href=\"http://redis.io/commands/mget\">multiget</a> 向<strong>微博信息服务</strong>进行查询，以获取相关 id 微博的额外信息 - O(n)</p>\n</li>\n<li id=\"20220705131435-cdv0ami\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">通过 muiltiget 向<strong>用户信息服务</strong>进行查询，以获取相关 id 用户的额外信息 - O(n)</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用例-用户浏览用户时间轴\">用例：用户浏览用户时间轴</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-50muszy\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>向<strong>Web 服务器</strong>发起获得用户时间线的请求</p>\n</li>\n<li id=\"20220705131435-h3ntxr2\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>读取 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-7vrtpm9\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>读取 API</strong>从 <strong>SQL 数据库</strong>中取出用户的TimeLine</p>\n</li>\n</ul>\n<h2 id=\"用例-用户搜索关键词\">用例：用户搜索关键词</h2>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-n9mzvq3\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>客户端</strong>将搜索请求发给<strong>Web 服务器</strong></p>\n</li>\n<li id=\"20220705131435-nlay1bm\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>Web 服务器</strong>将请求转发给<strong>搜索 API</strong>服务器</p>\n</li>\n<li id=\"20220705131435-d8mcgok\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>搜索 API</strong>调用<strong>搜索服务</strong>进行以下操作：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-dm2g4hk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">对输入进行转换与分词，弄明白需要搜索什么东西</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-ywcyp9m\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">移除标点等额外内容</p>\n</li>\n<li id=\"20220705131435-s209ksq\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将文本打散为词组</p>\n</li>\n<li id=\"20220705131435-6iks5q7\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">修正拼写错误</p>\n</li>\n<li id=\"20220705131435-39bq57t\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">规范字母大小写</p>\n</li>\n<li id=\"20220705131435-aadyhtk\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">将查询转换为布尔操作</p>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-pgk515r\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">查询 <strong>搜索集群</strong> （例如Lucene、ES）检索结果：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-cuh3ghn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">对集群内的所有服务器进行查询，将有结果的查询进行聚合（Scatter gathers）</p>\n</li>\n<li id=\"20220705131435-zlwp3as\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">合并取到的条目，进行评分与排序，最终返回结果</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"架构扩展\">架构扩展</h1>\n<p updated=\"20220705131435\"><strong>消息发送服务</strong>有可能成为性能瓶颈。那些有着百万数量关注着的用户可能发一条微博就需要好几分钟才能完成消息的发送进程。这有可能使 @回复 这种微博时出现竞争条件，因此需要根据服务时间进行重排序来降低影响。</p>\n<p updated=\"20220705131435\">我们还可以避免从高关注量的用户输出。相反，我们可以通过搜索来找到高关注量用户的微博，并将搜索结果与用户的主页时间轴合并，再根据时间对其进行排序。</p>\n<p updated=\"20220705131435\">此外，还可以通过以下内容进行优化：</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-h6ac8sf\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅为每个主页时间轴在<strong>内存缓存</strong>中存储数百条数据</p>\n</li>\n<li id=\"20220705131435-vferyin\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅在<strong>内存缓存</strong>中存储活动用户的主页时间轴</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-i0fvj5r\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">如果某个用户在过去 30 天都没有产生活动，那我们可以使用 <strong>SQL 数据库</strong>重新构建他的时间轴</p>\n<ul updated=\"20220705131435\">\n<li id=\"20220705131435-vxvkukl\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">使用<strong>用户服务</strong>来查询并确定用户关注的人</p>\n</li>\n<li id=\"20220705131435-mst4pkj\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">从 <strong>SQL 数据库</strong>中取出推特，并将它们存入<strong>内存缓存</strong></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li id=\"20220705131435-owwsq62\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅在<strong>微博信息服务</strong>中存储一个月的推特</p>\n</li>\n<li id=\"20220705131435-eenrgsn\" updated=\"20220705131435\">\n<p updated=\"20220705131435\">仅在<strong>用户信息服务</strong>中存储活动用户的信息</p>\n</li>\n<li id=\"20220705131435-x8o7qob\" updated=\"20220705131435\">\n<p updated=\"20220705131435\"><strong>搜索集群</strong>需要将推特保留在内存中，以降低延迟</p>\n</li>\n</ul>\n<p updated=\"20220705131435\">我们还可以考虑优化 <strong>SQL 数据库</strong> 来解决一些瓶颈问题。</p>\n<p updated=\"20220705131435\"><strong>内存缓存</strong>能减小一些数据库的负载，靠 <strong>SQL Read 副本</strong>已经足够处理缓存未命中情况。我们还可以考虑使用一些额外的 SQL 性能拓展技术。</p>\n<p updated=\"20220705131435\">高容量的写入将淹没单个的 <strong>SQL 写主从</strong>模式，因此需要更多的拓展技术。</p>\n<p updated=\"20220705131435\">除此之外，还需要对热点事件造成的流量突增进行处理。可以采用容器化进行部署，流量或者负载达到一定程度就扩容。</p>\n","headings":[{"depth":1,"value":"微博架构设计"},{"depth":1,"value":"概述用例和约束"},{"depth":2,"value":"用例"},{"depth":2,"value":"限制条件与假设"},{"depth":1,"value":"概要设计"},{"depth":1,"value":"设计核心组件"},{"depth":2,"value":"用例: 用户发表了一篇微博"},{"depth":2,"value":"用例：用户浏览聚合主页时间轴"},{"depth":2,"value":"用例：用户浏览用户时间轴"},{"depth":2,"value":"用例：用户搜索关键词"},{"depth":1,"value":"架构扩展"}],"path":"/topic/系统设计/样例/微博架构设计"},"tree":{"title":"系统设计","id":"20220523142842-5ohvsi1","parentId":"","href":"/topic/系统设计","path":"/topic/系统设计","children":[{"title":"概念","id":"20220615132453-664g7l0","type":"d","href":"/topic/系统设计/概念","parentId":"","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","sort":1,"children":[{"title":"数据库系统 VS 文件系统","id":"20220615102743-qj0plmz","type":"h","href":"/topic/系统设计/概念#数据库系统 VS 文件系统","parentId":"20220615132453-664g7l0","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[{"title":"关系","id":"20220615102811-lmbzu19","type":"h","href":"/topic/系统设计/概念#关系","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"区别","id":"20220615102835-8kegc0y","type":"h","href":"/topic/系统设计/概念#区别","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"总结","id":"20220615103035-c70ck6k","type":"h","href":"/topic/系统设计/概念#总结","parentId":"20220615102743-qj0plmz","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"单体架构VS微服务架构","id":"20220628154518-x6kau73","type":"h","href":"/topic/系统设计/概念#单体架构VS微服务架构","parentId":"20220615132453-664g7l0","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[{"title":"单体架构","id":"20220628154527-mj1noqe","type":"h","href":"/topic/系统设计/概念#单体架构","parentId":"20220628154518-x6kau73","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"微服务架构","id":"20220628154527-xpc8zw5","type":"h","href":"/topic/系统设计/概念#微服务架构","parentId":"20220628154518-x6kau73","path":"/topic/系统设计/概念","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2}],"level":1},{"title":"4S分析法","id":"20220531175247-wjawyqd","type":"d","href":"/topic/系统设计/4S分析法","parentId":"","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","sort":2,"children":[{"title":"Scenario场景","id":"20220614162313-ymy6pxo","type":"h","href":"/topic/系统设计/4S分析法#Scenario场景","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"需要设计哪些功能","id":"20220616132326-s55nquu","type":"h","href":"/topic/系统设计/4S分析法#需要设计哪些功能","parentId":"20220614162313-ymy6pxo","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"需要承受的访问量","id":"20220616132326-y5xmygg","type":"h","href":"/topic/系统设计/4S分析法#需要承受的访问量","parentId":"20220614162313-ymy6pxo","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3}],"level":2},{"title":"Service服务","id":"20220616132326-j1gz6ab","type":"h","href":"/topic/系统设计/4S分析法#Service服务","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":2},{"title":"Storage存储","id":"20220616132404-d4ylqml","type":"h","href":"/topic/系统设计/4S分析法#Storage存储","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"处理步骤","id":"20220616132411-bvaq4hy","type":"h","href":"/topic/系统设计/4S分析法#处理步骤","parentId":"20220616132404-d4ylqml","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"第一步：为每个Service选择存储结构","id":"20220616132411-o42gm70","type":"h","href":"/topic/系统设计/4S分析法#第一步：为每个Service选择存储结构","parentId":"20220616132411-bvaq4hy","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"第二步：细化表结构","id":"20220616132411-fu7embq","type":"h","href":"/topic/系统设计/4S分析法#第二步：细化表结构","parentId":"20220616132411-bvaq4hy","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3},{"title":"存储模型","id":"20220616132411-wuznh3m","type":"h","href":"/topic/系统设计/4S分析法#存储模型","parentId":"20220616132404-d4ylqml","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"Pull Model 拉模型","id":"20220616132411-ltf0w00","type":"h","href":"/topic/系统设计/4S分析法#Pull Model 拉模型","parentId":"20220616132411-wuznh3m","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3}],"level":2},{"title":"Scala扩展设计","id":"20220616132437-btg0npi","type":"h","href":"/topic/系统设计/4S分析法#Scala扩展设计","parentId":"20220531175247-wjawyqd","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"处理步骤","id":"20220616132443-l9hc1mr","type":"h","href":"/topic/系统设计/4S分析法#处理步骤","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"第一步：优化","id":"20220616132443-i0no8v4","type":"h","href":"/topic/系统设计/4S分析法#第一步：优化","parentId":"20220616132443-l9hc1mr","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"第二部：维护","id":"20220616132443-xo6qd61","type":"h","href":"/topic/系统设计/4S分析法#第二部：维护","parentId":"20220616132443-l9hc1mr","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3},{"title":"Pull的缺陷","id":"20220616132451-87l1875","type":"h","href":"/topic/系统设计/4S分析法#Pull的缺陷","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"Push的缺陷","id":"20220616132443-bjr9ha0","type":"h","href":"/topic/系统设计/4S分析法#Push的缺陷","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":3},{"title":"处理","id":"20220616132443-ezk0war","type":"h","href":"/topic/系统设计/4S分析法#处理","parentId":"20220616132437-btg0npi","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[{"title":"最小改动","id":"20220616132443-lmdkzs3","type":"h","href":"/topic/系统设计/4S分析法#最小改动","parentId":"20220616132443-ezk0war","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4},{"title":"增长预估","id":"20220616132443-1x7j1ed","type":"h","href":"/topic/系统设计/4S分析法#增长预估","parentId":"20220616132443-ezk0war","path":"/topic/系统设计/4S分析法","parentPath":"/topic/系统设计","children":[],"level":4}],"level":3}],"level":2}],"level":1},{"title":"样例","id":"20220523161014-1vkr1si","type":"d","href":"/topic/系统设计/样例","parentId":"","path":"/topic/系统设计/样例","parentPath":"/topic/系统设计","sort":3,"children":[{"title":"短链系统","id":"20220523142856-tm0dduf","type":"d","href":"/topic/系统设计/样例/短链系统","parentId":"","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","sort":1,"children":[{"title":"概述用例和约束","id":"20220523152802-ora3luz","type":"h","href":"/topic/系统设计/样例/短链系统#概述用例和约束","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[{"title":"用例","id":"20220523153231-cqe7c6z","type":"h","href":"/topic/系统设计/样例/短链系统#用例","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"约束和假设","id":"20220523153213-tyokdre","type":"h","href":"/topic/系统设计/样例/短链系统#约束和假设","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"预估容量","id":"20220523153245-akx221a","type":"h","href":"/topic/系统设计/样例/短链系统#预估容量","parentId":"20220523152802-ora3luz","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"创建一个高层次设计","id":"20220523154027-n2m6mb0","type":"h","href":"/topic/系统设计/样例/短链系统#创建一个高层次设计","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"设计核心组件","id":"20220523155756-as6zfq4","type":"h","href":"/topic/系统设计/样例/短链系统#设计核心组件","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[{"title":"用例: 用户输入一段文本，然后得到一个随机生成的链接","id":"20220523155920-i5awrmn","type":"h","href":"/topic/系统设计/样例/短链系统#用例: 用户输入一段文本，然后得到一个随机生成的链接","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户输入一个 paste 的 url 后可以看到它存储的内容","id":"20220523160445-ppzjfcg","type":"h","href":"/topic/系统设计/样例/短链系统#用例：用户输入一个 paste 的 url 后可以看到它存储的内容","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例： 服务跟踪分析页面","id":"20220523160523-x0zwdli","type":"h","href":"/topic/系统设计/样例/短链系统#用例： 服务跟踪分析页面","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例： 服务删除过期的 pastes","id":"20220523160541-cln3fph","type":"h","href":"/topic/系统设计/样例/短链系统#用例： 服务删除过期的 pastes","parentId":"20220523155756-as6zfq4","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"扩展设计","id":"20220523160546-vbv6n9j","type":"h","href":"/topic/系统设计/样例/短链系统#扩展设计","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"总结","id":"20220523163729-9u3wkrv","type":"h","href":"/topic/系统设计/样例/短链系统#总结","parentId":"20220523142856-tm0dduf","path":"/topic/系统设计/样例/短链系统","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2},{"title":"微博架构设计","id":"20220524140048-zkiqvui","type":"d","href":"/topic/系统设计/样例/微博架构设计","parentId":"","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","sort":2,"children":[{"title":"概述用例和约束","id":"20220524140533-yb6pk63","type":"h","href":"/topic/系统设计/样例/微博架构设计#概述用例和约束","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[{"title":"用例","id":"20220524140955-hl15d6z","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例","parentId":"20220524140533-yb6pk63","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"限制条件与假设","id":"20220524142056-m6nm6xm","type":"h","href":"/topic/系统设计/样例/微博架构设计#限制条件与假设","parentId":"20220524140533-yb6pk63","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"概要设计","id":"20220524145303-hrsunb1","type":"h","href":"/topic/系统设计/样例/微博架构设计#概要设计","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"设计核心组件","id":"20220524154837-c7lw852","type":"h","href":"/topic/系统设计/样例/微博架构设计#设计核心组件","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[{"title":"用例: 用户发表了一篇微博","id":"20220524155958-ygnj4py","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例: 用户发表了一篇微博","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户浏览聚合主页时间轴","id":"20220524163832-k1u2urx","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户浏览聚合主页时间轴","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户浏览用户时间轴","id":"20220524164247-audibq3","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户浏览用户时间轴","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"用例：用户搜索关键词","id":"20220524164312-1obgv97","type":"h","href":"/topic/系统设计/样例/微博架构设计#用例：用户搜索关键词","parentId":"20220524154837-c7lw852","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"架构扩展","id":"20220524164325-q9o9ung","type":"h","href":"/topic/系统设计/样例/微博架构设计#架构扩展","parentId":"20220524140048-zkiqvui","path":"/topic/系统设计/样例/微博架构设计","parentPath":"/topic/系统设计/样例","children":[],"level":3}],"level":2},{"title":"秒杀","id":"20220616202141-hy1nbif","type":"d","href":"/topic/系统设计/样例/秒杀","parentId":"","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","sort":4,"children":[{"title":"Scenario场景","id":"20220616202308-9bgzn5z","type":"h","href":"/topic/系统设计/样例/秒杀#Scenario场景","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"需求拆解","id":"20220623170337-upk31iw","type":"h","href":"/topic/系统设计/样例/秒杀#需求拆解","parentId":"20220616202308-9bgzn5z","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"Service 服务","id":"20220623170617-lfeu5ob","type":"h","href":"/topic/系统设计/样例/秒杀#Service 服务","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":3},{"title":"Storage存储","id":"20220623210002-oh2z3zd","type":"h","href":"/topic/系统设计/样例/秒杀#Storage存储","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"商品信息表 commodity_info","id":"20220624113741-lsybjg4","type":"h","href":"/topic/系统设计/样例/秒杀#商品信息表 commodity_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"秒杀活动表 seckill_info","id":"20220624113935-pc2me4m","type":"h","href":"/topic/系统设计/样例/秒杀#秒杀活动表 seckill_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"库存信息表 stock_info","id":"20220624131344-2oot3xz","type":"h","href":"/topic/系统设计/样例/秒杀#库存信息表 stock_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"订单信息表 order_info","id":"20220624131601-lgvwksl","type":"h","href":"/topic/系统设计/样例/秒杀#订单信息表 order_info","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"数据流向","id":"20220624131855-pzpipel","type":"h","href":"/topic/系统设计/样例/秒杀#数据流向","parentId":"20220623210002-oh2z3zd","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4}],"level":3},{"title":"Scala扩展设计","id":"20220628155648-7dj6e6e","type":"h","href":"/topic/系统设计/样例/秒杀#Scala扩展设计","parentId":"20220616202141-hy1nbif","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"数据一致性","id":"20220628155654-6w1zago","type":"h","href":"/topic/系统设计/样例/秒杀#数据一致性","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"应对高QPS","id":"20220628155339-dp92t46","type":"h","href":"/topic/系统设计/样例/秒杀#应对高QPS","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"Redis的缺陷优化","id":"20220628132922-1wcck7q","type":"h","href":"/topic/系统设计/样例/秒杀#Redis的缺陷优化","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"这样就完美了吗？","id":"20220628134645-m8f0zw1","type":"h","href":"/topic/系统设计/样例/秒杀#这样就完美了吗？","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"分布式事务","id":"20220628135940-s7irnu6","type":"h","href":"/topic/系统设计/样例/秒杀#分布式事务","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":4},{"title":"其他的小细节","id":"20220628165937-aaii6h7","type":"h","href":"/topic/系统设计/样例/秒杀#其他的小细节","parentId":"20220628155648-7dj6e6e","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[{"title":"防止刷爆商品页面","id":"20220628140318-7jb6y79","type":"h","href":"/topic/系统设计/样例/秒杀#防止刷爆商品页面","parentId":"20220628165937-aaii6h7","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"服务高可用","id":"20220628140639-2r8f6ir","type":"h","href":"/topic/系统设计/样例/秒杀#服务高可用","parentId":"20220628165937-aaii6h7","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5},{"title":"防止恶意刷请求或者爬虫请求","id":"20220628140847-bweqsx9","type":"h","href":"/topic/系统设计/样例/秒杀#防止恶意刷请求或者爬虫请求","parentId":"20220628165937-aaii6h7","path":"/topic/系统设计/样例/秒杀","parentPath":"/topic/系统设计/样例","children":[],"level":5}],"level":4}],"level":3}],"level":2}],"level":1},{"title":"每个程序员都应该知道的延迟数字","id":"20220524194105-29b5zns","type":"d","href":"/topic/系统设计/每个程序员都应该知道的延迟数字","parentId":"","path":"/topic/系统设计/每个程序员都应该知道的延迟数字","parentPath":"/topic/系统设计","sort":4,"children":[],"level":1},{"title":"Flux架构","id":"20220630203113-cjoqcbf","type":"d","href":"/topic/系统设计/Flux架构","parentId":"","path":"/topic/系统设计/Flux架构","parentPath":"/topic/系统设计","sort":5,"children":[],"level":1},{"title":"Http进化史","id":"20220701132636-sffchc7","type":"d","href":"/topic/系统设计/Http","parentId":"","path":"/topic/系统设计/Http","parentPath":"/topic/系统设计","children":[],"level":1}],"level":0},"headings":[{"depth":1,"value":"微博架构设计","slug":"微博架构设计"},{"depth":1,"value":"概述用例和约束","slug":"概述用例和约束"},{"depth":2,"value":"用例","slug":"用例"},{"depth":2,"value":"限制条件与假设","slug":"限制条件与假设"},{"depth":1,"value":"概要设计","slug":"概要设计"},{"depth":1,"value":"设计核心组件","slug":"设计核心组件"},{"depth":2,"value":"用例: 用户发表了一篇微博","slug":"用例-用户发表了一篇微博"},{"depth":2,"value":"用例：用户浏览聚合主页时间轴","slug":"用例用户浏览聚合主页时间轴"},{"depth":2,"value":"用例：用户浏览用户时间轴","slug":"用例用户浏览用户时间轴"},{"depth":2,"value":"用例：用户搜索关键词","slug":"用例用户搜索关键词"},{"depth":1,"value":"架构扩展","slug":"架构扩展"}]}},
    "staticQueryHashes": ["630634786","928362550"]}