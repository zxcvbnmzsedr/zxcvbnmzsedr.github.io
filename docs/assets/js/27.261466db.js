(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{332:function(s,a,t){"use strict";t.r(a);var e=t(6),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("索引下推是MySQL5.6的一个新特性，在之前是没有的，这块的知识比较冷门。")]),s._v(" "),a("p",[s._v("索引下推通俗一点讲就是 "),a("code",[s._v("在Service层把查询工作下推到引擎层去处理")]),s._v("。其下推的目的是为了减少回表次数，提高查询效率，节约IO开销。")]),s._v(" "),a("p",[s._v("‍")]),s._v(" "),a("h2",{attrs:{id:"mysql的查询逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql的查询逻辑"}},[s._v("#")]),s._v(" MySQL的查询逻辑")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.ztianzeng.com/uPic/20220808152254.png",alt:""}}),s._v("​")]),s._v(" "),a("p",[s._v("当客户端从连接过来之后，就交由给Service层来进行处理，Service主要是执行一些语句的处理和优化，然后交由给引擎层进行处理。")]),s._v(" "),a("p",[s._v("在这个当中，原本由Service层处理的一些逻辑，下推到引擎层进行处理，这个过程就叫做索引下推。")]),s._v(" "),a("h2",{attrs:{id:"案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[s._v("#")]),s._v(" 案例")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.ztianzeng.com/uPic/20220808153434.png",alt:""}}),s._v("​")]),s._v(" "),a("p",[s._v("创建一个表，然后对name 和 age 建立一个联合索引。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" idx "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("然后我们执行一个简单的查询，来分析他是怎么进行处理的")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'张%'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"没有使用索引下推"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#没有使用索引下推"}},[s._v("#")]),s._v(" 没有使用索引下推")]),s._v(" "),a("p",[s._v("在没有使用索引下推的情况下")]),s._v(" "),a("p",[s._v("存储引擎读取索引记录，根据索引中的主键值回表读取出完整的行记录；")]),s._v(" "),a("p",[s._v("存储引擎将回表之后的数据提交给Service层去检测，剩下的age是否满足Where条件。")]),s._v(" "),a("p",[s._v("也就是说，原本即使配置了二级索引，也不会起效")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.ztianzeng.com/uPic/20220808154308.png",alt:""}}),s._v("​")]),s._v(" "),a("h3",{attrs:{id:"使用了索引下推"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用了索引下推"}},[s._v("#")]),s._v(" 使用了索引下推")]),s._v(" "),a("p",[s._v("使用了索引下推之后，在引擎层就做了age的判断，因为做了判断在回表的时候只需要回表一次即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://image.ztianzeng.com/uPic/20220808154457.png",alt:""}}),s._v("​")]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("如果我么能用Explain去查看这个SQL")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name linke "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'张%'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])])]),a("p",[s._v("就能看到Extra一列中，Using index condition。这就是用到索引下推。")]),s._v(" "),a("p",[s._v("‍")])])}),[],!1,null,null,null);a.default=r.exports}}]);