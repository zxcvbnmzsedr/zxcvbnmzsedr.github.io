{
    "componentChunkName": "component---src-templates-article-page-template-tsx",
    "path": "/posts/Nginx泛解析反向代理多个服务",
    "result": {"pageContext":{"id":"/posts/Nginx泛解析反向代理多个服务","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Nginx泛解析反向代理多个服务"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"还是因为我的软路由，上面挂载了多个服务，如果要挨个配置各个服务的反向代理，不还得疯掉。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"所以需要一个通用的方式进行处理。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"首先通过Nginx获取到所有泛解析的二级子域名"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"提取出子域名之后，匹配好定义的upstream"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"进行转发"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"脚本如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-nginx"]},"children":[{"type":"text","value":"\nhttp {\n    client_max_body_size 204800M;\n    upstream note {\n        server 192.168.31.10:6806;\n    }\n    upstream omv {\n        server 192.168.31.10:80;\n    }\n    upstream qbt {\n\t\tserver 192.168.31.10:8082;\n    }\n    upstream webdav {\n        server 192.168.31.10:8080;\n    }\n    upstream openwrt {\n        server 192.168.31.3:80;\n    }\n\nserver {\n\tlisten 2095;\n\tlisten [::]:2095;\n\tserver_name map.shiyitopo.tech;\n\troot /home/nginx/map_html;\n\tlocation / {\n\t\ttry_files $uri $uri/ @router;\n\t\tindex  index.html index.htm;\n\t}\n\tlocation @router {\n\t\trewrite ^.*$ /index.html last;\n\t}\n}\nserver {\n\tlisten [::]:2095;\n\tlisten 2095;\n\tserver_name ~^(?<subdomain>.+).shiyitopo.tech$;\n\tlocation / {\n\t\tproxy_pass http://$subdomain;\n\t\tproxy_http_version 1.1;\n\t\tproxy_set_header Host $subdomain;\n\t\tproxy_set_header   X-Forwarded-Host   $http_host;\n\t\tproxy_set_header   X-Forwarded-For    $remote_addr;\n\n\t}\n}  \n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"监听泛解析的域名，提取出二级域名之后，就用proxy_pass反向代理过去就行。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这样就不需要有新的服务就建立一个server了，只需要定义好upstream的后端地址就可以了。"}]}],"data":{"quirksMode":false}},"articleNode":{"field":{"contentType":"posts","topic":null},"frontmatter":{"id":"/posts/Nginx泛解析反向代理多个服务","title":"Nginx泛解析反向代理多个服务","date":"2022-06-16 11:33","absolute_path":"/posts/Nginx泛解析反向代理多个服务"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Nginx泛解析反向代理多个服务"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"还是因为我的软路由，上面挂载了多个服务，如果要挨个配置各个服务的反向代理，不还得疯掉。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"所以需要一个通用的方式进行处理。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"首先通过Nginx获取到所有泛解析的二级子域名"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"提取出子域名之后，匹配好定义的upstream"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"进行转发"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"脚本如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-nginx"]},"children":[{"type":"text","value":"\nhttp {\n    client_max_body_size 204800M;\n    upstream note {\n        server 192.168.31.10:6806;\n    }\n    upstream omv {\n        server 192.168.31.10:80;\n    }\n    upstream qbt {\n\t\tserver 192.168.31.10:8082;\n    }\n    upstream webdav {\n        server 192.168.31.10:8080;\n    }\n    upstream openwrt {\n        server 192.168.31.3:80;\n    }\n\nserver {\n\tlisten 2095;\n\tlisten [::]:2095;\n\tserver_name map.shiyitopo.tech;\n\troot /home/nginx/map_html;\n\tlocation / {\n\t\ttry_files $uri $uri/ @router;\n\t\tindex  index.html index.htm;\n\t}\n\tlocation @router {\n\t\trewrite ^.*$ /index.html last;\n\t}\n}\nserver {\n\tlisten [::]:2095;\n\tlisten 2095;\n\tserver_name ~^(?<subdomain>.+).shiyitopo.tech$;\n\tlocation / {\n\t\tproxy_pass http://$subdomain;\n\t\tproxy_http_version 1.1;\n\t\tproxy_set_header Host $subdomain;\n\t\tproxy_set_header   X-Forwarded-Host   $http_host;\n\t\tproxy_set_header   X-Forwarded-For    $remote_addr;\n\n\t}\n}  \n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"监听泛解析的域名，提取出二级域名之后，就用proxy_pass反向代理过去就行。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这样就不需要有新的服务就建立一个server了，只需要定义好upstream的后端地址就可以了。"}]}],"data":{"quirksMode":false}},"headings":[{"depth":1,"value":"Nginx泛解析反向代理多个服务"}],"path":"/posts/Nginx泛解析反向代理多个服务"},"headings":[{"depth":1,"value":"Nginx泛解析反向代理多个服务","slug":"nginx泛解析反向代理多个服务"}]}},
    "staticQueryHashes": ["630634786","928362550"]}