{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/K8S从入门到放弃 —— 安装Ingress","result":{"data":{"siYuan":{"excerpt":"K8S从入门到放弃 —— 安装Ingress Ingress 是提供了一个路由，用于反向代理到集群内部的服务中。 这是官网的一张请求示例图。能清晰的看到Ingress所提供的功能。 Ingress Controller Ingress 提供...","raw":"# K8S从入门到放弃 —— 安装Ingress\n\nIngress 是提供了一个路由，用于反向代理到集群内部的服务中。\n\n这是官网的一张请求示例图。能清晰的看到Ingress所提供的功能。\n\n![](https://www.ztianzeng.com/post-images/1622618042586.jpg)\n\n# Ingress Controller\n\nIngress 提供了好多种实现方式，比如 traefic / Kong / Istio / Nginx 等\n\n最恶心的是，Nginx 还提供了两个版本 :\n\n一个是Nginx公司实现的 [nginx-ingress](https://github.com/nginxinc/kubernetes-ingress)\n\n还有一个是K8S 社区实现的 [ingress-nginx](https://github.com/kubernetes/ingress-nginx/)\n\n<table>\n    <thead>\n        <tr>\n            <th>特性</th>\n            <th>K8S 实现版本</th>\n            <th>Nginx 实现版本 (NGINX)</th>\n            <th>Nginx 实现版本 (NGINX Plus)</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td  align=\"center\" colspan=\"4\"><strong>基础</strong></td>\n        </tr>\n        <tr>\n            <td>作者</td>\n            <td>K8S 社区</td>\n            <td>Nginx 公司和社区</td>\n            <td>Nginx 公司和社区</td>\n        </tr>\n        <tr>\n            <td>Nginx版本</td>\n            <td>包含一些三方模块的定制的 Nginx 版本</td>\n            <td>Nginx 官方版本</td>\n            <td>Nginx Plus</td>\n        </tr>\n        <tr>\n            <td>商业支持</td>\n            <td>N/A</td>\n            <td>N/A</td>\n            <td>包含</td>\n        </tr>\n        <tr>\n            <td align=\"center\" colspan=\"4\"<strong>通过Ingress资源配置负载均衡</strong></td\n        </tr>\n        <tr>\n            <td>合并同一host的Ingress规则</td>\n            <td>支持</td>\n            <td>通过 <a target=\"_blank\" href=\"https://github.com/nginxinc/kubernetes-ingress/blob/master/examples/mergeable-ingress-types\">Mergeable Ingresses</a> 支持</td>\n            <td>通过 <a target=\"_blank\" href=\"https://github.com/nginxinc/kubernetes-ingress/blob/master/examples/mergeable-ingress-types\">Mergeable Ingresses</a> 支持</td>\n        </tr>\n        <tr>\n            <td>HTTP负载均衡扩展 -- 注解方式</td>\n            <td>见 <a target=\"_blank\" href=\"https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/\">K8S 支持的注解</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/ingress-resources/advanced-configuration-with-annotations/\">Nginx 支持的注解</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/ingress-resources/advanced-configuration-with-annotations/\">Nginx 支持的注解</a>\n            </td>\n        </tr>\n        <tr>\n            <td>HTTP负载均衡扩展 -- ConfigMap 方式</td>\n            <td>见 <a target=\"_blank\" href=\"https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/\">K8S 支持的 ConfigMap 主键</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/configmap-resource/\">Nginx 支持的 ConfigMap 主键</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/configmap-resource/\">Nginx 支持的 ConfigMap 主键</a>\n            </td>\n        </tr>\n        <tr>\n            <td>TCP/UDP</td>\n            <td>通过 ConfigMap 支持</td>\n            <td>通过 ConfigMap (原生 NGINX 配置) 支持</td>\n            <td>通过 ConfigMap (原生 NGINX 配置) 支持</td>\n        </tr>\n        <tr>\n            <td>Websocket</td>\n            <td>支持</td>\n            <td>通过注解支持</td>\n            <td>通过注解支持</td>\n        </tr>\n        <tr>\n            <td>TCP SSL Passthrough</td>\n            <td>通过 ConfigMap 支持</td>\n            <td>不支持</td>\n            <td>不支持</td>\n        </tr>\n        <tr>\n            <td>JWT 验证</td>\n            <td>不支持</td>\n            <td>不支持</td>\n            <td>支持</td>\n        </tr>\n        <tr>\n            <td>Session 持久化</td>\n            <td>通过三方库支持</td>\n            <td>不支持</td>\n            <td>支持</td>\n        </tr>\n        <tr>\n            <td>金丝雀测试 (通过 header, cookie, weight)</td>\n            <td>通过注解支持</td>\n            <td>通过定制的资源支持</td>\n            <td>通过定制的资源支持</td>\n        </tr>\n        <tr>\n            <td>配置模板 *1</td>\n            <td>见 <a target=\"_blank\" href=\"https://github.com/kubernetes/ingress-nginx/blob/master/rootfs/etc/nginx/template/nginx.tmpl\">模板</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://github.com/nginxinc/kubernetes-ingress/blob/master/internal/configs/version1\">模板</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://github.com/nginxinc/kubernetes-ingress/blob/master/internal/configs/version1\">模板</a>\n            </td>\n        </tr>\n        <tr>\n            <td align=\"center\" colspan=\"4\"><strong>通过定制化资源配置负载均衡配置</strong></td>\n        </tr>\n        <tr>\n            <td>HTTP负载均衡</td>\n            <td>不支持</td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/\">VirtualServer 和 VirtualServerRoute</a> 资源</td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/\">VirtualServer 和 VirtualServerRoute</a> 资源</td>\n        </tr>\n        <tr>\n            <td colspan=\"4\"><strong>部署</strong></td>\n        </tr>\n        <tr>\n            <td>命令行参数 *2</td>\n            <td>见 <a target=\"_blank\" href=\"https://kubernetes.github.io/ingress-nginx/user-guide/cli-arguments/\">K8S 版 参数列表</a>\n            </td>\n            <td>见 <a target=\"_blank\" href=\"https://docs.nginx.com/nginx-ingress-controller/configuration/global-configuration/command-line-arguments/\">Nginx 版 参数列表</a>\n            </td>\n            <td>同左</td>\n        </tr>\n        <tr>\n            <td>默认 Server 的 TLS 证书和秘钥</td>\n            <td>必需(命令行参数) / 自动生成</td>\n            <td>必需(命令行参数)</td>\n            <td>必需(命令行参数)</td>\n        </tr>\n        <tr>\n            <td>Helm Chart</td>\n            <td>支持</td>\n            <td>支持</td>\n            <td>支持</td>\n        </tr>\n        <tr>\n            <td align=\"center\" colspan=\"4\"><strong>运维</strong></td>\n        </tr>\n        <tr>\n            <td>上报 Ingress 控制器的 IP地址到Ingress资源</td>\n            <td>支持</td>\n            <td>支持</td>\n            <td>支持</td>\n        </tr>\n        <tr>\n            <td>扩展的状态</td>\n            <td>通过三方模块支持</td>\n            <td>不支持</td>\n            <td>支持</td>\n        </tr>\n        <tr>\n            <td>Prometheus 整合</td>\n            <td>支持</td>\n            <td>支持</td>\n            <td>支持</td>\n        </tr>\n        <tr>\n            <td>动态配置 endpoints (无需重新加载配置)</td>\n            <td>通过三方模块支持</td>\n            <td>不支持</td>\n            <td>支持</td>\n        </tr>\n    </tbody>\n</table>\n\n我自己一开始使用的是Nginx出品的那个，后面发现Stack Overflow上讨论的问题都没有K8S出品的多，就使用上了K8S的版本Ingress。\n\n# 安装\n\n```\n# 正常情况下就能装上，但是国内由于某些特殊原因导致访问不了谷歌服务，所以需要手动修改镜像地址\ncurl  https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.46.0/deploy/static/provider/cloud/deploy.yaml -O\n\nkubectl apply -f deploy.yaml\n```\n","field":{"slug":"/posts/K8S从入门到放弃 —— 安装Ingress"},"frontmatter":{"title":"K8S从入门到放弃 —— 安装Ingress","tags":["K8S"],"date":"2022-04-21","description":"K8S从入门到放弃 —— 安装Ingress Ingress 是提供了一个路由，用于反向代理到集群内部的服务中。 这是官网的一张请求示例图。能清晰的看到Ingress所提供的功能。 Ingress Controller Ingress 提供..."}},"prev":{"frontmatter":{"title":"K8S入门到放弃 —— 初始化节点"},"field":{"slug":"/posts/K8S入门到放弃 —— 初始化节点"}},"next":{"frontmatter":{"title":"Mac使用Fuse挂载NTFS"},"field":{"slug":"/posts/Mac使用Fuse挂载NTFS"}}},"pageContext":{"slug":"/posts/K8S从入门到放弃 —— 安装Ingress","prevSlug":"/posts/K8S入门到放弃 —— 初始化节点","nextSlug":"/posts/Mac使用Fuse挂载NTFS"}},"staticQueryHashes":["1284643331","2841359383"]}